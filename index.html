
        <style>
        @import url(https://fonts.googleapis.com/css?family=Google+Sans+Text);
        html {
          font-family: 'Google Sans Text', 'Google Sans';
          font-size: 14px;
          color-scheme: light dark;
          background: light-dark(white, black);
          color: light-dark(black, white);
        }
        </style>
        
        <script type="importmap">{"imports":{"@modelcontextprotocol/sdk/":"https://esm.sh/@modelcontextprotocol/sdk/dist/esm/","https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/es2022/":"https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/es2022/dist/esm/","https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/client/index?target=es2022":"https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/dist/esm/client/index?target=es2022","https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/types?target=es2022":"https://esm.sh/@modelcontextprotocol/sdk@^1.11.0/dist/esm/types?target=es2022","react":"https://aistudiocdn.com/react@^19.2.1","react-dom/":"https://aistudiocdn.com/react-dom@^19.2.1/","react/":"https://aistudiocdn.com/react@^19.2.1/","@google/genai":"https://aistudiocdn.com/@google/genai@^1.32.0","@/index":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3ggfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20vY2xpZW50JzsKaW1wb3J0IEFwcCBmcm9tICdAL0FwcCc7CmNvbnN0IHJvb3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKTsKaWYgKCFyb290RWxlbWVudCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgZmluZCByb290IGVsZW1lbnQgdG8gbW91bnQgdG8iKTsKfQpjb25zdCByb290ID0gUmVhY3RET00uY3JlYXRlUm9vdChyb290RWxlbWVudCk7CnJvb3QucmVuZGVyKF9qc3goUmVhY3QuU3RyaWN0TW9kZSwgeyBjaGlsZHJlbjogX2pzeChBcHAsIHt9KSB9KSk7Cg==","@":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3ggfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20vY2xpZW50JzsKaW1wb3J0IEFwcCBmcm9tICdAL0FwcCc7CmNvbnN0IHJvb3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKTsKaWYgKCFyb290RWxlbWVudCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgZmluZCByb290IGVsZW1lbnQgdG8gbW91bnQgdG8iKTsKfQpjb25zdCByb290ID0gUmVhY3RET00uY3JlYXRlUm9vdChyb290RWxlbWVudCk7CnJvb3QucmVuZGVyKF9qc3goUmVhY3QuU3RyaWN0TW9kZSwgeyBjaGlsZHJlbjogX2pzeChBcHAsIHt9KSB9KSk7Cg==","@/types":"data:application/javascript;base64,ZXhwb3J0IHZhciBBcHBTdGF0ZTsKKGZ1bmN0aW9uIChBcHBTdGF0ZSkgewogICAgQXBwU3RhdGVbIklETEUiXSA9ICJJRExFIjsKICAgIEFwcFN0YXRlWyJMT0FESU5HIl0gPSAiTE9BRElORyI7CiAgICBBcHBTdGF0ZVsiRURJVElORyJdID0gIkVESVRJTkciOwogICAgQXBwU3RhdGVbIlBST0NFU1NJTkciXSA9ICJQUk9DRVNTSU5HIjsKICAgIEFwcFN0YXRlWyJFUlJPUiJdID0gIkVSUk9SIjsKICAgIEFwcFN0YXRlWyJMSUJSQVJZIl0gPSAiTElCUkFSWSI7Cn0pKEFwcFN0YXRlIHx8IChBcHBTdGF0ZSA9IHt9KSk7CmV4cG9ydCB2YXIgVG9vbE1vZGU7CihmdW5jdGlvbiAoVG9vbE1vZGUpIHsKICAgIFRvb2xNb2RlWyJTRUxFQ1QiXSA9ICJTRUxFQ1QiOwogICAgVG9vbE1vZGVbIk1PVkUiXSA9ICJNT1ZFIjsKfSkoVG9vbE1vZGUgfHwgKFRvb2xNb2RlID0ge30pKTsK","@/constants":"data:application/javascript;base64,ZXhwb3J0IGNvbnN0IFRIRU1FX0NPTE9SID0gJyMwNmI2ZDQnOyAvLyBDeWFuLTUwMApleHBvcnQgY29uc3QgV0FWRUZPUk1fQ09MT1IgPSAnIzIyZDNlZSc7IC8vIEN5YW4tNDAwCmV4cG9ydCBjb25zdCBXQVZFRk9STV9CRyA9ICcjMTgxODFiJzsgLy8gWmluYy05MDAKZXhwb3J0IGNvbnN0IFNFTEVDVElPTl9DT0xPUiA9ICdyZ2JhKDYsIDE4MiwgMjEyLCAwLjMpJzsKZXhwb3J0IGNvbnN0IFBMQVlIRUFEX0NPTE9SID0gJyNlZjQ0NDQnOyAvLyBSZWQtNTAwCmV4cG9ydCBjb25zdCBERUZBVUxUX1NBTVBMRV9SQVRFID0gNDQxMDA7CmV4cG9ydCBjb25zdCBNQVhfWk9PTSA9IDMwMDsgLy8gcGl4ZWxzIHBlciBzZWNvbmQKZXhwb3J0IGNvbnN0IE1JTl9aT09NID0gMTA7CmV4cG9ydCBjb25zdCBERUZBVUxUX1pPT00gPSA1MDsKZXhwb3J0IGNvbnN0IExBTkVfSEVJR0hUID0gMTIwOyAvLyBIZWlnaHQgb2YgZWFjaCB0cmFjayBsYW5lIGluIHBpeGVscwpleHBvcnQgY29uc3QgU05BUF9USFJFU0hPTERfUFggPSAxNTsgLy8gRGlzdGFuY2UgaW4gcGl4ZWxzIHRvIHRyaWdnZXIgc25hcHBpbmcKLy8gRXh0ZW5kZWQgUGFsZXR0ZSBmb3IgTXVsdGktbGF5ZXIgdmlzdWFsaXphdGlvbgpleHBvcnQgY29uc3QgVFJBQ0tfQ09MT1JTID0gWwogICAgJyMyMmQzZWUnLCAvLyBDeWFuLTQwMAogICAgJyM4MThjZjgnLCAvLyBJbmRpZ28tNDAwCiAgICAnI2U4NzlmOScsIC8vIEZ1Y2hzaWEtNDAwCiAgICAnI2Y0NzJiNicsIC8vIFBpbmstNDAwCiAgICAnI2ZiNzE4NScsIC8vIFJvc2UtNDAwCiAgICAnIzM0ZDM5OScsIC8vIEVtZXJhbGQtNDAwCiAgICAnI2ZiYmYyNCcsIC8vIEFtYmVyLTQwMAogICAgJyNhNzhiZmEnLCAvLyBWaW9sZXQtNDAwCiAgICAnIzJkZDRiZicsIC8vIFRlYWwtNDAwCiAgICAnIzYwYTVmYScsIC8vIEJsdWUtNDAwCl07CmV4cG9ydCBjb25zdCBCRUFUX1BBVFRFUk5TID0gewogICAgLy8gMTYgc3RlcHMuIDEgPSBLaWNrLCAyID0gU25hcmUsIDMgPSBIaUhhdAogICAgJ1JvY2snOiBbWzEsIDAsIDMsIDAsIDIsIDAsIDMsIDAsIDEsIDAsIDMsIDEsIDIsIDAsIDMsIDBdXSwKICAgICdIaXBIb3AnOiBbWzEsIDAsIDMsIDAsIDIsIDAsIDMsIDEsIDAsIDEsIDMsIDAsIDIsIDAsIDMsIDBdXSwKICAgICdUZWNobm8nOiBbWzEsIDMsIDAsIDMsIDEsIDMsIDAsIDMsIDEsIDMsIDAsIDMsIDEsIDMsIDAsIDNdXSwKICAgICdNZXRyb25vbWUnOiBbWzQsIDAsIDAsIDAsIDUsIDAsIDAsIDAsIDUsIDAsIDAsIDAsIDUsIDAsIDAsIDBdXSAvLyA0PUhpZ2ggVGljaywgNT1Mb3cgVGljawp9Owo=","@/services/audioUtils":"data:application/javascript;base64,aW1wb3J0IHsgREVGQVVMVF9TQU1QTEVfUkFURSwgQkVBVF9QQVRURVJOUyB9IGZyb20gJ0AvY29uc3RhbnRzJzsKbGV0IGF1ZGlvQ29udGV4dCA9IG51bGw7CmV4cG9ydCBjb25zdCBnZXRBdWRpb0NvbnRleHQgPSAoKSA9PiB7CiAgICBpZiAoIWF1ZGlvQ29udGV4dCkgewogICAgICAgIGF1ZGlvQ29udGV4dCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSh7CiAgICAgICAgICAgIHNhbXBsZVJhdGU6IERFRkFVTFRfU0FNUExFX1JBVEUsCiAgICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gYXVkaW9Db250ZXh0Owp9OwpleHBvcnQgY29uc3QgZGVjb2RlQXVkaW9EYXRhID0gYXN5bmMgKGFycmF5QnVmZmVyKSA9PiB7CiAgICBjb25zdCBjdHggPSBnZXRBdWRpb0NvbnRleHQoKTsKICAgIHJldHVybiBhd2FpdCBjdHguZGVjb2RlQXVkaW9EYXRhKGFycmF5QnVmZmVyKTsKfTsKZXhwb3J0IGNvbnN0IGNyZWF0ZUVtcHR5QnVmZmVyID0gKGN0eCwgc2Vjb25kcykgPT4gewogICAgcmV0dXJuIGN0eC5jcmVhdGVCdWZmZXIoMiwgY3R4LnNhbXBsZVJhdGUgKiBzZWNvbmRzLCBjdHguc2FtcGxlUmF0ZSk7Cn07Ci8vIC0tLSBCUE0gRGV0ZWN0aW9uIC0tLQpleHBvcnQgY29uc3QgZGV0ZWN0QlBNID0gYXN5bmMgKGJ1ZmZlcikgPT4gewogICAgdHJ5IHsKICAgICAgICAvLyAxLiBBbmFseXplIGEgc2VnbWVudCAodXAgdG8gMzBzIGZyb20gdGhlIG1pZGRsZSkgdG8gc2F2ZSByZXNvdXJjZXMKICAgICAgICBsZXQgYW5hbHlzaXNCdWZmZXIgPSBidWZmZXI7CiAgICAgICAgaWYgKGJ1ZmZlci5kdXJhdGlvbiA+IDQwKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gTWF0aC5mbG9vcihidWZmZXIuZHVyYXRpb24gLyAyKSAtIDIwOwogICAgICAgICAgICBjb25zdCBlbmQgPSBzdGFydCArIDQwOwogICAgICAgICAgICBhbmFseXNpc0J1ZmZlciA9IHRyaW1CdWZmZXIoYnVmZmVyLCBzdGFydCwgZW5kKTsKICAgICAgICB9CiAgICAgICAgLy8gMi4gT2ZmbGluZSBQcm9jZXNzaW5nOiBGaWx0ZXIgZm9yIFJoeXRobWljIEVsZW1lbnRzCiAgICAgICAgLy8gV2UgdXNlIE9mZmxpbmVBdWRpb0NvbnRleHQgdG8gZmlsdGVyIGRvd24gdG8gdGhlIGJhc3Mva2ljay9zbmFyZSBmcmVxdWVuY2llcwogICAgICAgIGNvbnN0IG9mZmxpbmVDdHggPSBuZXcgT2ZmbGluZUF1ZGlvQ29udGV4dCgxLCBhbmFseXNpc0J1ZmZlci5sZW5ndGgsIGFuYWx5c2lzQnVmZmVyLnNhbXBsZVJhdGUpOwogICAgICAgIGNvbnN0IHNvdXJjZSA9IG9mZmxpbmVDdHguY3JlYXRlQnVmZmVyU291cmNlKCk7CiAgICAgICAgc291cmNlLmJ1ZmZlciA9IGFuYWx5c2lzQnVmZmVyOwogICAgICAgIC8vIEJhbmRwYXNzLWlzaCBGaWx0ZXIgKExvd3Bhc3MgKyBIaWdocGFzcykKICAgICAgICAvLyBGb2N1cyBvbiA3MEh6IC0gNDAwSHogcmFuZ2UgdG8gY2F0Y2gga2lja3MgYW5kIHNuYXJlIGJvZGllcwogICAgICAgIGNvbnN0IGxvd3Bhc3MgPSBvZmZsaW5lQ3R4LmNyZWF0ZUJpcXVhZEZpbHRlcigpOwogICAgICAgIGxvd3Bhc3MudHlwZSA9ICJsb3dwYXNzIjsKICAgICAgICBsb3dwYXNzLmZyZXF1ZW5jeS52YWx1ZSA9IDQwMDsKICAgICAgICBsb3dwYXNzLlEudmFsdWUgPSAxOwogICAgICAgIGNvbnN0IGhpZ2hwYXNzID0gb2ZmbGluZUN0eC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTsKICAgICAgICBoaWdocGFzcy50eXBlID0gImhpZ2hwYXNzIjsKICAgICAgICBoaWdocGFzcy5mcmVxdWVuY3kudmFsdWUgPSA3MDsKICAgICAgICBoaWdocGFzcy5RLnZhbHVlID0gMTsKICAgICAgICBzb3VyY2UuY29ubmVjdChsb3dwYXNzKTsKICAgICAgICBsb3dwYXNzLmNvbm5lY3QoaGlnaHBhc3MpOwogICAgICAgIGhpZ2hwYXNzLmNvbm5lY3Qob2ZmbGluZUN0eC5kZXN0aW5hdGlvbik7CiAgICAgICAgc291cmNlLnN0YXJ0KDApOwogICAgICAgIGNvbnN0IHJlbmRlcmVkID0gYXdhaXQgb2ZmbGluZUN0eC5zdGFydFJlbmRlcmluZygpOwogICAgICAgIGNvbnN0IGRhdGEgPSByZW5kZXJlZC5nZXRDaGFubmVsRGF0YSgwKTsKICAgICAgICAvLyAzLiBFbnZlbG9wZSBFeHRyYWN0aW9uIChFbmVyZ3kgRmx1eCkKICAgICAgICAvLyBXZSBjYWxjdWxhdGUgUk1TIGVuZXJneSBpbiBzbWFsbCB3aW5kb3dzICg1bXMpIHRvIGNyZWF0ZSBhbiBlbnZlbG9wZQogICAgICAgIC8vIFRoZW4gd2UgY2FsY3VsYXRlIHRoZSAiRmx1eCIgKGNoYW5nZSBpbiBlbmVyZ3kpIHRvIGlkZW50aWZ5IHBlcmN1c3NpdmUgb25zZXRzCiAgICAgICAgY29uc3Qgd2luZG93U2l6ZSA9IE1hdGguZmxvb3IoYW5hbHlzaXNCdWZmZXIuc2FtcGxlUmF0ZSAqIDAuMDA1KTsgLy8gNW1zIHdpbmRvdwogICAgICAgIGNvbnN0IGVuZXJneVByb2ZpbGUgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IHdpbmRvd1NpemUpIHsKICAgICAgICAgICAgbGV0IHN1bSA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgd2luZG93U2l6ZSAmJiBpICsgaiA8IGRhdGEubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIHN1bSArPSBkYXRhW2kgKyBqXSAqIGRhdGFbaSArIGpdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVuZXJneVByb2ZpbGUucHVzaChNYXRoLnNxcnQoc3VtIC8gd2luZG93U2l6ZSkpOwogICAgICAgIH0KICAgICAgICAvLyBDYWxjdWxhdGUgRmx1eCAob25seSBwb3NpdGl2ZSBjaGFuZ2VzLCByZXByZXNlbnRpbmcgYXR0YWNrcykKICAgICAgICBjb25zdCBvbnNldFByb2ZpbGUgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGVuZXJneVByb2ZpbGUubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgZGlmZiA9IGVuZXJneVByb2ZpbGVbaV0gLSBlbmVyZ3lQcm9maWxlW2kgLSAxXTsKICAgICAgICAgICAgb25zZXRQcm9maWxlLnB1c2goTWF0aC5tYXgoZGlmZiwgMCkpOwogICAgICAgIH0KICAgICAgICAvLyA0LiBBdXRvY29ycmVsYXRpb24gZm9yIFRlbXBvIEVzdGltYXRpb24KICAgICAgICAvLyBXZSBjb3JyZWxhdGUgdGhlIG9uc2V0IHNpZ25hbCB3aXRoIGl0c2VsZiBhdCBkaWZmZXJlbnQgbGFncyBjb3JyZXNwb25kaW5nIHRvIDYwLTE4MCBCUE0KICAgICAgICBjb25zdCBtaW5CUE0gPSA2MDsKICAgICAgICBjb25zdCBtYXhCUE0gPSAxODA7CiAgICAgICAgLy8gQ29udmVydCBCUE0gdG8gbGFnIChpbiB3aW5kb3cgaW5kaWNlcykKICAgICAgICAvLyBMYWcgPSA2MCAvIChCUE0gKiB3aW5kb3dfc2Vjb25kcykKICAgICAgICBjb25zdCBtaW5MYWcgPSBNYXRoLmZsb29yKDYwIC8gKG1heEJQTSAqIDAuMDA1KSk7CiAgICAgICAgY29uc3QgbWF4TGFnID0gTWF0aC5jZWlsKDYwIC8gKG1pbkJQTSAqIDAuMDA1KSk7CiAgICAgICAgY29uc3QgY29ycmVsYXRpb25zID0gW107CiAgICAgICAgLy8gT3B0aW1pemU6IFdlIGRvbid0IG5lZWQgdG8gY29ycmVsYXRlIHRoZSBlbnRpcmUgNDBzLiAKICAgICAgICAvLyAxMC0xNSBzZWNvbmRzIG9mIHNpZ25hbCAoMjAwMC0zMDAwIHdpbmRvd3MpIGlzIGVub3VnaCBmb3IgcGVyaW9kaWNpdHkuCiAgICAgICAgY29uc3Qgc2VhcmNoTGVuID0gTWF0aC5taW4ob25zZXRQcm9maWxlLmxlbmd0aCwgMzAwMCk7CiAgICAgICAgZm9yIChsZXQgbGFnID0gbWluTGFnOyBsYWcgPD0gbWF4TGFnOyBsYWcrKykgewogICAgICAgICAgICBsZXQgY3VycmVudENvcnJlbGF0aW9uID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWFyY2hMZW4gLSBsYWc7IGkrKykgewogICAgICAgICAgICAgICAgY3VycmVudENvcnJlbGF0aW9uICs9IG9uc2V0UHJvZmlsZVtpXSAqIG9uc2V0UHJvZmlsZVtpICsgbGFnXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb3JyZWxhdGlvbnMucHVzaCh7CiAgICAgICAgICAgICAgICBicG06IDYwIC8gKGxhZyAqIDAuMDA1KSwKICAgICAgICAgICAgICAgIHN0cmVuZ3RoOiBjdXJyZW50Q29ycmVsYXRpb24KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIC8vIDUuIFBlYWsgRmluZGluZyAmIEhldXJpc3RpY3MKICAgICAgICAvLyBTb3J0IGJ5IGNvcnJlbGF0aW9uIHN0cmVuZ3RoCiAgICAgICAgY29ycmVsYXRpb25zLnNvcnQoKGEsIGIpID0+IGIuc3RyZW5ndGggLSBhLnN0cmVuZ3RoKTsKICAgICAgICBpZiAoY29ycmVsYXRpb25zLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgLy8gVGFrZSB0b3AgY2FuZGlkYXRlcwogICAgICAgIGNvbnN0IHRvcENhbmRpZGF0ZXMgPSBjb3JyZWxhdGlvbnMuc2xpY2UoMCwgNSk7CiAgICAgICAgbGV0IGNob3NlbkJQTSA9IHRvcENhbmRpZGF0ZXNbMF0uYnBtOwogICAgICAgIGNvbnN0IG1heFN0cmVuZ3RoID0gdG9wQ2FuZGlkYXRlc1swXS5zdHJlbmd0aDsKICAgICAgICAvLyBPY3RhdmUgRXJyb3IgQ29ycmVjdGlvbgogICAgICAgIC8vIEF1dG9jb3JyZWxhdGlvbiBvZnRlbiBkZXRlY3RzIGhhbGYtdGltZSBvciBkb3VibGUtdGltZS4KICAgICAgICAvLyBXZSBwcmVmZXIgQlBNcyBpbiB0aGUgInN0YW5kYXJkIiBwb3AgcmFuZ2UgKDkwLTE0MCkgaWYgdGhleSBhcmUgc3Ryb25nIGVub3VnaC4KICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRvcENhbmRpZGF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlID0gdG9wQ2FuZGlkYXRlc1tpXTsKICAgICAgICAgICAgLy8gSWYgY2FuZGlkYXRlIGlzIGF0IGxlYXN0IDc1JSBhcyBzdHJvbmcgYXMgdGhlIHdpbm5lcgogICAgICAgICAgICBpZiAoY2FuZGlkYXRlLnN0cmVuZ3RoID4gbWF4U3RyZW5ndGggKiAwLjc1KSB7CiAgICAgICAgICAgICAgICAvLyBDaGVjayAxOiBQcmVmZXIgOTAtMTQwIHJhbmdlCiAgICAgICAgICAgICAgICBjb25zdCB3aW5uZXJJc0V4dHJlbWUgPSBjaG9zZW5CUE0gPCA5MCB8fCBjaG9zZW5CUE0gPiAxNjA7CiAgICAgICAgICAgICAgICBjb25zdCBjYW5kaWRhdGVJc05vcm1hbCA9IGNhbmRpZGF0ZS5icG0gPj0gOTAgJiYgY2FuZGlkYXRlLmJwbSA8PSAxNjA7CiAgICAgICAgICAgICAgICBpZiAod2lubmVySXNFeHRyZW1lICYmIGNhbmRpZGF0ZUlzTm9ybWFsKSB7CiAgICAgICAgICAgICAgICAgICAgY2hvc2VuQlBNID0gY2FuZGlkYXRlLmJwbTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIENoZWNrIDI6IENvcnJlY3QgSGFsZi10aW1lIGRldGVjdGlvbiAoZS5nLiBkZXRlY3RlZCA2MCwgcmVhbCBpcyAxMjApCiAgICAgICAgICAgICAgICAvLyBJZiBjYW5kaWRhdGUgaXMgYXBwcm94IGRvdWJsZSB0aGUgY3VycmVudCB3aW5uZXIKICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhjYW5kaWRhdGUuYnBtIC0gMiAqIGNob3NlbkJQTSkgPCA1KSB7CiAgICAgICAgICAgICAgICAgICAgY2hvc2VuQlBNID0gY2FuZGlkYXRlLmJwbTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChjaG9zZW5CUE0pOwogICAgfQogICAgY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJCUE0gRGV0ZWN0aW9uIEVycm9yIiwgZSk7CiAgICAgICAgcmV0dXJuIDA7IC8vIFJldHVybiAwIG9uIGZhaWx1cmUKICAgIH0KfTsKLy8gLS0tIFByZXZpZXcgR2VuZXJhdGlvbiAtLS0KZXhwb3J0IGNvbnN0IGdlbmVyYXRlUHJvamVjdFByZXZpZXcgPSAodHJhY2tzLCB3aWR0aCwgaGVpZ2h0KSA9PiB7CiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDsKICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgaWYgKCFjdHgpCiAgICAgICAgcmV0dXJuICcnOwogICAgLy8gRGFyayBiYWNrZ3JvdW5kCiAgICBjdHguZmlsbFN0eWxlID0gJyMxODE4MWInOwogICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgaWYgKHRyYWNrcy5sZW5ndGggPT09IDApCiAgICAgICAgcmV0dXJuIGNhbnZhcy50b0RhdGFVUkwoKTsKICAgIC8vIERldGVybWluZSB0b3RhbCBkdXJhdGlvbgogICAgY29uc3QgbWF4RHVyID0gTWF0aC5tYXgoLi4udHJhY2tzLm1hcCh0ID0+IHQuc3RhcnRUaW1lICsgdC5kdXJhdGlvbikpOwogICAgY29uc3Qgc2NhbGVYID0gd2lkdGggLyAobWF4RHVyIHx8IDEpOwogICAgLy8gRHJhdyBzaW1wbGlmaWVkIHRyYWNrcwogICAgdHJhY2tzLmZvckVhY2godHJhY2sgPT4gewogICAgICAgIGNvbnN0IHggPSB0cmFjay5zdGFydFRpbWUgKiBzY2FsZVg7CiAgICAgICAgY29uc3QgdyA9IE1hdGgubWF4KDIsIHRyYWNrLmR1cmF0aW9uICogc2NhbGVYKTsKICAgICAgICBjb25zdCBsYW5lSCA9IGhlaWdodCAvIDU7CiAgICAgICAgY29uc3QgeSA9ICh0cmFjay5sYW5lICUgNSkgKiBsYW5lSCArIDI7CiAgICAgICAgY29uc3QgaCA9IGxhbmVIIC0gNDsKICAgICAgICBjdHguZmlsbFN0eWxlID0gdHJhY2suY29sb3I7CiAgICAgICAgY3R4LmZpbGxSZWN0KHgsIHksIHcsIGgpOwogICAgfSk7CiAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7Cn07Ci8vIC0tLSBPZmZsaW5lIFByb2Nlc3NpbmcgVXRpbGl0aWVzIC0tLQpleHBvcnQgY29uc3QgYXBwbHlGYWRlID0gYXN5bmMgKGJ1ZmZlciwgdHlwZSwgZHVyYXRpb24pID0+IHsKICAgIGNvbnN0IGN0eCA9IG5ldyBPZmZsaW5lQXVkaW9Db250ZXh0KGJ1ZmZlci5udW1iZXJPZkNoYW5uZWxzLCBidWZmZXIubGVuZ3RoLCBidWZmZXIuc2FtcGxlUmF0ZSk7CiAgICBjb25zdCBzb3VyY2UgPSBjdHguY3JlYXRlQnVmZmVyU291cmNlKCk7CiAgICBzb3VyY2UuYnVmZmVyID0gYnVmZmVyOwogICAgY29uc3QgZ2FpbiA9IGN0eC5jcmVhdGVHYWluKCk7CiAgICBzb3VyY2UuY29ubmVjdChnYWluKTsKICAgIGdhaW4uY29ubmVjdChjdHguZGVzdGluYXRpb24pOwogICAgY29uc3QgZmFkZUR1ciA9IE1hdGgubWluKGR1cmF0aW9uLCBidWZmZXIuZHVyYXRpb24pOwogICAgaWYgKHR5cGUgPT09ICdpbicpIHsKICAgICAgICBnYWluLmdhaW4uc2V0VmFsdWVBdFRpbWUoMCwgMCk7CiAgICAgICAgZ2Fpbi5nYWluLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKDEsIGZhZGVEdXIpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgZ2Fpbi5nYWluLnNldFZhbHVlQXRUaW1lKDEsIGJ1ZmZlci5kdXJhdGlvbiAtIGZhZGVEdXIpOwogICAgICAgIGdhaW4uZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSgwLCBidWZmZXIuZHVyYXRpb24pOwogICAgfQogICAgc291cmNlLnN0YXJ0KCk7CiAgICByZXR1cm4gYXdhaXQgY3R4LnN0YXJ0UmVuZGVyaW5nKCk7Cn07CmV4cG9ydCBjb25zdCBhcHBseUNyb3NzZmFkZSA9IGFzeW5jIChidWZmZXIsIHNlbGVjdGlvblN0YXJ0LCBzZWxlY3Rpb25FbmQsIGR1cmF0aW9uID0gMC41KSA9PiB7CiAgICBjb25zdCBjdHggPSBuZXcgT2ZmbGluZUF1ZGlvQ29udGV4dChidWZmZXIubnVtYmVyT2ZDaGFubmVscywgYnVmZmVyLmxlbmd0aCwgYnVmZmVyLnNhbXBsZVJhdGUpOwogICAgY29uc3Qgc291cmNlID0gY3R4LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpOwogICAgc291cmNlLmJ1ZmZlciA9IGJ1ZmZlcjsKICAgIGNvbnN0IGdhaW4gPSBjdHguY3JlYXRlR2FpbigpOwogICAgc291cmNlLmNvbm5lY3QoZ2Fpbik7CiAgICBnYWluLmNvbm5lY3QoY3R4LmRlc3RpbmF0aW9uKTsKICAgIGNvbnN0IGZhZGVEdXIgPSBNYXRoLm1pbihkdXJhdGlvbiwgKHNlbGVjdGlvbkVuZCAtIHNlbGVjdGlvblN0YXJ0KSAvIDIpOwogICAgZ2Fpbi5nYWluLnNldFZhbHVlQXRUaW1lKDEsIDApOwogICAgaWYgKHNlbGVjdGlvblN0YXJ0ID49IDApIHsKICAgICAgICBnYWluLmdhaW4uc2V0VmFsdWVBdFRpbWUoMCwgc2VsZWN0aW9uU3RhcnQpOwogICAgICAgIGdhaW4uZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSgxLCBzZWxlY3Rpb25TdGFydCArIGZhZGVEdXIpOwogICAgfQogICAgaWYgKHNlbGVjdGlvbkVuZCA8PSBidWZmZXIuZHVyYXRpb24pIHsKICAgICAgICBnYWluLmdhaW4uc2V0VmFsdWVBdFRpbWUoMSwgc2VsZWN0aW9uRW5kIC0gZmFkZUR1cik7CiAgICAgICAgZ2Fpbi5nYWluLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKDAsIHNlbGVjdGlvbkVuZCk7CiAgICB9CiAgICBzb3VyY2Uuc3RhcnQoKTsKICAgIHJldHVybiBhd2FpdCBjdHguc3RhcnRSZW5kZXJpbmcoKTsKfTsKLyoqCiAqIE1lcmdlcyB0d28gYnVmZmVycyB3aXRoIGEgY3Jvc3NmYWRlIG92ZXJsYXAuCiAqIFVzZWQgZm9yIGpvaW5pbmcgdHdvIGFkamFjZW50IHRyYWNrcy4KICovCmV4cG9ydCBjb25zdCBtZXJnZUJ1ZmZlcnMgPSBhc3luYyAobGVmdCwgcmlnaHQsIG92ZXJsYXBEdXJhdGlvbikgPT4gewogICAgY29uc3QgY2hhbm5lbHMgPSBNYXRoLm1heChsZWZ0Lm51bWJlck9mQ2hhbm5lbHMsIHJpZ2h0Lm51bWJlck9mQ2hhbm5lbHMpOwogICAgY29uc3Qgc2FtcGxlUmF0ZSA9IGxlZnQuc2FtcGxlUmF0ZTsKICAgIC8vIENhbGN1bGF0ZSBuZXcgdG90YWwgZHVyYXRpb246IChMZWZ0ICsgUmlnaHQpIC0gT3ZlcmxhcAogICAgY29uc3QgdG90YWxEdXJhdGlvbiA9IGxlZnQuZHVyYXRpb24gKyByaWdodC5kdXJhdGlvbiAtIG92ZXJsYXBEdXJhdGlvbjsKICAgIGNvbnN0IGxlbmd0aCA9IE1hdGguY2VpbCh0b3RhbER1cmF0aW9uICogc2FtcGxlUmF0ZSk7CiAgICBjb25zdCBjdHggPSBuZXcgT2ZmbGluZUF1ZGlvQ29udGV4dChjaGFubmVscywgbGVuZ3RoLCBzYW1wbGVSYXRlKTsKICAgIC8vIExlZnQgU291cmNlIChGYWRlcyBvdXQgYXQgZW5kKQogICAgY29uc3Qgc3JjTGVmdCA9IGN0eC5jcmVhdGVCdWZmZXJTb3VyY2UoKTsKICAgIHNyY0xlZnQuYnVmZmVyID0gbGVmdDsKICAgIGNvbnN0IGdhaW5MZWZ0ID0gY3R4LmNyZWF0ZUdhaW4oKTsKICAgIHNyY0xlZnQuY29ubmVjdChnYWluTGVmdCk7CiAgICBnYWluTGVmdC5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7CiAgICAvLyBSaWdodCBTb3VyY2UgKEZhZGVzIGluIGF0IHN0YXJ0LCBkZWxheWVkIGJ5IGxlZnQuZHVyYXRpb24gLSBvdmVybGFwKQogICAgY29uc3Qgc3JjUmlnaHQgPSBjdHguY3JlYXRlQnVmZmVyU291cmNlKCk7CiAgICBzcmNSaWdodC5idWZmZXIgPSByaWdodDsKICAgIGNvbnN0IGdhaW5SaWdodCA9IGN0eC5jcmVhdGVHYWluKCk7CiAgICBzcmNSaWdodC5jb25uZWN0KGdhaW5SaWdodCk7CiAgICBnYWluUmlnaHQuY29ubmVjdChjdHguZGVzdGluYXRpb24pOwogICAgY29uc3Qgb3ZlcmxhcFN0YXJ0ID0gbGVmdC5kdXJhdGlvbiAtIG92ZXJsYXBEdXJhdGlvbjsKICAgIC8vIFNjaGVkdWxlIEZhZGVzCiAgICAvLyBMZWZ0OiAxIC0+IDAgZHVyaW5nIG92ZXJsYXAKICAgIGdhaW5MZWZ0LmdhaW4uc2V0VmFsdWVBdFRpbWUoMSwgb3ZlcmxhcFN0YXJ0KTsKICAgIGdhaW5MZWZ0LmdhaW4ubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoMCwgbGVmdC5kdXJhdGlvbik7CiAgICAvLyBSaWdodDogMCAtPiAxIGR1cmluZyBvdmVybGFwCiAgICBjb25zdCByaWdodFN0YXJ0VGltZSA9IG92ZXJsYXBTdGFydDsKICAgIGdhaW5SaWdodC5nYWluLnNldFZhbHVlQXRUaW1lKDAsIHJpZ2h0U3RhcnRUaW1lKTsKICAgIGdhaW5SaWdodC5nYWluLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKDEsIHJpZ2h0U3RhcnRUaW1lICsgb3ZlcmxhcER1cmF0aW9uKTsKICAgIHNyY0xlZnQuc3RhcnQoMCk7CiAgICBzcmNSaWdodC5zdGFydChyaWdodFN0YXJ0VGltZSk7CiAgICByZXR1cm4gYXdhaXQgY3R4LnN0YXJ0UmVuZGVyaW5nKCk7Cn07CmV4cG9ydCBjb25zdCBjaGFuZ2VTcGVlZCA9IGFzeW5jIChidWZmZXIsIHBsYXliYWNrUmF0ZSkgPT4gewogICAgY29uc3QgbmV3RHVyYXRpb24gPSBidWZmZXIuZHVyYXRpb24gLyBwbGF5YmFja1JhdGU7CiAgICBjb25zdCBjdHggPSBuZXcgT2ZmbGluZUF1ZGlvQ29udGV4dChidWZmZXIubnVtYmVyT2ZDaGFubmVscywgTWF0aC5jZWlsKG5ld0R1cmF0aW9uICogYnVmZmVyLnNhbXBsZVJhdGUpLCBidWZmZXIuc2FtcGxlUmF0ZSk7CiAgICBjb25zdCBzb3VyY2UgPSBjdHguY3JlYXRlQnVmZmVyU291cmNlKCk7CiAgICBzb3VyY2UuYnVmZmVyID0gYnVmZmVyOwogICAgc291cmNlLnBsYXliYWNrUmF0ZS52YWx1ZSA9IHBsYXliYWNrUmF0ZTsKICAgIHNvdXJjZS5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7CiAgICBzb3VyY2Uuc3RhcnQoKTsKICAgIHJldHVybiBhd2FpdCBjdHguc3RhcnRSZW5kZXJpbmcoKTsKfTsKZXhwb3J0IGNvbnN0IHJldmVyc2VCdWZmZXIgPSAoYnVmZmVyKSA9PiB7CiAgICBjb25zdCBjdHggPSBnZXRBdWRpb0NvbnRleHQoKTsKICAgIGNvbnN0IG5ld0J1ZmZlciA9IGN0eC5jcmVhdGVCdWZmZXIoYnVmZmVyLm51bWJlck9mQ2hhbm5lbHMsIGJ1ZmZlci5sZW5ndGgsIGJ1ZmZlci5zYW1wbGVSYXRlKTsKICAgIGZvciAobGV0IGMgPSAwOyBjIDwgYnVmZmVyLm51bWJlck9mQ2hhbm5lbHM7IGMrKykgewogICAgICAgIGNvbnN0IG9sZERhdGEgPSBidWZmZXIuZ2V0Q2hhbm5lbERhdGEoYyk7CiAgICAgICAgY29uc3QgbmV3RGF0YSA9IG5ld0J1ZmZlci5nZXRDaGFubmVsRGF0YShjKTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld0RhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbmV3RGF0YVtpXSA9IG9sZERhdGFbYnVmZmVyLmxlbmd0aCAtIDEgLSBpXTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gbmV3QnVmZmVyOwp9OwpleHBvcnQgY29uc3Qgbm9ybWFsaXplQnVmZmVyID0gKGJ1ZmZlcikgPT4gewogICAgbGV0IG1heCA9IDA7CiAgICBmb3IgKGxldCBjID0gMDsgYyA8IGJ1ZmZlci5udW1iZXJPZkNoYW5uZWxzOyBjKyspIHsKICAgICAgICBjb25zdCBkYXRhID0gYnVmZmVyLmdldENoYW5uZWxEYXRhKGMpOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoTWF0aC5hYnMoZGF0YVtpXSkgPiBtYXgpCiAgICAgICAgICAgICAgICBtYXggPSBNYXRoLmFicyhkYXRhW2ldKTsKICAgICAgICB9CiAgICB9CiAgICBpZiAobWF4ID09PSAwKQogICAgICAgIHJldHVybiBidWZmZXI7CiAgICBjb25zdCBhbXAgPSAwLjk4IC8gbWF4OwogICAgY29uc3QgY3R4ID0gZ2V0QXVkaW9Db250ZXh0KCk7CiAgICBjb25zdCBuZXdCdWZmZXIgPSBjdHguY3JlYXRlQnVmZmVyKGJ1ZmZlci5udW1iZXJPZkNoYW5uZWxzLCBidWZmZXIubGVuZ3RoLCBidWZmZXIuc2FtcGxlUmF0ZSk7CiAgICBmb3IgKGxldCBjID0gMDsgYyA8IGJ1ZmZlci5udW1iZXJPZkNoYW5uZWxzOyBjKyspIHsKICAgICAgICBjb25zdCBvbGREYXRhID0gYnVmZmVyLmdldENoYW5uZWxEYXRhKGMpOwogICAgICAgIGNvbnN0IG5ld0RhdGEgPSBuZXdCdWZmZXIuZ2V0Q2hhbm5lbERhdGEoYyk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdEYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG5ld0RhdGFbaV0gPSBvbGREYXRhW2ldICogYW1wOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXdCdWZmZXI7Cn07CmV4cG9ydCBjb25zdCByZXNhbXBsZUJ1ZmZlciA9IGFzeW5jIChidWZmZXIsIHRhcmdldFJhdGUpID0+IHsKICAgIGlmIChidWZmZXIuc2FtcGxlUmF0ZSA9PT0gdGFyZ2V0UmF0ZSkKICAgICAgICByZXR1cm4gYnVmZmVyOwogICAgY29uc3QgY3R4ID0gbmV3IE9mZmxpbmVBdWRpb0NvbnRleHQoYnVmZmVyLm51bWJlck9mQ2hhbm5lbHMsIGJ1ZmZlci5kdXJhdGlvbiAqIHRhcmdldFJhdGUsIHRhcmdldFJhdGUpOwogICAgY29uc3Qgc291cmNlID0gY3R4LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpOwogICAgc291cmNlLmJ1ZmZlciA9IGJ1ZmZlcjsKICAgIHNvdXJjZS5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7CiAgICBzb3VyY2Uuc3RhcnQoKTsKICAgIHJldHVybiBhd2FpdCBjdHguc3RhcnRSZW5kZXJpbmcoKTsKfTsKZXhwb3J0IGNvbnN0IGFwcGx5RVEgPSBhc3luYyAoYnVmZmVyLCBwcmVzZXQpID0+IHsKICAgIC8vIFN0YW5kYXJkIEVRIHByb2Nlc3NpbmcgdXNpbmcgT2ZmbGluZUNvbnRleHQKICAgIGNvbnN0IGN0eCA9IG5ldyBPZmZsaW5lQXVkaW9Db250ZXh0KGJ1ZmZlci5udW1iZXJPZkNoYW5uZWxzLCBidWZmZXIubGVuZ3RoLCBidWZmZXIuc2FtcGxlUmF0ZSk7CiAgICBjb25zdCBzb3VyY2UgPSBjdHguY3JlYXRlQnVmZmVyU291cmNlKCk7CiAgICBzb3VyY2UuYnVmZmVyID0gYnVmZmVyOwogICAgLy8gQ3JlYXRlIGZpbHRlcnMgYmFzZWQgb24gcHJlc2V0CiAgICBjb25zdCBmaWx0ZXJzID0gW107CiAgICBjb25zdCBjcmVhdGVGaWx0ZXIgPSAodHlwZSwgZnJlcSwgZ2FpbiA9IDAsIFEgPSAxKSA9PiB7CiAgICAgICAgY29uc3QgZiA9IGN0eC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTsKICAgICAgICBmLnR5cGUgPSB0eXBlOwogICAgICAgIGYuZnJlcXVlbmN5LnZhbHVlID0gZnJlcTsKICAgICAgICBmLmdhaW4udmFsdWUgPSBnYWluOwogICAgICAgIGYuUS52YWx1ZSA9IFE7CiAgICAgICAgcmV0dXJuIGY7CiAgICB9OwogICAgc3dpdGNoIChwcmVzZXQpIHsKICAgICAgICBjYXNlICdUZWxlcGhvbmUnOgogICAgICAgICAgICBmaWx0ZXJzLnB1c2goY3JlYXRlRmlsdGVyKCdoaWdocGFzcycsIDQwMCkpOwogICAgICAgICAgICBmaWx0ZXJzLnB1c2goY3JlYXRlRmlsdGVyKCdsb3dwYXNzJywgMzAwMCkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdCYXNzIEJvb3N0JzoKICAgICAgICAgICAgZmlsdGVycy5wdXNoKGNyZWF0ZUZpbHRlcignbG93c2hlbGYnLCAxMDAsIDgpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnVHJlYmxlIEJvb3N0JzoKICAgICAgICAgICAgZmlsdGVycy5wdXNoKGNyZWF0ZUZpbHRlcignaGlnaHNoZWxmJywgMzAwMCwgOCkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdCYXNzIEN1dCc6CiAgICAgICAgICAgIGZpbHRlcnMucHVzaChjcmVhdGVGaWx0ZXIoJ2xvd3NoZWxmJywgMTAwLCAtMTIpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnVHJlYmxlIEN1dCc6CiAgICAgICAgICAgIGZpbHRlcnMucHVzaChjcmVhdGVGaWx0ZXIoJ2hpZ2hzaGVsZicsIDMwMDAsIC0xMikpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdNaWQgQm9vc3QnOgogICAgICAgICAgICBmaWx0ZXJzLnB1c2goY3JlYXRlRmlsdGVyKCdwZWFraW5nJywgMTAwMCwgNiwgMSkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdWLVNoYXBlJzogLy8gU2Nvb3AKICAgICAgICAgICAgZmlsdGVycy5wdXNoKGNyZWF0ZUZpbHRlcignbG93c2hlbGYnLCAxMDAsIDQpKTsKICAgICAgICAgICAgZmlsdGVycy5wdXNoKGNyZWF0ZUZpbHRlcigncGVha2luZycsIDEwMDAsIC02LCAxKSk7CiAgICAgICAgICAgIGZpbHRlcnMucHVzaChjcmVhdGVGaWx0ZXIoJ2hpZ2hzaGVsZicsIDMwMDAsIDQpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnTG8tRmkgUmFkaW8nOgogICAgICAgICAgICBmaWx0ZXJzLnB1c2goY3JlYXRlRmlsdGVyKCdoaWdocGFzcycsIDIwMCkpOwogICAgICAgICAgICBmaWx0ZXJzLnB1c2goY3JlYXRlRmlsdGVyKCdsb3dwYXNzJywgMjAwMCkpOwogICAgICAgICAgICBmaWx0ZXJzLnB1c2goY3JlYXRlRmlsdGVyKCdwZWFraW5nJywgMTAwMCwgMTAsIDIpKTsgLy8gUmVzb25hbnQgcGVhawogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gYnVmZmVyOwogICAgfQogICAgLy8gQ29ubmVjdCBub2RlcwogICAgbGV0IGN1cnJlbnROb2RlID0gc291cmNlOwogICAgZmlsdGVycy5mb3JFYWNoKGYgPT4gewogICAgICAgIGN1cnJlbnROb2RlLmNvbm5lY3QoZik7CiAgICAgICAgY3VycmVudE5vZGUgPSBmOwogICAgfSk7CiAgICBjdXJyZW50Tm9kZS5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7CiAgICBzb3VyY2Uuc3RhcnQoKTsKICAgIHJldHVybiBhd2FpdCBjdHguc3RhcnRSZW5kZXJpbmcoKTsKfTsKLy8gLS0tIENvcmUgRWRpdGluZyAtLS0KZXhwb3J0IGNvbnN0IHRyaW1CdWZmZXIgPSAoYnVmZmVyLCBzdGFydCwgZW5kKSA9PiB7CiAgICBjb25zdCBjdHggPSBnZXRBdWRpb0NvbnRleHQoKTsKICAgIGNvbnN0IHJhdGUgPSBidWZmZXIuc2FtcGxlUmF0ZTsKICAgIGNvbnN0IHN0YXJ0T2Zmc2V0ID0gTWF0aC5mbG9vcihzdGFydCAqIHJhdGUpOwogICAgY29uc3QgZW5kT2Zmc2V0ID0gTWF0aC5mbG9vcihlbmQgKiByYXRlKTsKICAgIGNvbnN0IGZyYW1lQ291bnQgPSBlbmRPZmZzZXQgLSBzdGFydE9mZnNldDsKICAgIGlmIChmcmFtZUNvdW50IDw9IDApCiAgICAgICAgcmV0dXJuIGN0eC5jcmVhdGVCdWZmZXIoYnVmZmVyLm51bWJlck9mQ2hhbm5lbHMsIDEsIHJhdGUpOwogICAgY29uc3QgbmV3QnVmZmVyID0gY3R4LmNyZWF0ZUJ1ZmZlcihidWZmZXIubnVtYmVyT2ZDaGFubmVscywgZnJhbWVDb3VudCwgcmF0ZSk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1ZmZlci5udW1iZXJPZkNoYW5uZWxzOyBpKyspIHsKICAgICAgICBjb25zdCBjaGFuRGF0YSA9IGJ1ZmZlci5nZXRDaGFubmVsRGF0YShpKTsKICAgICAgICBjb25zdCBuZXdDaGFuRGF0YSA9IG5ld0J1ZmZlci5nZXRDaGFubmVsRGF0YShpKTsKICAgICAgICBpZiAoc3RhcnRPZmZzZXQgPj0gMCAmJiBzdGFydE9mZnNldCA8IGNoYW5EYXRhLmxlbmd0aCkgewogICAgICAgICAgICBjb25zdCBzZWdtZW50ID0gY2hhbkRhdGEuc2xpY2Uoc3RhcnRPZmZzZXQsIHN0YXJ0T2Zmc2V0ICsgZnJhbWVDb3VudCk7CiAgICAgICAgICAgIG5ld0NoYW5EYXRhLnNldChzZWdtZW50KTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gbmV3QnVmZmVyOwp9OwpleHBvcnQgY29uc3Qgc3BsaXRCdWZmZXIgPSAoYnVmZmVyLCBzcGxpdFRpbWUpID0+IHsKICAgIGlmIChzcGxpdFRpbWUgPD0gMCB8fCBzcGxpdFRpbWUgPj0gYnVmZmVyLmR1cmF0aW9uKQogICAgICAgIHJldHVybiBudWxsOwogICAgY29uc3QgcGFydDEgPSB0cmltQnVmZmVyKGJ1ZmZlciwgMCwgc3BsaXRUaW1lKTsKICAgIGNvbnN0IHBhcnQyID0gdHJpbUJ1ZmZlcihidWZmZXIsIHNwbGl0VGltZSwgYnVmZmVyLmR1cmF0aW9uKTsKICAgIHJldHVybiBbcGFydDEsIHBhcnQyXTsKfTsKLy8gLS0tIEdlbmVyYXRpb24gLS0tCmV4cG9ydCBjb25zdCBnZW5lcmF0ZURydW1CZWF0ID0gYXN5bmMgKHN0eWxlLCBicG0sIGJhcnMpID0+IHsKICAgIGNvbnN0IHNyID0gREVGQVVMVF9TQU1QTEVfUkFURTsKICAgIGNvbnN0IGJlYXRzID0gQkVBVF9QQVRURVJOU1tzdHlsZV0gfHwgQkVBVF9QQVRURVJOU1snTWV0cm9ub21lJ107CiAgICBjb25zdCBiZWF0TGVuID0gNjAgLyBicG07CiAgICBjb25zdCBzdGVwTGVuID0gYmVhdExlbiAvIDQ7CiAgICBjb25zdCB0b3RhbER1cmF0aW9uID0gYmFycyAqIDQgKiBiZWF0TGVuOwogICAgY29uc3QgY3R4ID0gbmV3IE9mZmxpbmVBdWRpb0NvbnRleHQoMiwgTWF0aC5jZWlsKHRvdGFsRHVyYXRpb24gKiBzciksIHNyKTsKICAgIGNvbnN0IHBhdHRlcm4gPSBiZWF0c1swXTsKICAgIGNvbnN0IGNyZWF0ZVNvdW5kID0gKHR5cGUsIHRpbWUpID0+IHsKICAgICAgICBjb25zdCBvc2MgPSBjdHguY3JlYXRlT3NjaWxsYXRvcigpOwogICAgICAgIGNvbnN0IGdhaW4gPSBjdHguY3JlYXRlR2FpbigpOwogICAgICAgIG9zYy5jb25uZWN0KGdhaW4pOwogICAgICAgIGdhaW4uY29ubmVjdChjdHguZGVzdGluYXRpb24pOwogICAgICAgIGlmICh0eXBlID09PSAxKSB7IC8vIEtpY2sKICAgICAgICAgICAgb3NjLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZSgxNTAsIHRpbWUpOwogICAgICAgICAgICBvc2MuZnJlcXVlbmN5LmV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUoMC4wMSwgdGltZSArIDAuNSk7CiAgICAgICAgICAgIGdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZSgxLCB0aW1lKTsKICAgICAgICAgICAgZ2Fpbi5nYWluLmV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUoMC4wMSwgdGltZSArIDAuNSk7CiAgICAgICAgICAgIG9zYy5zdGFydCh0aW1lKTsKICAgICAgICAgICAgb3NjLnN0b3AodGltZSArIDAuNSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHR5cGUgPT09IDIpIHsgLy8gU25hcmUKICAgICAgICAgICAgb3NjLnR5cGUgPSAndHJpYW5nbGUnOwogICAgICAgICAgICBvc2MuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKDEwMCwgdGltZSk7CiAgICAgICAgICAgIGdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLjgsIHRpbWUpOwogICAgICAgICAgICBnYWluLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjAxLCB0aW1lICsgMC4yKTsKICAgICAgICAgICAgb3NjLnN0YXJ0KHRpbWUpOwogICAgICAgICAgICBvc2Muc3RvcCh0aW1lICsgMC4yKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gMykgeyAvLyBIaUhhdAogICAgICAgICAgICBvc2MudHlwZSA9ICdzcXVhcmUnOwogICAgICAgICAgICBvc2MuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKDgwMCwgdGltZSk7CiAgICAgICAgICAgIGNvbnN0IGZpbHRlciA9IGN0eC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTsKICAgICAgICAgICAgZmlsdGVyLnR5cGUgPSAnaGlnaHBhc3MnOwogICAgICAgICAgICBmaWx0ZXIuZnJlcXVlbmN5LnZhbHVlID0gNTAwMDsKICAgICAgICAgICAgb3NjLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgb3NjLmNvbm5lY3QoZmlsdGVyKTsKICAgICAgICAgICAgZmlsdGVyLmNvbm5lY3QoZ2Fpbik7CiAgICAgICAgICAgIGdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLjMsIHRpbWUpOwogICAgICAgICAgICBnYWluLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjAxLCB0aW1lICsgMC4wNSk7CiAgICAgICAgICAgIG9zYy5zdGFydCh0aW1lKTsKICAgICAgICAgICAgb3NjLnN0b3AodGltZSArIDAuMDUpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh0eXBlID09PSA0KSB7IC8vIE1ldHJvIEhpZ2gKICAgICAgICAgICAgb3NjLmZyZXF1ZW5jeS52YWx1ZSA9IDEyMDA7CiAgICAgICAgICAgIGdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLjUsIHRpbWUpOwogICAgICAgICAgICBnYWluLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjAxLCB0aW1lICsgMC4xKTsKICAgICAgICAgICAgb3NjLnN0YXJ0KHRpbWUpOwogICAgICAgICAgICBvc2Muc3RvcCh0aW1lICsgMC4xKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gNSkgeyAvLyBNZXRybyBMb3cKICAgICAgICAgICAgb3NjLmZyZXF1ZW5jeS52YWx1ZSA9IDgwMDsKICAgICAgICAgICAgZ2Fpbi5nYWluLnNldFZhbHVlQXRUaW1lKDAuNSwgdGltZSk7CiAgICAgICAgICAgIGdhaW4uZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDEsIHRpbWUgKyAwLjEpOwogICAgICAgICAgICBvc2Muc3RhcnQodGltZSk7CiAgICAgICAgICAgIG9zYy5zdG9wKHRpbWUgKyAwLjEpOwogICAgICAgIH0KICAgIH07CiAgICBmb3IgKGxldCBiID0gMDsgYiA8IGJhcnM7IGIrKykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykgewogICAgICAgICAgICBjb25zdCBzb3VuZFR5cGUgPSBwYXR0ZXJuW2ldOwogICAgICAgICAgICBpZiAoc291bmRUeXBlID4gMCkgewogICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IChiICogMTYgKyBpKSAqIHN0ZXBMZW47CiAgICAgICAgICAgICAgICBjcmVhdGVTb3VuZChzb3VuZFR5cGUsIHRpbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGF3YWl0IGN0eC5zdGFydFJlbmRlcmluZygpOwp9OwovLyAtLS0gTWl4aW5nIC0tLQpleHBvcnQgY29uc3QgbWl4VHJhY2tzID0gYXN5bmMgKHRyYWNrcywgZHVyYXRpb24pID0+IHsKICAgIGNvbnN0IGN0eCA9IG5ldyBPZmZsaW5lQXVkaW9Db250ZXh0KDIsIGR1cmF0aW9uICogREVGQVVMVF9TQU1QTEVfUkFURSwgREVGQVVMVF9TQU1QTEVfUkFURSk7CiAgICB0cmFja3MuZm9yRWFjaCh0cmFjayA9PiB7CiAgICAgICAgaWYgKHRyYWNrLmlzTXV0ZWQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCBzb3VyY2UgPSBjdHguY3JlYXRlQnVmZmVyU291cmNlKCk7CiAgICAgICAgc291cmNlLmJ1ZmZlciA9IHRyYWNrLmJ1ZmZlcjsKICAgICAgICBjb25zdCBnYWluID0gY3R4LmNyZWF0ZUdhaW4oKTsKICAgICAgICBnYWluLmdhaW4udmFsdWUgPSB0cmFjay52b2x1bWU7CiAgICAgICAgc291cmNlLmNvbm5lY3QoZ2Fpbik7CiAgICAgICAgZ2Fpbi5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7CiAgICAgICAgLy8gVXNlIHN0YXJ0KHdoZW4sIG9mZnNldCwgZHVyYXRpb24pIHRvIG1peCBzdHJpY3RseSB0aGUgdHJpbW1lZCBwYXJ0CiAgICAgICAgLy8gdHJhY2sudHJpbVN0YXJ0IGlzIHRoZSBvZmZzZXQgaW50byB0aGUgYnVmZmVyCiAgICAgICAgLy8gdHJhY2suZHVyYXRpb24gaXMgaG93IGxvbmcgdG8gcGxheQogICAgICAgIHNvdXJjZS5zdGFydCh0cmFjay5zdGFydFRpbWUsIHRyYWNrLnRyaW1TdGFydCwgdHJhY2suZHVyYXRpb24pOwogICAgfSk7CiAgICByZXR1cm4gYXdhaXQgY3R4LnN0YXJ0UmVuZGVyaW5nKCk7Cn07Ci8qKgogKiBPcHRpbWl6ZWQgV0FWIEVuY29kZXIgdGhhdCByZXR1cm5zIEFycmF5QnVmZmVyIGRpcmVjdGx5CiAqIFNhdmVzIH41MCUgUkFNIGNvbXBhcmVkIHRvIGNyZWF0aW5nIGludGVybWVkaWF0ZSBGbG9hdDMyQXJyYXlzCiAqLwpleHBvcnQgY29uc3QgZW5jb2RlV0FWQnVmZmVyID0gKGJ1ZmZlcikgPT4gewogICAgY29uc3QgbnVtQ2hhbm5lbHMgPSBidWZmZXIubnVtYmVyT2ZDaGFubmVsczsKICAgIGNvbnN0IHNhbXBsZVJhdGUgPSBidWZmZXIuc2FtcGxlUmF0ZTsKICAgIGNvbnN0IGZvcm1hdCA9IDE7IC8vIFBDTQogICAgY29uc3QgYml0RGVwdGggPSAxNjsKICAgIGNvbnN0IGJ5dGVzUGVyU2FtcGxlID0gYml0RGVwdGggLyA4OwogICAgY29uc3QgbGVuZ3RoID0gYnVmZmVyLmxlbmd0aDsKICAgIGNvbnN0IGRhdGFMZW5ndGggPSBsZW5ndGggKiBudW1DaGFubmVscyAqIGJ5dGVzUGVyU2FtcGxlOwogICAgY29uc3QgYnVmZmVyTGVuZ3RoID0gNDQgKyBkYXRhTGVuZ3RoOwogICAgY29uc3QgYXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoYnVmZmVyTGVuZ3RoKTsKICAgIGNvbnN0IHZpZXcgPSBuZXcgRGF0YVZpZXcoYXJyYXlCdWZmZXIpOwogICAgY29uc3Qgd3JpdGVTdHJpbmcgPSAob2Zmc2V0LCBzdHJpbmcpID0+IHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0cmluZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2aWV3LnNldFVpbnQ4KG9mZnNldCArIGksIHN0cmluZy5jaGFyQ29kZUF0KGkpKTsKICAgICAgICB9CiAgICB9OwogICAgd3JpdGVTdHJpbmcoMCwgJ1JJRkYnKTsKICAgIHZpZXcuc2V0VWludDMyKDQsIDM2ICsgZGF0YUxlbmd0aCwgdHJ1ZSk7CiAgICB3cml0ZVN0cmluZyg4LCAnV0FWRScpOwogICAgd3JpdGVTdHJpbmcoMTIsICdmbXQgJyk7CiAgICB2aWV3LnNldFVpbnQzMigxNiwgMTYsIHRydWUpOwogICAgdmlldy5zZXRVaW50MTYoMjAsIGZvcm1hdCwgdHJ1ZSk7CiAgICB2aWV3LnNldFVpbnQxNigyMiwgbnVtQ2hhbm5lbHMsIHRydWUpOwogICAgdmlldy5zZXRVaW50MzIoMjQsIHNhbXBsZVJhdGUsIHRydWUpOwogICAgdmlldy5zZXRVaW50MzIoMjgsIHNhbXBsZVJhdGUgKiBudW1DaGFubmVscyAqIGJ5dGVzUGVyU2FtcGxlLCB0cnVlKTsKICAgIHZpZXcuc2V0VWludDE2KDMyLCBudW1DaGFubmVscyAqIGJ5dGVzUGVyU2FtcGxlLCB0cnVlKTsKICAgIHZpZXcuc2V0VWludDE2KDM0LCBiaXREZXB0aCwgdHJ1ZSk7CiAgICB3cml0ZVN0cmluZygzNiwgJ2RhdGEnKTsKICAgIHZpZXcuc2V0VWludDMyKDQwLCBkYXRhTGVuZ3RoLCB0cnVlKTsKICAgIGxldCBvZmZzZXQgPSA0NDsKICAgIC8vIFJlYWQgZGlyZWN0bHkgZnJvbSBjaGFubmVscyB0byBhdm9pZCBjcmVhdGluZyBsYXJnZSBpbnRlcmxlYXZlZCBidWZmZXIKICAgIGNvbnN0IGNoYW5uZWxzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNoYW5uZWxzOyBpKyspIHsKICAgICAgICBjaGFubmVscy5wdXNoKGJ1ZmZlci5nZXRDaGFubmVsRGF0YShpKSk7CiAgICB9CiAgICAvLyBJbnRlcmxlYXZlIGFuZCBXcml0ZQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGNoID0gMDsgY2ggPCBudW1DaGFubmVsczsgY2grKykgewogICAgICAgICAgICBjb25zdCBzYW1wbGUgPSBjaGFubmVsc1tjaF1baV07CiAgICAgICAgICAgIC8vIENsYW1wIGFuZCBzY2FsZQogICAgICAgICAgICBjb25zdCBzID0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsIHNhbXBsZSkpOwogICAgICAgICAgICAvLyBDb252ZXJ0IHRvIDE2LWJpdCBQQ00KICAgICAgICAgICAgdmlldy5zZXRJbnQxNihvZmZzZXQsIHMgPCAwID8gcyAqIDB4ODAwMCA6IHMgKiAweDdGRkYsIHRydWUpOwogICAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gYXJyYXlCdWZmZXI7Cn07CmV4cG9ydCBjb25zdCBlbmNvZGVXQVYgPSAoYnVmZmVyKSA9PiB7CiAgICByZXR1cm4gbmV3IEJsb2IoW2VuY29kZVdBVkJ1ZmZlcihidWZmZXIpXSwgeyB0eXBlOiAnYXVkaW8vd2F2JyB9KTsKfTsKLyoqCiAqIE1QMyBFbmNvZGVyIHVzaW5nIGxhbWVqcwogKi8KZXhwb3J0IGNvbnN0IGVuY29kZU1QMyA9IChidWZmZXIpID0+IHsKICAgIGNvbnN0IGxhbWUgPSB3aW5kb3cubGFtZWpzOwogICAgaWYgKCFsYW1lKQogICAgICAgIHRocm93IG5ldyBFcnJvcigiTVAzIEVuY29kZXIgbm90IGxvYWRlZCIpOwogICAgY29uc3QgY2hhbm5lbHMgPSBidWZmZXIubnVtYmVyT2ZDaGFubmVsczsKICAgIGNvbnN0IHNhbXBsZVJhdGUgPSBidWZmZXIuc2FtcGxlUmF0ZTsKICAgIGNvbnN0IGticHMgPSAxMjg7CiAgICAvLyBDcmVhdGUgRW5jb2RlcgogICAgY29uc3QgbXAzRW5jb2RlciA9IG5ldyBsYW1lLk1wM0VuY29kZXIoY2hhbm5lbHMsIHNhbXBsZVJhdGUsIGticHMpOwogICAgLy8gR2V0IERhdGEKICAgIGNvbnN0IHNhbXBsZXNMID0gYnVmZmVyLmdldENoYW5uZWxEYXRhKDApOwogICAgY29uc3Qgc2FtcGxlc1IgPSBjaGFubmVscyA+IDEgPyBidWZmZXIuZ2V0Q2hhbm5lbERhdGEoMSkgOiB1bmRlZmluZWQ7CiAgICAvLyBDb252ZXJ0IEZsb2F0MzIgWy0xLCAxXSB0byBJbnQxNiBbLTMyNzY4LCAzMjc2N10KICAgIGNvbnN0IGNvbnZlcnRUb0ludDE2ID0gKGRhdGEpID0+IHsKICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgSW50MTZBcnJheShkYXRhLmxlbmd0aCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSBNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwgZGF0YVtpXSkpOwogICAgICAgICAgICByZXN1bHRbaV0gPSBzIDwgMCA/IHMgKiAweDgwMDAgOiBzICogMHg3RkZGOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgIGNvbnN0IGludDE2TCA9IGNvbnZlcnRUb0ludDE2KHNhbXBsZXNMKTsKICAgIGNvbnN0IGludDE2UiA9IHNhbXBsZXNSID8gY29udmVydFRvSW50MTYoc2FtcGxlc1IpIDogdW5kZWZpbmVkOwogICAgY29uc3QgbXAzRGF0YSA9IFtdOwogICAgLy8gRW5jb2RlCiAgICBjb25zdCBtcDNidWYgPSBtcDNFbmNvZGVyLmVuY29kZUJ1ZmZlcihpbnQxNkwsIGludDE2Uik7CiAgICBpZiAobXAzYnVmLmxlbmd0aCA+IDApCiAgICAgICAgbXAzRGF0YS5wdXNoKG1wM2J1Zik7CiAgICAvLyBGbHVzaAogICAgY29uc3QgZmx1c2ggPSBtcDNFbmNvZGVyLmZsdXNoKCk7CiAgICBpZiAoZmx1c2gubGVuZ3RoID4gMCkKICAgICAgICBtcDNEYXRhLnB1c2goZmx1c2gpOwogICAgcmV0dXJuIG5ldyBCbG9iKG1wM0RhdGEsIHsgdHlwZTogJ2F1ZGlvL21wMycgfSk7Cn07Cg==","@/services/geminiService":"data:application/javascript;base64,aW1wb3J0IHsgR29vZ2xlR2VuQUksIE1vZGFsaXR5IH0gZnJvbSAiQGdvb2dsZS9nZW5haSI7CmltcG9ydCB7IGRlY29kZUF1ZGlvRGF0YSB9IGZyb20gIkAvc2VydmljZXMvYXVkaW9VdGlscyI7Ci8vIEVuc3VyZSBBUEkgS2V5IGlzIHByZXNlbnQKY29uc3QgQVBJX0tFWSA9IHByb2Nlc3MuZW52LkFQSV9LRVkgfHwgJyc7CmNvbnN0IGFpID0gbmV3IEdvb2dsZUdlbkFJKHsgYXBpS2V5OiBBUElfS0VZIH0pOwovLyBIZWxwZXIgdG8gZGVjb2RlIEJhc2U2NCB0byBBcnJheUJ1ZmZlcgpmdW5jdGlvbiBiYXNlNjRUb0FycmF5QnVmZmVyKGJhc2U2NCkgewogICAgY29uc3QgYmluYXJ5U3RyaW5nID0gd2luZG93LmF0b2IoYmFzZTY0KTsKICAgIGNvbnN0IGxlbiA9IGJpbmFyeVN0cmluZy5sZW5ndGg7CiAgICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGxlbik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlTdHJpbmcuY2hhckNvZGVBdChpKTsKICAgIH0KICAgIHJldHVybiBieXRlcy5idWZmZXI7Cn0KZXhwb3J0IGNvbnN0IGdlbmVyYXRlU3BlZWNoID0gYXN5bmMgKHRleHQsIHZvaWNlTmFtZSA9ICdLb3JlJykgPT4gewogICAgaWYgKCFBUElfS0VZKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIEFQSSBLZXkiKTsKICAgIH0KICAgIHRyeSB7CiAgICAgICAgY29uc29sZS5sb2coIkdlbmVyYXRpbmcgc3BlZWNoIGZvcjoiLCB0ZXh0LnN1YnN0cmluZygwLCAyMCkgKyAiLi4uIik7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhaS5tb2RlbHMuZ2VuZXJhdGVDb250ZW50KHsKICAgICAgICAgICAgbW9kZWw6ICJnZW1pbmktMi41LWZsYXNoLXByZXZpZXctdHRzIiwKICAgICAgICAgICAgY29udGVudHM6IFt7IHBhcnRzOiBbeyB0ZXh0OiB0ZXh0IH1dIH1dLAogICAgICAgICAgICBjb25maWc6IHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlTW9kYWxpdGllczogW01vZGFsaXR5LkFVRElPXSwKICAgICAgICAgICAgICAgIHNwZWVjaENvbmZpZzogewogICAgICAgICAgICAgICAgICAgIHZvaWNlQ29uZmlnOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZWJ1aWx0Vm9pY2VDb25maWc6IHsgdm9pY2VOYW1lOiB2b2ljZU5hbWUgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgICAgICAvLyBSb2J1c3RseSBjaGVjayBmb3IgYXVkaW8gZGF0YQogICAgICAgIGNvbnN0IGNhbmRpZGF0ZXMgPSByZXNwb25zZS5jYW5kaWRhdGVzOwogICAgICAgIGlmICghY2FuZGlkYXRlcyB8fCBjYW5kaWRhdGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGNhbmRpZGF0ZXMgcmV0dXJuZWQgZnJvbSBHZW1pbmkiKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcGFydHMgPSBjYW5kaWRhdGVzWzBdLmNvbnRlbnQ/LnBhcnRzOwogICAgICAgIGlmICghcGFydHMgfHwgcGFydHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29udGVudCBwYXJ0cyByZXR1cm5lZCIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBiYXNlNjRBdWRpbyA9IHBhcnRzWzBdLmlubGluZURhdGE/LmRhdGE7CiAgICAgICAgaWYgKCFiYXNlNjRBdWRpbykgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJGdWxsIFJlc3BvbnNlOiIsIHJlc3BvbnNlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBpbmxpbmUgYXVkaW8gZGF0YSBmb3VuZCBpbiByZXNwb25zZSIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBhdWRpb0RhdGEgPSBiYXNlNjRUb0FycmF5QnVmZmVyKGJhc2U2NEF1ZGlvKTsKICAgICAgICByZXR1cm4gYXdhaXQgZGVjb2RlQXVkaW9EYXRhKGF1ZGlvRGF0YSk7CiAgICB9CiAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJHZW1pbmkgVFRTIEVycm9yIERldGFpbHM6IiwgZXJyb3IpOwogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlIHx8ICJGYWlsZWQgdG8gZ2VuZXJhdGUgc3BlZWNoIik7CiAgICB9Cn07CmV4cG9ydCBjb25zdCBzdWdnZXN0Vm9pY2VvdmVyU2NyaXB0ID0gYXN5bmMgKGNvbnRleHREZXNjcmlwdGlvbikgPT4gewogICAgdHJ5IHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFpLm1vZGVscy5nZW5lcmF0ZUNvbnRlbnQoewogICAgICAgICAgICBtb2RlbDogImdlbWluaS0yLjUtZmxhc2giLAogICAgICAgICAgICBjb250ZW50czogYFdyaXRlIGEgc2hvcnQsIGNyZWF0aXZlIHZvaWNlb3ZlciBzY3JpcHQgKG1heCAyMCB3b3JkcykgZm9yIGEgc29uZyBkZXNjcmliZWQgYXM6ICR7Y29udGV4dERlc2NyaXB0aW9ufS4gcmV0dXJuIE9OTFkgdGhlIHRleHQuYCwKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dCB8fCAiIjsKICAgIH0KICAgIGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkdlbWluaSBTY3JpcHQgR2VuIEVycm9yOiIsIGVycm9yKTsKICAgICAgICByZXR1cm4gIk11c2ljIGlzIGxpZmUuIjsKICAgIH0KfTsK","@/components/Button":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmNvbnN0IEJ1dHRvbiA9ICh7IHZhcmlhbnQgPSAncHJpbWFyeScsIGljb24sIGxhYmVsLCBmdWxsV2lkdGggPSBmYWxzZSwgY2xhc3NOYW1lID0gJycsIGNoaWxkcmVuLCAuLi5wcm9wcyB9KSA9PiB7CiAgICBjb25zdCBiYXNlU3R5bGVzID0gImlubGluZS1mbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBweC00IHB5LTMgcm91bmRlZC14bCBmb250LW1lZGl1bSB0cmFuc2l0aW9uLWFsbCBhY3RpdmU6c2NhbGUtOTUgZGlzYWJsZWQ6b3BhY2l0eS01MCBkaXNhYmxlZDpwb2ludGVyLWV2ZW50cy1ub25lIHRvdWNoLW1hbmlwdWxhdGlvbiI7CiAgICBjb25zdCB2YXJpYW50cyA9IHsKICAgICAgICBwcmltYXJ5OiAiYmctY3lhbi01MDAgaG92ZXI6YmctY3lhbi00MDAgdGV4dC1ibGFjayBzaGFkb3ctbGcgc2hhZG93LWN5YW4tNTAwLzIwIiwKICAgICAgICBzZWNvbmRhcnk6ICJiZy16aW5jLTgwMCBob3ZlcjpiZy16aW5jLTcwMCB0ZXh0LXppbmMtMTAwIGJvcmRlciBib3JkZXItemluYy03MDAiLAogICAgICAgIGRhbmdlcjogImJnLXJlZC01MDAvMTAgaG92ZXI6YmctcmVkLTUwMC8yMCB0ZXh0LXJlZC00MDAgYm9yZGVyIGJvcmRlci1yZWQtNTAwLzUwIiwKICAgICAgICBnaG9zdDogImJnLXRyYW5zcGFyZW50IGhvdmVyOmJnLXppbmMtODAwLzUwIHRleHQtemluYy00MDAgaG92ZXI6dGV4dC16aW5jLTIwMCIKICAgIH07CiAgICBjb25zdCB3aWR0aENsYXNzID0gZnVsbFdpZHRoID8gJ3ctZnVsbCcgOiAnJzsKICAgIHJldHVybiAoX2pzeHMoImJ1dHRvbiIsIHsgY2xhc3NOYW1lOiBgJHtiYXNlU3R5bGVzfSAke3ZhcmlhbnRzW3ZhcmlhbnRdfSAke3dpZHRoQ2xhc3N9ICR7Y2xhc3NOYW1lfWAsIC4uLnByb3BzLCBjaGlsZHJlbjogW2ljb24gJiYgX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiBsYWJlbCB8fCBjaGlsZHJlbiA/ICJtci0yIiA6ICIiLCBjaGlsZHJlbjogaWNvbiB9KSwgbGFiZWwgfHwgY2hpbGRyZW5dIH0pKTsKfTsKZXhwb3J0IGRlZmF1bHQgQnV0dG9uOwo=","@/components/WaveformDisplay":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3ggfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCwgeyB1c2VSZWYsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgU0VMRUNUSU9OX0NPTE9SLCBQTEFZSEVBRF9DT0xPUiB9IGZyb20gJ0AvY29uc3RhbnRzJzsKY29uc3QgZGFya2VuQ29sb3IgPSAoaGV4LCBwZXJjZW50KSA9PiB7CiAgICBsZXQgbnVtID0gcGFyc2VJbnQoaGV4LnJlcGxhY2UoIiMiLCAiIiksIDE2KSwgYW10ID0gTWF0aC5yb3VuZCgyLjU1ICogcGVyY2VudCksIFIgPSAobnVtID4+IDE2KSAtIGFtdCwgRyA9IChudW0gPj4gOCAmIDB4MDBGRikgLSBhbXQsIEIgPSAobnVtICYgMHgwMDAwRkYpIC0gYW10OwogICAgcmV0dXJuICIjIiArICgweDEwMDAwMDAgKyAoUiA8IDI1NSA/IFIgPCAxID8gMCA6IFIgOiAyNTUpICogMHgxMDAwMCArIChHIDwgMjU1ID8gRyA8IDEgPyAwIDogRyA6IDI1NSkgKiAweDEwMCArIChCIDwgMjU1ID8gQiA8IDEgPyAwIDogQiA6IDI1NSkpLnRvU3RyaW5nKDE2KS5zbGljZSgxKTsKfTsKY29uc3QgV2F2ZWZvcm1EaXNwbGF5ID0gKHsgYnVmZmVyLCBjdXJyZW50VGltZSwgc3RhcnRUaW1lLCB0cmltU3RhcnQsIGR1cmF0aW9uLCBzZWxlY3Rpb24sIGNvbG9yLCB6b29tLCBvblNlbGVjdGlvbkNoYW5nZSwgY29sb3JPdmVycmlkZSwgZmFkZUluRHVyYXRpb24gPSAwLCBmYWRlT3V0RHVyYXRpb24gPSAwIH0pID0+IHsKICAgIGNvbnN0IGNvbnRhaW5lclJlZiA9IHVzZVJlZihudWxsKTsKICAgIGNvbnN0IGNhbnZhc1JlZiA9IHVzZVJlZihudWxsKTsKICAgIC8vIENvbXB1dGVkIGRpbWVuc2lvbnMgYmFzZWQgb24gem9vbSBhbmQgdmlzaWJsZSBkdXJhdGlvbgogICAgY29uc3Qgd2lkdGggPSBNYXRoLm1heCgxLCBNYXRoLmNlaWwoZHVyYXRpb24gKiB6b29tKSk7CiAgICBjb25zdCBoZWlnaHQgPSA4MDsKICAgIC8vIERyYXcgbG9vcAogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICBjb25zdCBjYW52YXMgPSBjYW52YXNSZWYuY3VycmVudDsKICAgICAgICBjb25zdCBjdHggPSBjYW52YXM/LmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgaWYgKCFjYW52YXMgfHwgIWN0eCB8fCAhYnVmZmVyKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgLy8gUmVzZXQgY2FudmFzIGRpbWVuc2lvbnMgZm9yIGhpZ2ggRFBJCiAgICAgICAgY29uc3QgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTsKICAgICAgICBpZiAoY2FudmFzLndpZHRoICE9PSB3aWR0aCAqIGRwciB8fCBjYW52YXMuaGVpZ2h0ICE9PSBoZWlnaHQgKiBkcHIpIHsKICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGggKiBkcHI7CiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQgKiBkcHI7CiAgICAgICAgICAgIGN0eC5zY2FsZShkcHIsIGRwcik7CiAgICAgICAgfQogICAgICAgIC8vIENsZWFyCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAvLyBEcmF3IFdhdmVmb3JtIC0gU2xpY2UgbG9naWMKICAgICAgICBjb25zdCBkYXRhID0gYnVmZmVyLmdldENoYW5uZWxEYXRhKDApOwogICAgICAgIC8vIFdlIG9ubHkgcmVuZGVyIHBpeGVscyBjb3JyZXNwb25kaW5nIHRvIHRoZSB0cmltbWVkIHNlY3Rpb24KICAgICAgICBjb25zdCBzdGFydFNhbXBsZSA9IE1hdGguZmxvb3IodHJpbVN0YXJ0ICogYnVmZmVyLnNhbXBsZVJhdGUpOwogICAgICAgIGNvbnN0IHZpc2libGVTYW1wbGVzID0gTWF0aC5mbG9vcihkdXJhdGlvbiAqIGJ1ZmZlci5zYW1wbGVSYXRlKTsKICAgICAgICAvLyBTdGVwIHNpemU6IEhvdyBtYW55IHNhbXBsZXMgcGVyIHBpeGVsCiAgICAgICAgY29uc3Qgc3RlcCA9IE1hdGguY2VpbCh2aXNpYmxlU2FtcGxlcyAvIHdpZHRoKTsKICAgICAgICBjb25zdCBhbXAgPSBoZWlnaHQgLyAyOwogICAgICAgIGlmIChjb2xvck92ZXJyaWRlKSB7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvck92ZXJyaWRlOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGdyYWRpZW50ID0gY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDAsIGhlaWdodCk7CiAgICAgICAgICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMCwgY29sb3IpOwogICAgICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsIGRhcmtlbkNvbG9yKGNvbG9yLCA0MCkpOwogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdyYWRpZW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2lkdGg7IGkrKykgewogICAgICAgICAgICAvLyBUaW1lIHJlbGF0aXZlIHRvIHRoZSBTVEFSVCBvZiB0aGUgdmlzaWJsZSBjbGlwCiAgICAgICAgICAgIGNvbnN0IHQgPSBpIC8gem9vbTsKICAgICAgICAgICAgbGV0IG1pbiA9IDEuMDsKICAgICAgICAgICAgbGV0IG1heCA9IC0xLjA7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBpbmRleCByZWxhdGl2ZSB0byB0aGUgdHJpbVN0YXJ0CiAgICAgICAgICAgIGNvbnN0IGRhdGFJbmRleCA9IHN0YXJ0U2FtcGxlICsgTWF0aC5mbG9vcihpICogc3RlcCk7CiAgICAgICAgICAgIGlmIChkYXRhSW5kZXggPj0gZGF0YS5sZW5ndGgpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgLy8gU2FtcGxpbmcKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzdGVwOyBqKyspIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhSW5kZXggKyBqID49IGRhdGEubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY29uc3QgZGF0dW0gPSBkYXRhW2RhdGFJbmRleCArIGpdOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtIDwgbWluKQogICAgICAgICAgICAgICAgICAgIG1pbiA9IGRhdHVtOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtID4gbWF4KQogICAgICAgICAgICAgICAgICAgIG1heCA9IGRhdHVtOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtaW4gPT09IDEuMCAmJiBtYXggPT09IC0xLjApIHsKICAgICAgICAgICAgICAgIG1pbiA9IDA7CiAgICAgICAgICAgICAgICBtYXggPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEFwcGx5IFZpc3VhbCBHYWluIGZvciBGYWRlcwogICAgICAgICAgICBsZXQgZ2FpbiA9IDEuMDsKICAgICAgICAgICAgLy8gRmFkZSBJbgogICAgICAgICAgICBpZiAoZmFkZUluRHVyYXRpb24gPiAwICYmIHQgPCBmYWRlSW5EdXJhdGlvbikgewogICAgICAgICAgICAgICAgZ2FpbiAqPSAodCAvIGZhZGVJbkR1cmF0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBGYWRlIE91dAogICAgICAgICAgICBpZiAoZmFkZU91dER1cmF0aW9uID4gMCAmJiB0ID4gKGR1cmF0aW9uIC0gZmFkZU91dER1cmF0aW9uKSkgewogICAgICAgICAgICAgICAgY29uc3QgdGltZUZyb21FbmQgPSBkdXJhdGlvbiAtIHQ7CiAgICAgICAgICAgICAgICBnYWluICo9ICh0aW1lRnJvbUVuZCAvIGZhZGVPdXREdXJhdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQ2xhbXAgZ2FpbgogICAgICAgICAgICBnYWluID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgZ2FpbikpOwogICAgICAgICAgICBtaW4gKj0gZ2FpbjsKICAgICAgICAgICAgbWF4ICo9IGdhaW47CiAgICAgICAgICAgIGN0eC5maWxsUmVjdChpLCAoMSArIG1pbikgKiBhbXAsIDEsIE1hdGgubWF4KDEsIChtYXggLSBtaW4pICogYW1wKSk7CiAgICAgICAgfQogICAgICAgIC8vIERyYXcgU2VsZWN0aW9uCiAgICAgICAgaWYgKHNlbGVjdGlvbikgewogICAgICAgICAgICBjb25zdCB0cmFja0VuZCA9IHN0YXJ0VGltZSArIGR1cmF0aW9uOwogICAgICAgICAgICBpZiAoc2VsZWN0aW9uLmVuZCA+IHN0YXJ0VGltZSAmJiBzZWxlY3Rpb24uc3RhcnQgPCB0cmFja0VuZCkgewogICAgICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVTdGFydCA9IE1hdGgubWF4KDAsIHNlbGVjdGlvbi5zdGFydCAtIHN0YXJ0VGltZSk7CiAgICAgICAgICAgICAgICBjb25zdCByZWxhdGl2ZUVuZCA9IE1hdGgubWluKGR1cmF0aW9uLCBzZWxlY3Rpb24uZW5kIC0gc3RhcnRUaW1lKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0UHggPSByZWxhdGl2ZVN0YXJ0ICogem9vbTsKICAgICAgICAgICAgICAgIGNvbnN0IGVuZFB4ID0gcmVsYXRpdmVFbmQgKiB6b29tOwogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFNFTEVDVElPTl9DT0xPUjsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChzdGFydFB4LCAwLCBlbmRQeCAtIHN0YXJ0UHgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmYnOwogICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHN0YXJ0UHgsIDAsIDEsIGhlaWdodCk7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoZW5kUHgsIDAsIDEsIGhlaWdodCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gRHJhdyBQbGF5aGVhZAogICAgICAgIGlmIChjdXJyZW50VGltZSA+PSBzdGFydFRpbWUgJiYgY3VycmVudFRpbWUgPD0gc3RhcnRUaW1lICsgZHVyYXRpb24pIHsKICAgICAgICAgICAgY29uc3QgbG9jYWxUaW1lID0gY3VycmVudFRpbWUgLSBzdGFydFRpbWU7CiAgICAgICAgICAgIGNvbnN0IHBsYXloZWFkWCA9IGxvY2FsVGltZSAqIHpvb207CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBQTEFZSEVBRF9DT0xPUjsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHBsYXloZWFkWCwgMCwgMiwgaGVpZ2h0KTsKICAgICAgICB9CiAgICB9LCBbYnVmZmVyLCBjdXJyZW50VGltZSwgc3RhcnRUaW1lLCB0cmltU3RhcnQsIGR1cmF0aW9uLCBzZWxlY3Rpb24sIHdpZHRoLCBoZWlnaHQsIGNvbG9yLCB6b29tLCBjb2xvck92ZXJyaWRlLCBmYWRlSW5EdXJhdGlvbiwgZmFkZU91dER1cmF0aW9uXSk7CiAgICByZXR1cm4gKF9qc3goImRpdiIsIHsgcmVmOiBjb250YWluZXJSZWYsIHN0eWxlOiB7IHdpZHRoOiBgJHt3aWR0aH1weGAsIGhlaWdodDogYCR7aGVpZ2h0fXB4YCB9LCBjbGFzc05hbWU6IGByZWxhdGl2ZSBzaHJpbmstMCByb3VuZGVkLWxnIG92ZXJmbG93LWhpZGRlbiAke2NvbG9yT3ZlcnJpZGUgPyAnJyA6ICdyaW5nLTEgcmluZy13aGl0ZS81J31gLCBjaGlsZHJlbjogX2pzeCgiY2FudmFzIiwgeyByZWY6IGNhbnZhc1JlZiwgc3R5bGU6IHsgd2lkdGg6ICcxMDAlJywgaGVpZ2h0OiAnMTAwJScgfSB9KSB9KSk7Cn07CmV4cG9ydCBkZWZhdWx0IFdhdmVmb3JtRGlzcGxheTsK","@/components/AIGeneratorModal":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IEJ1dHRvbiBmcm9tICdAL2NvbXBvbmVudHMvQnV0dG9uJzsKaW1wb3J0IHsgZ2VuZXJhdGVTcGVlY2gsIHN1Z2dlc3RWb2ljZW92ZXJTY3JpcHQgfSBmcm9tICdAL3NlcnZpY2VzL2dlbWluaVNlcnZpY2UnOwpjb25zdCBBSUdlbmVyYXRvck1vZGFsID0gKHsgaXNPcGVuLCBvbkNsb3NlLCBvbkdlbmVyYXRlIH0pID0+IHsKICAgIGNvbnN0IFtwcm9tcHQsIHNldFByb21wdF0gPSB1c2VTdGF0ZSgnJyk7CiAgICBjb25zdCBbaXNHZW5lcmF0aW5nLCBzZXRJc0dlbmVyYXRpbmddID0gdXNlU3RhdGUoZmFsc2UpOwogICAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZShudWxsKTsKICAgIGlmICghaXNPcGVuKQogICAgICAgIHJldHVybiBudWxsOwogICAgY29uc3QgaGFuZGxlU3VnZ2VzdCA9IGFzeW5jICgpID0+IHsKICAgICAgICBzZXRJc0dlbmVyYXRpbmcodHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3Qgc2NyaXB0ID0gYXdhaXQgc3VnZ2VzdFZvaWNlb3ZlclNjcmlwdCgiQSBjb29sIGludHJvIGZvciBhIHBvZGNhc3QgYWJvdXQgdGVjaG5vbG9neSIpOwogICAgICAgICAgICBzZXRQcm9tcHQoc2NyaXB0KTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgc2V0RXJyb3IoIkZhaWxlZCB0byBzdWdnZXN0IHNjcmlwdCIpOwogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgc2V0SXNHZW5lcmF0aW5nKGZhbHNlKTsKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgaGFuZGxlR2VuZXJhdGUgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgaWYgKCFwcm9tcHQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBzZXRJc0dlbmVyYXRpbmcodHJ1ZSk7CiAgICAgICAgc2V0RXJyb3IobnVsbCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gYXdhaXQgZ2VuZXJhdGVTcGVlY2gocHJvbXB0KTsKICAgICAgICAgICAgb25HZW5lcmF0ZShidWZmZXIpOwogICAgICAgICAgICBvbkNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgIHNldEVycm9yKGUubWVzc2FnZSB8fCAiR2VuZXJhdGlvbiBmYWlsZWQuIFRyeSBhZ2Fpbi4iKTsKICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHNldElzR2VuZXJhdGluZyhmYWxzZSk7CiAgICAgICAgfQogICAgfTsKICAgIHJldHVybiAoX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJmaXhlZCBpbnNldC0wIHotNTAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcC00IGJnLWJsYWNrLzgwIGJhY2tkcm9wLWJsdXItc20iLCBjaGlsZHJlbjogX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiYmctemluYy05MDAgYm9yZGVyIGJvcmRlci16aW5jLTcwMCByb3VuZGVkLTJ4bCB3LWZ1bGwgbWF4LXctbWQgcC02IHNoYWRvdy0yeGwgc3BhY2UteS00IiwgY2hpbGRyZW46IFtfanN4KCJoMiIsIHsgY2xhc3NOYW1lOiAidGV4dC14bCBmb250LWJvbGQgdGV4dC13aGl0ZSIsIGNoaWxkcmVuOiAiR2VuZXJhdGUgVm9pY2VvdmVyIiB9KSwgX2pzeCgicCIsIHsgY2xhc3NOYW1lOiAidGV4dC16aW5jLTQwMCB0ZXh0LXNtIiwgY2hpbGRyZW46ICJVc2UgR2VtaW5pIHRvIGdlbmVyYXRlIGhpZ2gtcXVhbGl0eSBzcGVlY2ggZm9yIHlvdXIgdHJhY2suIiB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAic3BhY2UteS0yIiwgY2hpbGRyZW46IFtfanN4KCJsYWJlbCIsIHsgY2xhc3NOYW1lOiAidGV4dC14cyBmb250LXNlbWlib2xkIHRleHQtemluYy01MDAgdXBwZXJjYXNlIiwgY2hpbGRyZW46ICJTY3JpcHQiIH0pLCBfanN4KCJ0ZXh0YXJlYSIsIHsgdmFsdWU6IHByb21wdCwgb25DaGFuZ2U6IChlKSA9PiBzZXRQcm9tcHQoZS50YXJnZXQudmFsdWUpLCBwbGFjZWhvbGRlcjogIkVudGVyIHRleHQgdG8gc3BlYWsuLi4iLCBjbGFzc05hbWU6ICJ3LWZ1bGwgaC0zMiBiZy16aW5jLTk1MCBib3JkZXIgYm9yZGVyLXppbmMtODAwIHJvdW5kZWQteGwgcC0zIHRleHQtemluYy0yMDAgZm9jdXM6b3V0bGluZS1ub25lIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLWN5YW4tNTAwIHJlc2l6ZS1ub25lIiB9KV0gfSksIGVycm9yICYmIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAidGV4dC1yZWQtNDAwIHRleHQtc20iLCBjaGlsZHJlbjogZXJyb3IgfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBnYXAtMiIsIGNoaWxkcmVuOiBfanN4KEJ1dHRvbiwgeyB2YXJpYW50OiAic2Vjb25kYXJ5Iiwgb25DbGljazogaGFuZGxlU3VnZ2VzdCwgZGlzYWJsZWQ6IGlzR2VuZXJhdGluZywgbGFiZWw6IGlzR2VuZXJhdGluZyA/ICJUaGlua2luZy4uLiIgOiAiU3VnZ2VzdCBTY3JpcHQiLCBjbGFzc05hbWU6ICJmbGV4LTEgdGV4dC1zbSIgfSkgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZ2FwLTMgcHQtNCBib3JkZXItdCBib3JkZXItemluYy04MDAiLCBjaGlsZHJlbjogW19qc3goQnV0dG9uLCB7IHZhcmlhbnQ6ICJnaG9zdCIsIG9uQ2xpY2s6IG9uQ2xvc2UsIGxhYmVsOiAiQ2FuY2VsIiB9KSwgX2pzeChCdXR0b24sIHsgdmFyaWFudDogInByaW1hcnkiLCBvbkNsaWNrOiBoYW5kbGVHZW5lcmF0ZSwgZGlzYWJsZWQ6ICFwcm9tcHQgfHwgaXNHZW5lcmF0aW5nLCBsYWJlbDogaXNHZW5lcmF0aW5nID8gIkdlbmVyYXRpbmcuLi4iIDogIkFkZCB0byBUcmFjayIsIGNsYXNzTmFtZTogImZsZXgtMSIgfSldIH0pXSB9KSB9KSk7Cn07CmV4cG9ydCBkZWZhdWx0IEFJR2VuZXJhdG9yTW9kYWw7Cg==","@/App":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMsIEZyYWdtZW50IGFzIF9GcmFnbWVudCB9IGZyb20gInJlYWN0L2pzeC1ydW50aW1lIjsKaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZVJlZiwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7CmltcG9ydCBXYXZlZm9ybURpc3BsYXkgZnJvbSAnQC9jb21wb25lbnRzL1dhdmVmb3JtRGlzcGxheSc7CmltcG9ydCBCdXR0b24gZnJvbSAnQC9jb21wb25lbnRzL0J1dHRvbic7CmltcG9ydCBCZWF0TWFrZXJNb2RhbCBmcm9tICdAL2NvbXBvbmVudHMvQmVhdE1ha2VyTW9kYWwnOwppbXBvcnQgRWZmZWN0c01vZGFsIGZyb20gJ0AvY29tcG9uZW50cy9FZmZlY3RzTW9kYWwnOwppbXBvcnQgRXhwb3J0TW9kYWwgZnJvbSAnQC9jb21wb25lbnRzL0V4cG9ydE1vZGFsJzsKaW1wb3J0IHsgZ2V0QXVkaW9Db250ZXh0LCBkZWNvZGVBdWRpb0RhdGEsIGVuY29kZVdBViwgZW5jb2RlTVAzLCBhcHBseUZhZGUsIG1lcmdlQnVmZmVycywgY2hhbmdlU3BlZWQsIHJldmVyc2VCdWZmZXIsIG5vcm1hbGl6ZUJ1ZmZlciwgcmVzYW1wbGVCdWZmZXIsIGFwcGx5RVEsIG1peFRyYWNrcywgZ2VuZXJhdGVQcm9qZWN0UHJldmlldywgZGV0ZWN0QlBNIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdWRpb1V0aWxzJzsKaW1wb3J0IHsgc2F2ZVByb2plY3QsIGxvYWRQcm9qZWN0cywgbG9hZFByb2plY3RUcmFja3MsIGRlbGV0ZVByb2plY3QsIHVwZGF0ZVByb2plY3ROYW1lIH0gZnJvbSAnQC9zZXJ2aWNlcy9zdG9yYWdlU2VydmljZSc7CmltcG9ydCB7IEFwcFN0YXRlIH0gZnJvbSAnQC90eXBlcyc7CmltcG9ydCB7IERFRkFVTFRfWk9PTSwgTUFYX1pPT00sIE1JTl9aT09NLCBUUkFDS19DT0xPUlMsIExBTkVfSEVJR0hULCBTTkFQX1RIUkVTSE9MRF9QWCB9IGZyb20gJ0AvY29uc3RhbnRzJzsKLy8gSWNvbnMKY29uc3QgUGxheUljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctOCBoLTggdHJhbnNsYXRlLXgtMC41IiwgZmlsbDogImN1cnJlbnRDb2xvciIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgZDogIk04IDV2MTRsMTEtN3oiIH0pIH0pOwpjb25zdCBQYXVzZUljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctOCBoLTgiLCBmaWxsOiAiY3VycmVudENvbG9yIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBfanN4KCJwYXRoIiwgeyBkOiAiTTYgMTloNFY1SDZ2MTR6bTgtMTR2MTRoNFY1aC00eiIgfSkgfSk7CmNvbnN0IFNjaXNzb3JzSWNvbiA9ICgpID0+IF9qc3goInN2ZyIsIHsgY2xhc3NOYW1lOiAidy01IGgtNSAtcm90YXRlLTkwIiwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTE0LjEyMSAxNC4xMjFMMTkgMTltLTctN2w3LTdtLTcgN2wtMi44NzkgMi44NzlNMTIgMTJMOS4xMjEgOS4xMjFtMCA1Ljc1OGEzIDMgMCAxMC00LjI0MyA0LjI0MyAzIDMgMCAwMDQuMjQzLTQuMjQzem0wLTUuNzU4YTMgMyAwIDEwLTQuMjQzLTQuMjQzIDMgMyAwIDAwNC4yNDMgNC4yNDN6IiB9KSB9KTsKY29uc3QgSU9TQ3JvcEljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNSBoLTUiLCBmaWxsOiAiY3VycmVudENvbG9yIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBfanN4KCJwYXRoIiwgeyBkOiAiTTE3IDE1aDJWN2MwLTEuMS0uOS0yLTItMkg5djJoOHY4ek03IDE3VjFINXY0SDF2Mmg0djEwYzAgMS4xLjkgMiAyIDJoMTB2NGgydi00aDR2LTJIN3oiIH0pIH0pOwpjb25zdCBTaGFyZUV4cG9ydEljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNSBoLTUiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMyAxNi41djIuMjVBMi4yNSAyLjI1IDAgMDA1LjI1IDIxaDEzLjVBMi4yNSAyLjI1IDAgMDAyMSAxOC43NVYxNi41bS0xMy41LTlMMTIgM20wIDBsNC41IDQuNU0xMiAzdjEzLjUiIH0pIH0pOwpjb25zdCBVcGxvYWRJY29uID0gKCkgPT4gX2pzeCgic3ZnIiwgeyBjbGFzc05hbWU6ICJ3LTYgaC02IiwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTkgMTlWNmwxMi0zdjEzTTkgMTljMCAxLjEwNS0xLjM0MyAyLTMgMnMtMy0uODk1LTMtMiAxLjM0My0yIDMtMiAzIC44OTUgMyAyem0xMi0zYzAgMS4xMDUtMS4zNDMgMi0zIDJzLTMtLjg5NS0zLTIgMS4zNDMtMiAzLTIgMyAuODk1IDMgMnpNOSAxMGwxMi0zIiB9KSB9KTsKY29uc3QgRnhJY29uID0gKCkgPT4gX2pzeHMoInN2ZyIsIHsgY2xhc3NOYW1lOiAidy01IGgtNSIsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBbX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMTAuNSA2YTcuNSA3LjUgMCAxMDcuNSA3LjVoLTcuNVY2eiIgfSksIF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTEzLjUgMTAuNUgyMUE3LjUgNy41IDAgMDAxMy41IDN2Ny41eiIgfSldIH0pOwpjb25zdCBVbmRvSWNvbiA9ICgpID0+IF9qc3goInN2ZyIsIHsgY2xhc3NOYW1lOiAidy01IGgtNSIsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBfanN4KCJwYXRoIiwgeyBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgZDogIk0zIDEwaDEwYTggOCAwIDAxOCA4djJNMyAxMGw2IDZtLTYtNmw2LTYiIH0pIH0pOwpjb25zdCBUcmFzaEljb24gPSAoeyBjbGFzc05hbWUgPSAidy00IGgtNCIgfSkgPT4gX2pzeCgic3ZnIiwgeyBjbGFzc05hbWU6IGNsYXNzTmFtZSwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTE5IDdsLS44NjcgMTIuMTQyQTIgMiAwIDAxMTYuMTM4IDIxSDcuODYyYTIgMiAwIDAxLTEuOTk1LTEuODU4TDUgN201IDR2Nm00LTZ2Nm0xLTEwVjRhMSAxIDAgMDAtMS0xaC00YTEgMSAwIDAwLTEgMXYzTTQgN2gxNiIgfSkgfSk7CmNvbnN0IFpvb21Jbkljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNCBoLTQiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMjEgMjFsLTYtNm0yLTVhNyA3IDAgMTEtMTQgMCA3IDcgMCAwMTE0IDB6TTEwIDd2M20wIDB2M20wLTNoM20tMyAwSDciIH0pIH0pOwpjb25zdCBab29tT3V0SWNvbiA9ICgpID0+IF9qc3goInN2ZyIsIHsgY2xhc3NOYW1lOiAidy00IGgtNCIsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBfanN4KCJwYXRoIiwgeyBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgZDogIk0yMSAyMWwtNi02bTItNWE3IDcgMCAxMS0xNCAwIDcgNyAwIDAxMTQgMHpNMTMgMTBINyIgfSkgfSk7CmNvbnN0IERydW1JY29uID0gKCkgPT4gX2pzeCgic3ZnIiwgeyBjbGFzc05hbWU6ICJ3LTYgaC02IiwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTUgMjBoMTRhMiAyIDAgMDEyIDJ2MUgzdi0xYTIgMiAwIDAxMi0yem0wLTZoMTRsMS41IDVIMy41TDUgMTR6bTAtOWEzIDMgMCAwMTYgMHYySDVWNXptOCAwYTMgMyAwIDAxNiAwdjJoLTZWNXoiIH0pIH0pOwpjb25zdCBDaGV2cm9uTGVmdEljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNCBoLTQgdGV4dC1ibGFjayIsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIzIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBfanN4KCJwYXRoIiwgeyBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgZDogIk0xNSAxOWwtNy03IDctNyIgfSkgfSk7CmNvbnN0IENoZXZyb25SaWdodEljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNCBoLTQgdGV4dC1ibGFjayIsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIzIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBfanN4KCJwYXRoIiwgeyBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgZDogIk05IDVsNyA3LTcgNyIgfSkgfSk7CmNvbnN0IE1pY0ljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNiBoLTYiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMTkgMTFhNyA3IDAgMDEtNyA3bTAgMGE3IDcgMCAwMS03LTdtNyA3djRtMCAwSDhtNCAwaDRtLTQtOGEzIDMgMCAwMS0zLTNWNWEzIDMgMCAxMTYgMHY2YTMgMyAwIDAxLTMgM3oiIH0pIH0pOwpjb25zdCBTdG9wUmVjSWNvbiA9ICgpID0+IF9qc3goInN2ZyIsIHsgY2xhc3NOYW1lOiAidy02IGgtNiB0ZXh0LXJlZC01MDAiLCBmaWxsOiAiY3VycmVudENvbG9yIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBfanN4KCJyZWN0IiwgeyB4OiAiNiIsIHk6ICI2Iiwgd2lkdGg6ICIxMiIsIGhlaWdodDogIjEyIiwgcng6ICIyIiB9KSB9KTsKY29uc3QgTGlicmFyeUljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNiBoLTYiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMTIgNi4yNTN2MTNtMC0xM0MxMC44MzIgNS40NzcgOS4yNDYgNSA3LjUgNVM0LjE2OCA1LjQ3NyAzIDYuMjUzdjEzQzQuMTY4IDE4LjQ3NyA1Ljc1NCAxOCA3LjUgMThzMy4zMzIuNDc3IDQuNSAxLjI1M20wLTEzQzEzLjE2OCA1LjQ3NyAxNC43NTQgNSAxNi41IDVjMS43NDcgMCAzLjMzMi40NzcgNC41IDEuMjUzdjEzQzE5LjgzMiAxOC40NzcgMTguMjQ3IDE4IDE2LjUgMThjLTEuNzQ2IDAtMy4zMzIuNDc3LTQuNSAxLjI1MyIgfSkgfSk7CmNvbnN0IFBlbmNpbEljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNCBoLTQiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMTUuMjMyIDUuMjMybDMuNTM2IDMuNTM2bS0yLjAzNi01LjAzNmEyLjUgMi41IDAgMTEzLjUzNiAzLjUzNkw2LjUgMjEuMDM2SDN2LTMuNTcyTDE2LjczMiAzLjczMnoiIH0pIH0pOwpjb25zdCBDaGVja0ljb24gPSAoKSA9PiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNCBoLTQiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNNC41IDEyLjc1bDYgNiA5LTEzLjUiIH0pIH0pOwpjb25zdCBOZXdEb2NJY29uID0gKCkgPT4gX2pzeCgic3ZnIiwgeyBjbGFzc05hbWU6ICJ3LTUgaC01IiwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTEyIDQuNXYxNW03LjUtNy41aC0xNSIgfSkgfSk7CmNvbnN0IExvYWRpbmdTcGlubmVyID0gKCkgPT4gX2pzeHMoInN2ZyIsIHsgY2xhc3NOYW1lOiAiYW5pbWF0ZS1zcGluIGgtOCB3LTggdGV4dC1jeWFuLTUwMCIsIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCBmaWxsOiAibm9uZSIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogW19qc3goImNpcmNsZSIsIHsgY2xhc3NOYW1lOiAib3BhY2l0eS0yNSIsIGN4OiAiMTIiLCBjeTogIjEyIiwgcjogIjEwIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICI0IiB9KSwgX2pzeCgicGF0aCIsIHsgY2xhc3NOYW1lOiAib3BhY2l0eS03NSIsIGZpbGw6ICJjdXJyZW50Q29sb3IiLCBkOiAiTTQgMTJhOCA4IDAgMDE4LThWMEM1LjM3MyAwIDAgNS4zNzMgMCAxMmg0em0yIDUuMjkxQTcuOTYyIDcuOTYyIDAgMDE0IDEySDBjMCAzLjA0MiAxLjEzNSA1LjgyNCAzIDcuOTM4bDMtMi42NDd6IiB9KV0gfSk7CmNvbnN0IFNhdmVTdGF0dXNJY29uID0gKHsgc3RhdHVzIH0pID0+IHsKICAgIGlmIChzdGF0dXMgPT09ICdzYXZpbmcnKQogICAgICAgIHJldHVybiBfanN4KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhzIHRleHQteWVsbG93LTUwMCBhbmltYXRlLXB1bHNlIGZvbnQtbWVkaXVtIiwgY2hpbGRyZW46ICJTYXZpbmcuLi4iIH0pOwogICAgaWYgKHN0YXR1cyA9PT0gJ3NhdmVkJykKICAgICAgICByZXR1cm4gX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC14cyB0ZXh0LWdyZWVuLTUwMCBmb250LW1lZGl1bSIsIGNoaWxkcmVuOiAiU2F2ZWQiIH0pOwogICAgcmV0dXJuIF9qc3goInNwYW4iLCB7IGNsYXNzTmFtZTogInRleHQteHMgdGV4dC16aW5jLTUwMCBmb250LW1lZGl1bSIsIGNoaWxkcmVuOiAiVW5zYXZlZCIgfSk7Cn07CmNvbnN0IEFwcCA9ICgpID0+IHsKICAgIC8vIFN0YXRlCiAgICBjb25zdCBbdHJhY2tzLCBzZXRUcmFja3NdID0gdXNlU3RhdGUoW10pOwogICAgY29uc3QgW2hpc3RvcnksIHNldEhpc3RvcnldID0gdXNlU3RhdGUoW10pOwogICAgY29uc3QgW3NlbGVjdGVkVHJhY2tJZCwgc2V0U2VsZWN0ZWRUcmFja0lkXSA9IHVzZVN0YXRlKG51bGwpOwogICAgY29uc3QgW2lzUGxheWluZywgc2V0SXNQbGF5aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTsKICAgIGNvbnN0IFtpc1NjcnViYmluZywgc2V0SXNTY3J1YmJpbmddID0gdXNlU3RhdGUoZmFsc2UpOwogICAgY29uc3QgW2lzUmVjb3JkaW5nLCBzZXRJc1JlY29yZGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7CiAgICBjb25zdCBbY3VycmVudFRpbWUsIHNldEN1cnJlbnRUaW1lXSA9IHVzZVN0YXRlKDApOwogICAgY29uc3QgW3NlbGVjdGlvbiwgc2V0U2VsZWN0aW9uXSA9IHVzZVN0YXRlKG51bGwpOwogICAgY29uc3QgW2FwcFN0YXRlLCBzZXRBcHBTdGF0ZV0gPSB1c2VTdGF0ZShBcHBTdGF0ZS5JRExFKTsKICAgIGNvbnN0IFtsb2FkRXJyb3IsIHNldExvYWRFcnJvcl0gPSB1c2VTdGF0ZShudWxsKTsgLy8gTmV3IHN0YXRlIGZvciBlcnJvcnMKICAgIGNvbnN0IFt6b29tLCBzZXRab29tXSA9IHVzZVN0YXRlKERFRkFVTFRfWk9PTSk7CiAgICBjb25zdCBbc2F2ZVN0YXR1cywgc2V0U2F2ZVN0YXR1c10gPSB1c2VTdGF0ZSgnc2F2ZWQnKTsKICAgIGNvbnN0IFtpc0JlYXRNb2RhbE9wZW4sIHNldEJlYXRNb2RhbE9wZW5dID0gdXNlU3RhdGUoZmFsc2UpOwogICAgY29uc3QgW2lzRWZmZWN0c01vZGFsT3Blbiwgc2V0RWZmZWN0c01vZGFsT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgICBjb25zdCBbaXNFeHBvcnRNb2RhbE9wZW4sIHNldEV4cG9ydE1vZGFsT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgICAvLyBQZXJzaXN0ZW5jZQogICAgY29uc3QgW2N1cnJlbnRQcm9qZWN0SWQsIHNldEN1cnJlbnRQcm9qZWN0SWRdID0gdXNlU3RhdGUobnVsbCk7CiAgICBjb25zdCBbY3VycmVudFByb2plY3ROYW1lLCBzZXRDdXJyZW50UHJvamVjdE5hbWVdID0gdXNlU3RhdGUoIiIpOwogICAgY29uc3QgW3NhdmVkUHJvamVjdHMsIHNldFNhdmVkUHJvamVjdHNdID0gdXNlU3RhdGUoW10pOwogICAgY29uc3QgW3JlY2VudFByb2plY3RQcmV2aWV3LCBzZXRSZWNlbnRQcm9qZWN0UHJldmlld10gPSB1c2VTdGF0ZShudWxsKTsKICAgIGNvbnN0IFtwcm9qZWN0VG9EZWxldGUsIHNldFByb2plY3RUb0RlbGV0ZV0gPSB1c2VTdGF0ZShudWxsKTsKICAgIC8vIEd1YXJkIHRvIHByZXZlbnQgYXV0b3NhdmUgb3ZlcndyaXRlcyBkdXJpbmcgbG9hZGluZwogICAgY29uc3QgaWdub3JlQ2hhbmdlc1JlZiA9IHVzZVJlZihmYWxzZSk7CiAgICBjb25zdCBpc0RpcnR5UmVmID0gdXNlUmVmKGZhbHNlKTsKICAgIC8vIElubGluZSBSZW5hbWluZyBTdGF0ZQogICAgY29uc3QgW2VkaXRpbmdQcm9qZWN0SWQsIHNldEVkaXRpbmdQcm9qZWN0SWRdID0gdXNlU3RhdGUobnVsbCk7CiAgICBjb25zdCBbZWRpdGluZ05hbWUsIHNldEVkaXRpbmdOYW1lXSA9IHVzZVN0YXRlKCIiKTsKICAgIC8vIFZpZXdwb3J0IFRyYWNraW5nCiAgICBjb25zdCBbc2Nyb2xsTGVmdCwgc2V0U2Nyb2xsTGVmdF0gPSB1c2VTdGF0ZSgwKTsKICAgIGNvbnN0IFt2aWV3cG9ydFdpZHRoLCBzZXRWaWV3cG9ydFdpZHRoXSA9IHVzZVN0YXRlKHdpbmRvdy5pbm5lcldpZHRoKTsKICAgIC8vIE5ldyBNb2RlcwogICAgY29uc3QgW2lzVHJpbU1vZGUsIHNldElzVHJpbU1vZGVdID0gdXNlU3RhdGUoZmFsc2UpOwogICAgY29uc3QgW3RyaW1TdGF0ZSwgc2V0VHJpbVN0YXRlXSA9IHVzZVN0YXRlKG51bGwpOwogICAgLy8gSW50ZXJhY3RpdmUgRmFkZSBNb2RlCiAgICBjb25zdCBbaW50ZXJhY3RpdmVNb2RlLCBzZXRJbnRlcmFjdGl2ZU1vZGVdID0gdXNlU3RhdGUobnVsbCk7CiAgICAvLyBEcmFnZ2luZyBTdGF0ZQogICAgY29uc3QgW2RyYWdnaW5nVHJhY2tJZCwgc2V0RHJhZ2dpbmdUcmFja0lkXSA9IHVzZVN0YXRlKG51bGwpOwogICAgY29uc3QgZHJhZ1JlZiA9IHVzZVJlZih7IHN0YXJ0WDogMCwgc3RhcnRZOiAwLCBvZmZzZXRUaW1lOiAwLCB0cmFja0lkOiAnJywgbGFzdFBvaW50ZXJYOiAwLCBsYXN0UG9pbnRlclk6IDAgfSk7CiAgICBjb25zdCBsb25nUHJlc3NUaW1lclJlZiA9IHVzZVJlZihudWxsKTsKICAgIC8vIFJlZnMKICAgIGNvbnN0IGF1ZGlvU291cmNlTm9kZXMgPSB1c2VSZWYoW10pOwogICAgY29uc3QgbWVkaWFSZWNvcmRlclJlZiA9IHVzZVJlZihudWxsKTsKICAgIGNvbnN0IHN0YXJ0VGltZVJlZiA9IHVzZVJlZigwKTsKICAgIGNvbnN0IGZpbGVJbnB1dFJlZiA9IHVzZVJlZihudWxsKTsKICAgIGNvbnN0IHRpbWVsaW5lUmVmID0gdXNlUmVmKG51bGwpOwogICAgY29uc3QgcGxheWhlYWRSZWYgPSB1c2VSZWYobnVsbCk7CiAgICBjb25zdCBzYXZlVGltZW91dFJlZiA9IHVzZVJlZihudWxsKTsKICAgIC8vIFRyYWNrcyBSZWYgZm9yIEV2ZW50IEhhbmRsZXJzCiAgICBjb25zdCB0cmFja3NSZWYgPSB1c2VSZWYodHJhY2tzKTsKICAgIHVzZUVmZmVjdCgoKSA9PiB7IHRyYWNrc1JlZi5jdXJyZW50ID0gdHJhY2tzOyB9LCBbdHJhY2tzXSk7CiAgICAvLyBEZXJpdmVkIFN0YXRlOiBTbWFydCBTZWxlY3Rpb24KICAgIC8vIElmIG5vIHRyYWNrIGlzIG1hbnVhbGx5IHNlbGVjdGVkLCBjaGVjayBpZiB0aGVyZSBpcyBleGFjdGx5IG9uZSB0cmFjayBhdCB0aGUgY3VycmVudCBwbGF5aGVhZCBwb3NpdGlvbi4KICAgIGNvbnN0IGVmZmVjdGl2ZVNlbGVjdGVkVHJhY2tJZCA9IHNlbGVjdGVkVHJhY2tJZCB8fCAoKCkgPT4gewogICAgICAgIGNvbnN0IGF0UGxheWhlYWQgPSB0cmFja3MuZmlsdGVyKHQgPT4gY3VycmVudFRpbWUgPj0gdC5zdGFydFRpbWUgJiYgY3VycmVudFRpbWUgPCB0LnN0YXJ0VGltZSArIHQuZHVyYXRpb24pOwogICAgICAgIHJldHVybiBhdFBsYXloZWFkLmxlbmd0aCA9PT0gMSA/IGF0UGxheWhlYWRbMF0uaWQgOiBudWxsOwogICAgfSkoKTsKICAgIGNvbnN0IHNlbGVjdGVkVHJhY2sgPSB0cmFja3MuZmluZCh0ID0+IHQuaWQgPT09IGVmZmVjdGl2ZVNlbGVjdGVkVHJhY2tJZCk7CiAgICAvLyBWaWV3cG9ydCBSZXNpemUgT2JzZXJ2ZXIKICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgaWYgKHRpbWVsaW5lUmVmLmN1cnJlbnQpIHsKICAgICAgICAgICAgc2V0Vmlld3BvcnRXaWR0aCh0aW1lbGluZVJlZi5jdXJyZW50LmNsaWVudFdpZHRoKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoZW50cmllcyA9PiB7CiAgICAgICAgICAgIGZvciAobGV0IGVudHJ5IG9mIGVudHJpZXMpIHsKICAgICAgICAgICAgICAgIHNldFZpZXdwb3J0V2lkdGgoZW50cnkuY29udGVudFJlY3Qud2lkdGgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKHRpbWVsaW5lUmVmLmN1cnJlbnQpCiAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUodGltZWxpbmVSZWYuY3VycmVudCk7CiAgICAgICAgcmV0dXJuICgpID0+IG9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICAgIH0sIFtdKTsKICAgIC8vIC0tLSBQZXJzaXN0ZW5jZSAmIExpYnJhcnkgLS0tCiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIGxvYWRQcm9qZWN0cygpLnRoZW4ocHJvamVjdHMgPT4gewogICAgICAgICAgICBzZXRTYXZlZFByb2plY3RzKHByb2plY3RzKTsKICAgICAgICAgICAgaWYgKHByb2plY3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHNldFJlY2VudFByb2plY3RQcmV2aWV3KHByb2plY3RzWzBdLnRodW1ibmFpbCB8fCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwgW10pOwogICAgLy8gQXV0b3NhdmUgTWFuYWdlbWVudAogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICBpZiAoaWdub3JlQ2hhbmdlc1JlZi5jdXJyZW50KQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKHRyYWNrcy5sZW5ndGggPT09IDAgJiYgIWN1cnJlbnRQcm9qZWN0SWQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpc0RpcnR5UmVmLmN1cnJlbnQgPSB0cnVlOwogICAgICAgIHNldFNhdmVTdGF0dXMoJ3Vuc2F2ZWQnKTsKICAgICAgICBpZiAoc2F2ZVRpbWVvdXRSZWYuY3VycmVudCkKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHNhdmVUaW1lb3V0UmVmLmN1cnJlbnQpOwogICAgICAgIHNhdmVUaW1lb3V0UmVmLmN1cnJlbnQgPSBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKICAgICAgICAgICAgaWYgKCFpc0RpcnR5UmVmLmN1cnJlbnQpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChhcHBTdGF0ZSAhPT0gQXBwU3RhdGUuRURJVElORykKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgc2V0U2F2ZVN0YXR1cygnc2F2aW5nJyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsZXQgcGlkID0gY3VycmVudFByb2plY3RJZDsKICAgICAgICAgICAgICAgIGxldCBwbmFtZSA9IGN1cnJlbnRQcm9qZWN0TmFtZTsKICAgICAgICAgICAgICAgIGlmICghcGlkKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdHMgPSBhd2FpdCBsb2FkUHJvamVjdHMoKTsKICAgICAgICAgICAgICAgICAgICBwaWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7CiAgICAgICAgICAgICAgICAgICAgcG5hbWUgPSBgUHJvamVjdCAke3Byb2plY3RzLmxlbmd0aCArIDF9YDsKICAgICAgICAgICAgICAgICAgICBzZXRDdXJyZW50UHJvamVjdElkKHBpZCk7CiAgICAgICAgICAgICAgICAgICAgc2V0Q3VycmVudFByb2plY3ROYW1lKHBuYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHRodW1iID0gZ2VuZXJhdGVQcm9qZWN0UHJldmlldyh0cmFja3MsIDEwMCwgMTAwKTsKICAgICAgICAgICAgICAgIHNldFJlY2VudFByb2plY3RQcmV2aWV3KHRodW1iKTsKICAgICAgICAgICAgICAgIGF3YWl0IHNhdmVQcm9qZWN0KHBpZCwgcG5hbWUsIHRyYWNrcywgdGh1bWIpOwogICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IGF3YWl0IGxvYWRQcm9qZWN0cygpOwogICAgICAgICAgICAgICAgc2V0U2F2ZWRQcm9qZWN0cyh1cGRhdGVkKTsKICAgICAgICAgICAgICAgIGlzRGlydHlSZWYuY3VycmVudCA9IGZhbHNlOwogICAgICAgICAgICAgICAgc2V0U2F2ZVN0YXR1cygnc2F2ZWQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgc2V0U2F2ZVN0YXR1cygndW5zYXZlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgcmV0dXJuICgpID0+IHsgaWYgKHNhdmVUaW1lb3V0UmVmLmN1cnJlbnQpCiAgICAgICAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dFJlZi5jdXJyZW50KTsgfTsKICAgIH0sIFt0cmFja3MsIGN1cnJlbnRQcm9qZWN0SWQsIGN1cnJlbnRQcm9qZWN0TmFtZSwgYXBwU3RhdGVdKTsKICAgIGNvbnN0IGhhbmRsZU9wZW5Qcm9qZWN0ID0gYXN5bmMgKHByb2plY3QpID0+IHsKICAgICAgICBpZiAoZWRpdGluZ1Byb2plY3RJZCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIHN0b3BQbGF5YmFjaygpOwogICAgICAgIGlmIChzYXZlVGltZW91dFJlZi5jdXJyZW50KSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dFJlZi5jdXJyZW50KTsKICAgICAgICAgICAgc2F2ZVRpbWVvdXRSZWYuY3VycmVudCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHNldEFwcFN0YXRlKEFwcFN0YXRlLkxPQURJTkcpOwogICAgICAgIHNldExvYWRFcnJvcihudWxsKTsKICAgICAgICBpZ25vcmVDaGFuZ2VzUmVmLmN1cnJlbnQgPSB0cnVlOwogICAgICAgIHNldFRyYWNrcyhbXSk7CiAgICAgICAgc2V0SGlzdG9yeShbXSk7CiAgICAgICAgc2V0U2VsZWN0aW9uKG51bGwpOwogICAgICAgIHNldFNlbGVjdGVkVHJhY2tJZChudWxsKTsKICAgICAgICBzZXRUcmltU3RhdGUobnVsbCk7CiAgICAgICAgc2V0SXNUcmltTW9kZShmYWxzZSk7CiAgICAgICAgc2V0SW50ZXJhY3RpdmVNb2RlKG51bGwpOwogICAgICAgIHNldEN1cnJlbnRUaW1lKDApOwogICAgICAgIHNldFNhdmVTdGF0dXMoJ3NhdmVkJyk7CiAgICAgICAgY29uc3QgY3R4ID0gZ2V0QXVkaW9Db250ZXh0KCk7CiAgICAgICAgaWYgKGN0eC5zdGF0ZSA9PT0gJ3N1c3BlbmRlZCcpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IGN0eC5yZXN1bWUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkgeyB9CiAgICAgICAgfQogICAgICAgIHNldEN1cnJlbnRQcm9qZWN0SWQocHJvamVjdC5pZCk7CiAgICAgICAgc2V0Q3VycmVudFByb2plY3ROYW1lKHByb2plY3QubmFtZSk7CiAgICAgICAgc2V0UmVjZW50UHJvamVjdFByZXZpZXcocHJvamVjdC50aHVtYm5haWwgfHwgbnVsbCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgZnJlc2hQcm9qZWN0cyA9IGF3YWl0IGxvYWRQcm9qZWN0cygpOwogICAgICAgICAgICBjb25zdCB0YXJnZXRQcm9qZWN0ID0gZnJlc2hQcm9qZWN0cy5maW5kKHAgPT4gcC5pZCA9PT0gcHJvamVjdC5pZCkgfHwgcHJvamVjdDsKICAgICAgICAgICAgY29uc3Qgc2F2ZWRUcmFja0NvdW50ID0gdGFyZ2V0UHJvamVjdC50cmFja3MgPyB0YXJnZXRQcm9qZWN0LnRyYWNrcy5sZW5ndGggOiAwOwogICAgICAgICAgICBsZXQgbG9hZGVkVHJhY2tzID0gW107CiAgICAgICAgICAgIGlmIChzYXZlZFRyYWNrQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICBsb2FkZWRUcmFja3MgPSBhd2FpdCBsb2FkUHJvamVjdFRyYWNrcyh0YXJnZXRQcm9qZWN0LnRyYWNrcyk7CiAgICAgICAgICAgICAgICBpZiAobG9hZGVkVHJhY2tzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHNldExvYWRFcnJvcigiUHJvamVjdCBkYXRhIGFwcGVhcnMgY29ycnVwdGVkIG9yIGZvcm1hdCBpcyB1bnN1cHBvcnRlZC4iKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0VHJhY2tzKGxvYWRlZFRyYWNrcyk7CiAgICAgICAgICAgIHNldEFwcFN0YXRlKEFwcFN0YXRlLkVESVRJTkcpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgaWdub3JlQ2hhbmdlc1JlZi5jdXJyZW50ID0gZmFsc2U7IGlzRGlydHlSZWYuY3VycmVudCA9IGZhbHNlOyB9LCAxMDApOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBzZXRMb2FkRXJyb3IoYENyaXRpY2FsIEVycm9yOiAke2UgaW5zdGFuY2VvZiBFcnJvciA/IGUubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gKTsKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgaGFuZGxlU2F2ZUFuZENsb3NlID0gYXN5bmMgKCkgPT4gewogICAgICAgIGlmIChzYXZlVGltZW91dFJlZi5jdXJyZW50KQogICAgICAgICAgICBjbGVhclRpbWVvdXQoc2F2ZVRpbWVvdXRSZWYuY3VycmVudCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCh0cmFja3MubGVuZ3RoID4gMCB8fCBjdXJyZW50UHJvamVjdElkKSAmJiAhaWdub3JlQ2hhbmdlc1JlZi5jdXJyZW50KSB7CiAgICAgICAgICAgICAgICBsZXQgcGlkID0gY3VycmVudFByb2plY3RJZDsKICAgICAgICAgICAgICAgIGxldCBwbmFtZSA9IGN1cnJlbnRQcm9qZWN0TmFtZTsKICAgICAgICAgICAgICAgIGlmICghcGlkICYmIHRyYWNrcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdHMgPSBhd2FpdCBsb2FkUHJvamVjdHMoKTsKICAgICAgICAgICAgICAgICAgICBwaWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7CiAgICAgICAgICAgICAgICAgICAgcG5hbWUgPSBgUHJvamVjdCAke3Byb2plY3RzLmxlbmd0aCArIDF9YDsKICAgICAgICAgICAgICAgICAgICBzZXRDdXJyZW50UHJvamVjdElkKHBpZCk7CiAgICAgICAgICAgICAgICAgICAgc2V0Q3VycmVudFByb2plY3ROYW1lKHBuYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChwaWQpIHsKICAgICAgICAgICAgICAgICAgICBzZXRTYXZlU3RhdHVzKCdzYXZpbmcnKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0aHVtYiA9IGdlbmVyYXRlUHJvamVjdFByZXZpZXcodHJhY2tzLCAxMDAsIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2F2ZVByb2plY3QocGlkLCBwbmFtZSwgdHJhY2tzLCB0aHVtYik7CiAgICAgICAgICAgICAgICAgICAgc2V0UmVjZW50UHJvamVjdFByZXZpZXcodGh1bWIpOwogICAgICAgICAgICAgICAgICAgIHNldFNhdmVTdGF0dXMoJ3NhdmVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgbG9hZFByb2plY3RzKCk7CiAgICAgICAgICAgICAgICBzZXRTYXZlZFByb2plY3RzKHVwZGF0ZWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgIGFsZXJ0KCJDb3VsZCBub3Qgc2F2ZSBwcm9qZWN0LiBDaGVjayB5b3VyIGRldmljZSBzdG9yYWdlLiIpOwogICAgICAgICAgICBzZXRTYXZlU3RhdHVzKCd1bnNhdmVkJyk7CiAgICAgICAgfQogICAgICAgIHNldEFwcFN0YXRlKEFwcFN0YXRlLkxJQlJBUlkpOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZU5ld1Byb2plY3QgPSAoKSA9PiB7CiAgICAgICAgc3RvcFBsYXliYWNrKCk7CiAgICAgICAgaWYgKHNhdmVUaW1lb3V0UmVmLmN1cnJlbnQpCiAgICAgICAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dFJlZi5jdXJyZW50KTsKICAgICAgICBpZ25vcmVDaGFuZ2VzUmVmLmN1cnJlbnQgPSB0cnVlOwogICAgICAgIHNldFRyYWNrcyhbXSk7CiAgICAgICAgc2V0SGlzdG9yeShbXSk7CiAgICAgICAgc2V0U2VsZWN0aW9uKG51bGwpOwogICAgICAgIHNldEN1cnJlbnRUaW1lKDApOwogICAgICAgIHNldEN1cnJlbnRQcm9qZWN0SWQobnVsbCk7CiAgICAgICAgc2V0Q3VycmVudFByb2plY3ROYW1lKCIiKTsKICAgICAgICBzZXRSZWNlbnRQcm9qZWN0UHJldmlldyhudWxsKTsKICAgICAgICBzZXRTYXZlU3RhdHVzKCdzYXZlZCcpOwogICAgICAgIHNldExvYWRFcnJvcihudWxsKTsKICAgICAgICBzZXRJbnRlcmFjdGl2ZU1vZGUobnVsbCk7CiAgICAgICAgc2V0QXBwU3RhdGUoQXBwU3RhdGUuSURMRSk7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IGlnbm9yZUNoYW5nZXNSZWYuY3VycmVudCA9IGZhbHNlOyB9LCAxMDApOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZURlbGV0ZVByb2plY3QgPSAoaWQsIGUpID0+IHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBzZXRQcm9qZWN0VG9EZWxldGUoaWQpOwogICAgfTsKICAgIGNvbnN0IGNvbmZpcm1EZWxldGVQcm9qZWN0ID0gYXN5bmMgKCkgPT4gewogICAgICAgIGlmICghcHJvamVjdFRvRGVsZXRlKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgZGVsZXRlUHJvamVjdChwcm9qZWN0VG9EZWxldGUpOwogICAgICAgICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgbG9hZFByb2plY3RzKCk7CiAgICAgICAgICAgIHNldFNhdmVkUHJvamVjdHModXBkYXRlZCk7CiAgICAgICAgICAgIGlmIChjdXJyZW50UHJvamVjdElkID09PSBwcm9qZWN0VG9EZWxldGUpIHsKICAgICAgICAgICAgICAgIHNldEN1cnJlbnRQcm9qZWN0SWQobnVsbCk7CiAgICAgICAgICAgICAgICBzZXRDdXJyZW50UHJvamVjdE5hbWUoIiIpOwogICAgICAgICAgICAgICAgc2V0VHJhY2tzKFtdKTsKICAgICAgICAgICAgICAgIHNldEhpc3RvcnkoW10pOwogICAgICAgICAgICAgICAgc2V0U2VsZWN0aW9uKG51bGwpOwogICAgICAgICAgICAgICAgc2V0Q3VycmVudFRpbWUoMCk7CiAgICAgICAgICAgICAgICBpZ25vcmVDaGFuZ2VzUmVmLmN1cnJlbnQgPSB0cnVlOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IGlnbm9yZUNoYW5nZXNSZWYuY3VycmVudCA9IGZhbHNlOyB9LCAxMDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh1cGRhdGVkLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBzZXRSZWNlbnRQcm9qZWN0UHJldmlldyh1cGRhdGVkWzBdLnRodW1ibmFpbCB8fCBudWxsKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2V0UmVjZW50UHJvamVjdFByZXZpZXcobnVsbCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgfQogICAgICAgIHNldFByb2plY3RUb0RlbGV0ZShudWxsKTsKICAgIH07CiAgICBjb25zdCBoYW5kbGVTdGFydFJlbmFtZSA9IChlLCBwcm9qZWN0KSA9PiB7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgc2V0RWRpdGluZ1Byb2plY3RJZChwcm9qZWN0LmlkKTsKICAgICAgICBzZXRFZGl0aW5nTmFtZShwcm9qZWN0Lm5hbWUpOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZVNhdmVSZW5hbWUgPSBhc3luYyAoZSkgPT4gewogICAgICAgIGlmIChlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgZS5uYXRpdmVFdmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFlZGl0aW5nUHJvamVjdElkKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgY29uc3QgdHJpbW1lZCA9IGVkaXRpbmdOYW1lLnRyaW0oKTsKICAgICAgICBpZiAodHJpbW1lZC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVQcm9qZWN0TmFtZShlZGl0aW5nUHJvamVjdElkLCB0cmltbWVkKTsKICAgICAgICAgICAgICAgIHNldFNhdmVkUHJvamVjdHMocHJldiA9PiBwcmV2Lm1hcChwID0+IHAuaWQgPT09IGVkaXRpbmdQcm9qZWN0SWQgPyB7IC4uLnAsIG5hbWU6IHRyaW1tZWQgfSA6IHApKTsKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UHJvamVjdElkID09PSBlZGl0aW5nUHJvamVjdElkKQogICAgICAgICAgICAgICAgICAgIHNldEN1cnJlbnRQcm9qZWN0TmFtZSh0cmltbWVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgbG9hZFByb2plY3RzKCk7CiAgICAgICAgICAgICAgICBzZXRTYXZlZFByb2plY3RzKHVwZGF0ZWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNldEVkaXRpbmdQcm9qZWN0SWQobnVsbCk7CiAgICB9OwogICAgLy8gLS0tIFBsYXliYWNrIExvZ2ljIC0tLQogICAgY29uc3QgbWF4RHVyYXRpb24gPSBNYXRoLm1heCguLi50cmFja3MubWFwKHQgPT4gdC5zdGFydFRpbWUgKyB0LmR1cmF0aW9uKSwgMTApOwogICAgY29uc3QgbWF4TGFuZSA9IHRyYWNrcy5sZW5ndGggPiAwID8gTWF0aC5tYXgoLi4udHJhY2tzLm1hcCh0ID0+IHQubGFuZSkpIDogMDsKICAgIGNvbnN0IHRvdGFsTGFuZXMgPSBtYXhMYW5lICsgMjsKICAgIC8vIFJFRkFDVE9SRUQ6IFNuYXBwaW5nIGxvZ2ljIHRoYXQgcmVzcGVjdHMgdHJpbVN0YXJ0IGFuZCBkaWZmZXJlbnQgQlBNcwogICAgY29uc3QgY2FsY3VsYXRlQ2xhbXBlZFRyYWNrUG9zaXRpb24gPSAodHJhY2tJZCwgdHJhY2tEdXJhdGlvbiwgcHJvcG9zZWRTdGFydFRpbWUsIHByb3Bvc2VkTGFuZSwgYWxsVHJhY2tzLCBjdXJyZW50Wm9vbSwgcGxheWhlYWRUaW1lLCBkcmFnZ2luZ1RyaW1TdGFydCkgPT4gewogICAgICAgIGNvbnN0IG9ic3RhY2xlcyA9IGFsbFRyYWNrcwogICAgICAgICAgICAuZmlsdGVyKHQgPT4gdC5pZCAhPT0gdHJhY2tJZCAmJiB0LmxhbmUgPT09IHByb3Bvc2VkTGFuZSkKICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGEuc3RhcnRUaW1lIC0gYi5zdGFydFRpbWUpOwogICAgICAgIGxldCBnYXBTdGFydCA9IDA7CiAgICAgICAgbGV0IGdhcEVuZCA9IEluZmluaXR5OwogICAgICAgIGZvciAoY29uc3Qgb2JzIG9mIG9ic3RhY2xlcykgewogICAgICAgICAgICBjb25zdCBvYnNFbmQgPSBvYnMuc3RhcnRUaW1lICsgb2JzLmR1cmF0aW9uOwogICAgICAgICAgICBpZiAocHJvcG9zZWRTdGFydFRpbWUgPCBvYnMuc3RhcnRUaW1lKSB7CiAgICAgICAgICAgICAgICBnYXBFbmQgPSBvYnMuc3RhcnRUaW1lOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBnYXBTdGFydCA9IG9ic0VuZDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCB2YWxpZE1heFN0YXJ0ID0gTWF0aC5tYXgoZ2FwU3RhcnQsIGdhcEVuZCAtIHRyYWNrRHVyYXRpb24pOwogICAgICAgIGxldCBjbGFtcGVkVGltZSA9IE1hdGgubWF4KGdhcFN0YXJ0LCBNYXRoLm1pbih2YWxpZE1heFN0YXJ0LCBwcm9wb3NlZFN0YXJ0VGltZSkpOwogICAgICAgIGNvbnN0IHNuYXBTZWNvbmRzID0gU05BUF9USFJFU0hPTERfUFggLyBjdXJyZW50Wm9vbTsKICAgICAgICBsZXQgZGlkU25hcCA9IGZhbHNlOwogICAgICAgIC8vIDEuIEJvdW5kYXJ5IFNuYXBwaW5nIChTdGFydC9FbmQgb2Ygb3RoZXIgY2xpcHMgb24gc2FtZSBsYW5lKQogICAgICAgIGlmIChNYXRoLmFicyhjbGFtcGVkVGltZSAtIGdhcFN0YXJ0KSA8IHNuYXBTZWNvbmRzKSB7CiAgICAgICAgICAgIGNsYW1wZWRUaW1lID0gZ2FwU3RhcnQ7CiAgICAgICAgICAgIGRpZFNuYXAgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoTWF0aC5hYnMoY2xhbXBlZFRpbWUgLSB2YWxpZE1heFN0YXJ0KSA8IHNuYXBTZWNvbmRzKSB7CiAgICAgICAgICAgIGNsYW1wZWRUaW1lID0gdmFsaWRNYXhTdGFydDsKICAgICAgICAgICAgZGlkU25hcCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIC8vIDIuIFBsYXloZWFkIFNuYXBwaW5nCiAgICAgICAgaWYgKE1hdGguYWJzKGNsYW1wZWRUaW1lIC0gcGxheWhlYWRUaW1lKSA8IHNuYXBTZWNvbmRzKSB7CiAgICAgICAgICAgIGlmIChwbGF5aGVhZFRpbWUgPj0gZ2FwU3RhcnQgJiYgcGxheWhlYWRUaW1lIDw9IHZhbGlkTWF4U3RhcnQgKyBzbmFwU2Vjb25kcykgewogICAgICAgICAgICAgICAgY2xhbXBlZFRpbWUgPSBwbGF5aGVhZFRpbWU7CiAgICAgICAgICAgICAgICBkaWRTbmFwID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBlbmRTbmFwcGVkU3RhcnRUaW1lID0gcGxheWhlYWRUaW1lIC0gdHJhY2tEdXJhdGlvbjsKICAgICAgICBpZiAoTWF0aC5hYnMoY2xhbXBlZFRpbWUgLSBlbmRTbmFwcGVkU3RhcnRUaW1lKSA8IHNuYXBTZWNvbmRzKSB7CiAgICAgICAgICAgIGlmIChlbmRTbmFwcGVkU3RhcnRUaW1lID49IGdhcFN0YXJ0IC0gMC4wMDEgJiYgZW5kU25hcHBlZFN0YXJ0VGltZSA8PSB2YWxpZE1heFN0YXJ0ICsgMC4wMDEpIHsKICAgICAgICAgICAgICAgIGNsYW1wZWRUaW1lID0gZW5kU25hcHBlZFN0YXJ0VGltZTsKICAgICAgICAgICAgICAgIGRpZFNuYXAgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIDMuIEdyaWQgU25hcHBpbmcgKEJQTSBhd2FyZSwgQ3Jvc3MtQ2xpcCwgVHJpbS1Bd2FyZSkKICAgICAgICBpZiAoIWRpZFNuYXAgJiYgY3VycmVudFpvb20gPiAxMCkgeyAvLyBPbmx5IHNuYXAgdG8gbXVzaWNhbCBncmlkIGlmIHpvb21lZCBpbiBlbm91Z2gKICAgICAgICAgICAgLy8gVGhlICJNdXNpY2FsIFplcm8iIG9mIHRoZSBkcmFnZ2luZyBjbGlwIGlzIChzdGFydFRpbWUgLSB0cmltU3RhcnQpLgogICAgICAgICAgICAvLyBXZSB3YW50IChQcm9wb3NlZFN0YXJ0VGltZSAtIGRyYWdnaW5nVHJpbVN0YXJ0KSB0byBhbGlnbiB3aXRoIGJlYXRzIG9mIG90aGVyIGNsaXBzLgogICAgICAgICAgICBmb3IgKGNvbnN0IHJlZiBvZiBhbGxUcmFja3MpIHsKICAgICAgICAgICAgICAgIC8vIFNraXAgc2VsZiBvciB0cmFja3Mgd2l0aG91dCBCUE0KICAgICAgICAgICAgICAgIGlmIChyZWYuaWQgPT09IHRyYWNrSWQgfHwgIXJlZi5icG0pCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBzZWNvbmRzUGVyQmVhdCA9IDYwIC8gcmVmLmJwbTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlZk11c2ljYWxaZXJvID0gcmVmLnN0YXJ0VGltZSAtIHJlZi50cmltU3RhcnQ7CiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGJlYXQgbnVtYmVyIG9mIHRoZSByZWZlcmVuY2UgdHJhY2sgdGhhdCBpcyBjbG9zZXN0IHRvIG91ciBwcm9wb3NlZCAiTXVzaWNhbCBaZXJvIgogICAgICAgICAgICAgICAgLy8gUHJvcG9zZWRNdXNpY2FsWmVybyA9IGNsYW1wZWRUaW1lIC0gZHJhZ2dpbmdUcmltU3RhcnQKICAgICAgICAgICAgICAgIC8vIFdlIHdhbnQ6IFJlZk11c2ljYWxaZXJvICsgKE4gKiBzZWNvbmRzUGVyQmVhdCkg4omIIFByb3Bvc2VkTXVzaWNhbFplcm8KICAgICAgICAgICAgICAgIC8vIFNvOiBOIOKJiCAoUHJvcG9zZWRNdXNpY2FsWmVybyAtIFJlZk11c2ljYWxaZXJvKSAvIHNlY29uZHNQZXJCZWF0CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wb3NlZE11c2ljYWxaZXJvID0gY2xhbXBlZFRpbWUgLSBkcmFnZ2luZ1RyaW1TdGFydDsKICAgICAgICAgICAgICAgIGNvbnN0IHJlbGF0aXZlVGltZSA9IHByb3Bvc2VkTXVzaWNhbFplcm8gLSByZWZNdXNpY2FsWmVybzsKICAgICAgICAgICAgICAgIGNvbnN0IGJlYXRJbmRleCA9IE1hdGgucm91bmQocmVsYXRpdmVUaW1lIC8gc2Vjb25kc1BlckJlYXQpOwogICAgICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBleGFjdCB0aW1lc3RhbXAgb2YgdGhhdCBiZWF0IG9uIHRoZSByZWZlcmVuY2UgZ3JpZAogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0R3JpZFRpbWUgPSByZWZNdXNpY2FsWmVybyArIChiZWF0SW5kZXggKiBzZWNvbmRzUGVyQmVhdCk7CiAgICAgICAgICAgICAgICAvLyBOb3csIGNvbnZlcnQgdGhhdCBncmlkIHRpbWUgYmFjayB0byBhIFN0YXJ0VGltZSBmb3IgdGhlIGRyYWdnaW5nIGNsaXAKICAgICAgICAgICAgICAgIC8vIFN0YXJ0VGltZSA9IFRhcmdldEdyaWRUaW1lICsgZHJhZ2dpbmdUcmltU3RhcnQKICAgICAgICAgICAgICAgIGNvbnN0IHNuYXBUYXJnZXRUaW1lID0gdGFyZ2V0R3JpZFRpbWUgKyBkcmFnZ2luZ1RyaW1TdGFydDsKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHZhbGlkIGFuZCB3aXRoaW4gc25hcCBkaXN0YW5jZQogICAgICAgICAgICAgICAgaWYgKHNuYXBUYXJnZXRUaW1lID49IGdhcFN0YXJ0ICYmIHNuYXBUYXJnZXRUaW1lIDw9IHZhbGlkTWF4U3RhcnQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoY2xhbXBlZFRpbWUgLSBzbmFwVGFyZ2V0VGltZSkgPCBzbmFwU2Vjb25kcykgewogICAgICAgICAgICAgICAgICAgICAgICBjbGFtcGVkVGltZSA9IHNuYXBUYXJnZXRUaW1lOwogICAgICAgICAgICAgICAgICAgICAgICBkaWRTbmFwID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIEZvdW5kIGEgc25hcCwgc3RvcCBsb29raW5nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB7IHN0YXJ0VGltZTogY2xhbXBlZFRpbWUsIGxhbmU6IHByb3Bvc2VkTGFuZSwgZGlkU25hcCB9OwogICAgfTsKICAgIGNvbnN0IHB1c2hIaXN0b3J5ID0gKCkgPT4gewogICAgICAgIHNldEhpc3RvcnkocHJldiA9PiB7CiAgICAgICAgICAgIGNvbnN0IG5ld0hpc3RvcnkgPSBbLi4ucHJldiwgdHJhY2tzXTsKICAgICAgICAgICAgaWYgKG5ld0hpc3RvcnkubGVuZ3RoID4gMjApCiAgICAgICAgICAgICAgICBuZXdIaXN0b3J5LnNoaWZ0KCk7CiAgICAgICAgICAgIHJldHVybiBuZXdIaXN0b3J5OwogICAgICAgIH0pOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZVVuZG8gPSAoKSA9PiB7CiAgICAgICAgaWYgKGhpc3RvcnkubGVuZ3RoID09PSAwKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgY29uc3QgcHJldlRyYWNrcyA9IGhpc3RvcnlbaGlzdG9yeS5sZW5ndGggLSAxXTsKICAgICAgICBzZXRUcmFja3MocHJldlRyYWNrcyk7CiAgICAgICAgc2V0SGlzdG9yeShwcmV2ID0+IHByZXYuc2xpY2UoMCwgLTEpKTsKICAgICAgICBzdG9wUGxheWJhY2soKTsKICAgICAgICBzZXRJc1RyaW1Nb2RlKGZhbHNlKTsKICAgICAgICBzZXRUcmltU3RhdGUobnVsbCk7CiAgICAgICAgc2V0SW50ZXJhY3RpdmVNb2RlKG51bGwpOwogICAgfTsKICAgIGNvbnN0IHN0b3BQbGF5YmFjayA9IHVzZUNhbGxiYWNrKCgpID0+IHsKICAgICAgICBhdWRpb1NvdXJjZU5vZGVzLmN1cnJlbnQuZm9yRWFjaChub2RlID0+IHsgdHJ5IHsKICAgICAgICAgICAgbm9kZS5zdG9wKCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlKSB7IH0gfSk7CiAgICAgICAgYXVkaW9Tb3VyY2VOb2Rlcy5jdXJyZW50ID0gW107CiAgICAgICAgc2V0SXNQbGF5aW5nKGZhbHNlKTsKICAgIH0sIFtdKTsKICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgaWYgKCFpc1BsYXlpbmcgfHwgaXNTY3J1YmJpbmcpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBsZXQgYW5pbWF0aW9uRnJhbWVJZDsKICAgICAgICBjb25zdCBjdHggPSBnZXRBdWRpb0NvbnRleHQoKTsKICAgICAgICBjb25zdCBsb29wID0gKCkgPT4gewogICAgICAgICAgICBjb25zdCBlbGFwc2VkID0gY3R4LmN1cnJlbnRUaW1lIC0gc3RhcnRUaW1lUmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHNldEN1cnJlbnRUaW1lKGVsYXBzZWQpOwogICAgICAgICAgICBpZiAodGltZWxpbmVSZWYuY3VycmVudCkgewogICAgICAgICAgICAgICAgY29uc3QgcGxheWhlYWRYID0gZWxhcHNlZCAqIHpvb207CiAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXJXID0gdGltZWxpbmVSZWYuY3VycmVudC5jbGllbnRXaWR0aDsKICAgICAgICAgICAgICAgIGNvbnN0IHNjcm9sbEwgPSB0aW1lbGluZVJlZi5jdXJyZW50LnNjcm9sbExlZnQ7CiAgICAgICAgICAgICAgICBpZiAocGxheWhlYWRYID4gc2Nyb2xsTCArIGNvbnRhaW5lclcgLSA1MCkKICAgICAgICAgICAgICAgICAgICB0aW1lbGluZVJlZi5jdXJyZW50LnNjcm9sbExlZnQgPSBwbGF5aGVhZFggLSA1MDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZWxhcHNlZCA+PSBtYXhEdXJhdGlvbikgewogICAgICAgICAgICAgICAgc3RvcFBsYXliYWNrKCk7CiAgICAgICAgICAgICAgICBzZXRDdXJyZW50VGltZSgwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbkZyYW1lSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGFuaW1hdGlvbkZyYW1lSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7CiAgICAgICAgcmV0dXJuICgpID0+IGNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1hdGlvbkZyYW1lSWQpOwogICAgfSwgW2lzUGxheWluZywgaXNTY3J1YmJpbmcsIG1heER1cmF0aW9uLCB6b29tLCBzdG9wUGxheWJhY2tdKTsKICAgIGNvbnN0IGhhbmRsZVBsYXlQYXVzZSA9IGFzeW5jICgpID0+IHsKICAgICAgICBjb25zdCBjdHggPSBnZXRBdWRpb0NvbnRleHQoKTsKICAgICAgICBpZiAoY3R4LnN0YXRlID09PSAnc3VzcGVuZGVkJykKICAgICAgICAgICAgYXdhaXQgY3R4LnJlc3VtZSgpOwogICAgICAgIGlmIChpc1BsYXlpbmcpIHsKICAgICAgICAgICAgc3RvcFBsYXliYWNrKCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzdG9wUGxheWJhY2soKTsKICAgICAgICAgICAgY29uc3Qgbm93ID0gY3R4LmN1cnJlbnRUaW1lOwogICAgICAgICAgICBzdGFydFRpbWVSZWYuY3VycmVudCA9IG5vdyAtIGN1cnJlbnRUaW1lOwogICAgICAgICAgICB0cmFja3MuZm9yRWFjaCh0cmFjayA9PiB7CiAgICAgICAgICAgICAgICBpZiAodHJhY2suaXNNdXRlZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCB0cmFja1N0YXJ0ID0gdHJhY2suc3RhcnRUaW1lOwogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRUaW1lID4gdHJhY2tTdGFydCArIHRyYWNrLmR1cmF0aW9uKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGxldCBzdGFydE9mZnNldCA9IDA7CiAgICAgICAgICAgICAgICBsZXQgc2NoZWR1bGVUaW1lID0gMDsKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VGltZSA8IHRyYWNrU3RhcnQpIHsKICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZVRpbWUgPSBub3cgKyAodHJhY2tTdGFydCAtIGN1cnJlbnRUaW1lKTsKICAgICAgICAgICAgICAgICAgICBzdGFydE9mZnNldCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZVRpbWUgPSBub3c7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRPZmZzZXQgPSBjdXJyZW50VGltZSAtIHRyYWNrU3RhcnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2UgPSBjdHguY3JlYXRlQnVmZmVyU291cmNlKCk7CiAgICAgICAgICAgICAgICBzb3VyY2UuYnVmZmVyID0gdHJhY2suYnVmZmVyOwogICAgICAgICAgICAgICAgY29uc3QgZ2FpbiA9IGN0eC5jcmVhdGVHYWluKCk7CiAgICAgICAgICAgICAgICBnYWluLmdhaW4udmFsdWUgPSB0cmFjay52b2x1bWU7CiAgICAgICAgICAgICAgICBzb3VyY2UuY29ubmVjdChnYWluKTsKICAgICAgICAgICAgICAgIGdhaW4uY29ubmVjdChjdHguZGVzdGluYXRpb24pOwogICAgICAgICAgICAgICAgaWYgKHN0YXJ0T2Zmc2V0ID49IDAgJiYgc3RhcnRPZmZzZXQgPCB0cmFjay5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgIHNvdXJjZS5zdGFydChzY2hlZHVsZVRpbWUsIHRyYWNrLnRyaW1TdGFydCArIHN0YXJ0T2Zmc2V0LCB0cmFjay5kdXJhdGlvbiAtIHN0YXJ0T2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICBhdWRpb1NvdXJjZU5vZGVzLmN1cnJlbnQucHVzaChzb3VyY2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2V0SXNQbGF5aW5nKHRydWUpOwogICAgICAgIH0KICAgIH07CiAgICBjb25zdCBoYW5kbGVUb2dnbGVSZWNvcmQgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgaWYgKGlzUmVjb3JkaW5nKSB7CiAgICAgICAgICAgIG1lZGlhUmVjb3JkZXJSZWYuY3VycmVudD8uc3RvcCgpOwogICAgICAgICAgICBzZXRJc1JlY29yZGluZyhmYWxzZSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoeyBhdWRpbzogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IG1lZGlhUmVjb3JkZXIgPSBuZXcgTWVkaWFSZWNvcmRlcihzdHJlYW0pOwogICAgICAgICAgICAgICAgY29uc3QgY2h1bmtzID0gW107CiAgICAgICAgICAgICAgICBtZWRpYVJlY29yZGVyLm9uZGF0YWF2YWlsYWJsZSA9IGUgPT4gY2h1bmtzLnB1c2goZS5kYXRhKTsKICAgICAgICAgICAgICAgIG1lZGlhUmVjb3JkZXIub25zdG9wID0gYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihjaHVua3MsIHsgdHlwZTogJ2F1ZGlvL3dlYm0nIH0pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGF1ZGlvQnVmZmVyID0gYXdhaXQgZGVjb2RlQXVkaW9EYXRhKGFycmF5QnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICBwdXNoSGlzdG9yeSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0TGFuZSA9IHRyYWNrcy5sZW5ndGggPiAwID8gTWF0aC5tYXgoLi4udHJhY2tzLm1hcCh0ID0+IHQubGFuZSkpICsgMSA6IDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3VHJhY2sgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSksCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGBSZWNvcmRpbmdgLAogICAgICAgICAgICAgICAgICAgICAgICBidWZmZXI6IGF1ZGlvQnVmZmVyLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWU6IGN1cnJlbnRUaW1lLAogICAgICAgICAgICAgICAgICAgICAgICB0cmltU3RhcnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBhdWRpb0J1ZmZlci5kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgbGFuZTogc3RhcnRMYW5lLAogICAgICAgICAgICAgICAgICAgICAgICB2b2x1bWU6IDEuMCwgaXNNdXRlZDogZmFsc2UsIGlzU29sbzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBUUkFDS19DT0xPUlNbc3RhcnRMYW5lICUgVFJBQ0tfQ09MT1JTLmxlbmd0aF0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHNldFRyYWNrcyhwcmV2ID0+IFsuLi5wcmV2LCBuZXdUcmFja10pOwogICAgICAgICAgICAgICAgICAgIHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKHRyYWNrID0+IHRyYWNrLnN0b3AoKSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgbWVkaWFSZWNvcmRlci5zdGFydCgpOwogICAgICAgICAgICAgICAgc2V0SXNSZWNvcmRpbmcodHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAoIWlzUGxheWluZykKICAgICAgICAgICAgICAgICAgICBoYW5kbGVQbGF5UGF1c2UoKTsKICAgICAgICAgICAgICAgIG1lZGlhUmVjb3JkZXJSZWYuY3VycmVudCA9IG1lZGlhUmVjb3JkZXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCJNaWNyb3Bob25lIGFjY2VzcyBkZW5pZWQgb3IgZXJyb3I6ICIgKyBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICAvLyAtLS0gSW50ZXJhY3Rpb24gSGFuZGxlcnMgLS0tCiAgICBjb25zdCBoYW5kbGVUaW1lbGluZVNjcm9sbCA9IChlKSA9PiBzZXRTY3JvbGxMZWZ0KGUuY3VycmVudFRhcmdldC5zY3JvbGxMZWZ0KTsKICAgIGNvbnN0IHVwZGF0ZVBsYXloZWFkID0gKGNsaWVudFgpID0+IHsKICAgICAgICBpZiAoIXRpbWVsaW5lUmVmLmN1cnJlbnQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCByZWN0ID0gdGltZWxpbmVSZWYuY3VycmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICBjb25zdCByZWxhdGl2ZVggPSBjbGllbnRYIC0gcmVjdC5sZWZ0ICsgdGltZWxpbmVSZWYuY3VycmVudC5zY3JvbGxMZWZ0OwogICAgICAgIGxldCBuZXdUaW1lID0gTWF0aC5tYXgoMCwgcmVsYXRpdmVYIC8gem9vbSk7CiAgICAgICAgLy8gU25hcCBMb2dpYwogICAgICAgIGNvbnN0IHNuYXBTZWNvbmRzID0gU05BUF9USFJFU0hPTERfUFggLyB6b29tOwogICAgICAgIGxldCBjbG9zZXN0U25hcFRpbWUgPSAtMTsKICAgICAgICBsZXQgbWluRGlmZiA9IEluZmluaXR5OwogICAgICAgIGlmIChuZXdUaW1lIDwgc25hcFNlY29uZHMpIHsKICAgICAgICAgICAgY2xvc2VzdFNuYXBUaW1lID0gMDsKICAgICAgICAgICAgbWluRGlmZiA9IG5ld1RpbWU7CiAgICAgICAgfQogICAgICAgIHRyYWNrcy5mb3JFYWNoKHQgPT4gewogICAgICAgICAgICBjb25zdCBzdGFydCA9IHQuc3RhcnRUaW1lOwogICAgICAgICAgICBjb25zdCBlbmQgPSB0LnN0YXJ0VGltZSArIHQuZHVyYXRpb247CiAgICAgICAgICAgIGNvbnN0IGRpZmZTdGFydCA9IE1hdGguYWJzKG5ld1RpbWUgLSBzdGFydCk7CiAgICAgICAgICAgIGlmIChkaWZmU3RhcnQgPCBzbmFwU2Vjb25kcyAmJiBkaWZmU3RhcnQgPCBtaW5EaWZmKSB7CiAgICAgICAgICAgICAgICBjbG9zZXN0U25hcFRpbWUgPSBzdGFydDsKICAgICAgICAgICAgICAgIG1pbkRpZmYgPSBkaWZmU3RhcnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGlmZkVuZCA9IE1hdGguYWJzKG5ld1RpbWUgLSBlbmQpOwogICAgICAgICAgICBpZiAoZGlmZkVuZCA8IHNuYXBTZWNvbmRzICYmIGRpZmZFbmQgPCBtaW5EaWZmKSB7CiAgICAgICAgICAgICAgICBjbG9zZXN0U25hcFRpbWUgPSBlbmQ7CiAgICAgICAgICAgICAgICBtaW5EaWZmID0gZGlmZkVuZDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChjbG9zZXN0U25hcFRpbWUgIT09IC0xKSB7CiAgICAgICAgICAgIGlmIChNYXRoLmFicyhuZXdUaW1lIC0gY2xvc2VzdFNuYXBUaW1lKSA+IDAuMDAxICYmIG5hdmlnYXRvci52aWJyYXRlKQogICAgICAgICAgICAgICAgbmF2aWdhdG9yLnZpYnJhdGUoNSk7CiAgICAgICAgICAgIG5ld1RpbWUgPSBjbG9zZXN0U25hcFRpbWU7CiAgICAgICAgfQogICAgICAgIHNldEN1cnJlbnRUaW1lKG5ld1RpbWUpOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZVBsYXloZWFkUG9pbnRlckRvd24gPSAoZSkgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IHNldElzU2NydWJiaW5nKHRydWUpOyBzdG9wUGxheWJhY2soKTsgZS50YXJnZXQuc2V0UG9pbnRlckNhcHR1cmUoZS5wb2ludGVySWQpOyB9OwogICAgY29uc3QgaGFuZGxlUGxheWhlYWRQb2ludGVyTW92ZSA9IChlKSA9PiB7CiAgICAgICAgaWYgKCFpc1NjcnViYmluZykKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIHVwZGF0ZVBsYXloZWFkKGUuY2xpZW50WCk7CiAgICB9OwogICAgY29uc3QgaGFuZGxlUGxheWhlYWRQb2ludGVyVXAgPSAoZSkgPT4gewogICAgICAgIGlmIChpc1NjcnViYmluZykgewogICAgICAgICAgICBzZXRJc1NjcnViYmluZyhmYWxzZSk7CiAgICAgICAgICAgIGlmIChlLnRhcmdldCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmIGUudGFyZ2V0Lmhhc1BvaW50ZXJDYXB0dXJlKGUucG9pbnRlcklkKSkgewogICAgICAgICAgICAgICAgZS50YXJnZXQucmVsZWFzZVBvaW50ZXJDYXB0dXJlKGUucG9pbnRlcklkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBjb25zdCBoYW5kbGVUaW1lbGluZVBvaW50ZXJEb3duID0gKGUpID0+IHsKICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnLnRyYWNrLWNsaXAnKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcuZmFkZS1oYW5kbGUnKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIC8vIFRoZSBwbGF5aGVhZCBoYW5kbGVzIGl0cyBvd24gY2FwdHVyZSB2aWEgcHJvcGFnYXRpb24gc3RvcCwgc28gd2UgZG9uJ3QgbmVlZCB0byBjaGVjayBleHBsaWNpdGx5IGhlcmUuCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGlmIChpc1BsYXlpbmcpCiAgICAgICAgICAgIHN0b3BQbGF5YmFjaygpOwogICAgICAgIC8vIENsZWFyIHNlbGVjdGlvbgogICAgICAgIHNldFNlbGVjdGVkVHJhY2tJZChudWxsKTsKICAgICAgICBzZXRJc1RyaW1Nb2RlKGZhbHNlKTsKICAgICAgICBzZXRJc1NjcnViYmluZyh0cnVlKTsKICAgICAgICBlLmN1cnJlbnRUYXJnZXQuc2V0UG9pbnRlckNhcHR1cmUoZS5wb2ludGVySWQpOwogICAgICAgIHVwZGF0ZVBsYXloZWFkKGUuY2xpZW50WCk7CiAgICB9OwogICAgY29uc3QgaGFuZGxlRmlsZVVwbG9hZCA9IGFzeW5jIChlKSA9PiB7CiAgICAgICAgY29uc3QgZmlsZXMgPSBlLnRhcmdldC5maWxlczsKICAgICAgICBpZiAoIWZpbGVzIHx8IGZpbGVzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIHNldEFwcFN0YXRlKEFwcFN0YXRlLkxPQURJTkcpOwogICAgICAgIHB1c2hIaXN0b3J5KCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgbmV3VHJhY2tzID0gW107CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0TGFuZSA9IHRyYWNrcy5sZW5ndGggPiAwID8gTWF0aC5tYXgoLi4udHJhY2tzLm1hcCh0ID0+IHQubGFuZSkpICsgMSA6IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBmaWxlc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpOwogICAgICAgICAgICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IGRlY29kZUF1ZGlvRGF0YShhcnJheUJ1ZmZlcik7CiAgICAgICAgICAgICAgICBsZXQgdHJhY2tOYW1lID0gZmlsZS5uYW1lLnN1YnN0cmluZygwLCAxNSk7CiAgICAgICAgICAgICAgICBsZXQgZGV0ZWN0ZWRCcG0gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJwbSA9IGF3YWl0IGRldGVjdEJQTShkZWNvZGVkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYnBtID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZEJwbSA9IGJwbTsKICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2tOYW1lID0gYCR7dHJhY2tOYW1lfSAoJHticG19IEJQTSlgOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIChicG1FcnIpIHsgfQogICAgICAgICAgICAgICAgbmV3VHJhY2tzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSksCiAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJhY2tOYW1lLAogICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjogZGVjb2RlZCwKICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWU6IGN1cnJlbnRUaW1lLCB0cmltU3RhcnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGRlY29kZWQuZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgbGFuZTogc3RhcnRMYW5lICsgaSwKICAgICAgICAgICAgICAgICAgICB2b2x1bWU6IDEuMCwgaXNNdXRlZDogZmFsc2UsIGlzU29sbzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6IFRSQUNLX0NPTE9SU1soc3RhcnRMYW5lICsgaSkgJSBUUkFDS19DT0xPUlMubGVuZ3RoXSwKICAgICAgICAgICAgICAgICAgICBicG06IGRldGVjdGVkQnBtCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRUcmFja3MocHJldiA9PiBbLi4ucHJldiwgLi4ubmV3VHJhY2tzXSk7CiAgICAgICAgICAgIGlmIChuZXdUcmFja3MubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRUcmFja0lkKG5ld1RyYWNrc1tuZXdUcmFja3MubGVuZ3RoIC0gMV0uaWQpOwogICAgICAgICAgICAgICAgc2V0SXNUcmltTW9kZShmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0QXBwU3RhdGUoQXBwU3RhdGUuRURJVElORyk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOwogICAgICAgICAgICBzZXRBcHBTdGF0ZShBcHBTdGF0ZS5FUlJPUik7CiAgICAgICAgfQogICAgICAgIGlmIChmaWxlSW5wdXRSZWYuY3VycmVudCkKICAgICAgICAgICAgZmlsZUlucHV0UmVmLmN1cnJlbnQudmFsdWUgPSAnJzsKICAgIH07CiAgICBjb25zdCB1cGRhdGVUcmFjayA9IChpZCwgdXBkYXRlcykgPT4gc2V0VHJhY2tzKHByZXYgPT4gcHJldi5tYXAodCA9PiB0LmlkID09PSBpZCA/IHsgLi4udCwgLi4udXBkYXRlcyB9IDogdCkpOwogICAgY29uc3QgZGVsZXRlVHJhY2sgPSAoaWQpID0+IHsKICAgICAgICBwdXNoSGlzdG9yeSgpOwogICAgICAgIHNldFRyYWNrcyhwcmV2ID0+IHByZXYuZmlsdGVyKHQgPT4gdC5pZCAhPT0gaWQpKTsKICAgICAgICAvLyBJZiB0aGUgZGVsZXRlZCB0cmFjayB3YXMgZWZmZWN0aXZlbHkgc2VsZWN0ZWQsIGNsZWFyIGV4cGxpY2l0IHNlbGVjdGlvbiBhbmQgZXhpdCB0cmltIG1vZGUKICAgICAgICBpZiAoZWZmZWN0aXZlU2VsZWN0ZWRUcmFja0lkID09PSBpZCkgewogICAgICAgICAgICBzZXRTZWxlY3RlZFRyYWNrSWQobnVsbCk7CiAgICAgICAgICAgIHNldElzVHJpbU1vZGUoZmFsc2UpOwogICAgICAgIH0KICAgICAgICBzZXRTZWxlY3Rpb24obnVsbCk7CiAgICB9OwogICAgLy8gLS0tIFN0YW5kYXJkIEVkaXRpbmcgSGFuZGxlcnMgKEZhZGUsIFRyaW0sIEN1dCkgLS0tCiAgICBjb25zdCBoYW5kbGVGYWRlSGFuZGxlUG9pbnRlckRvd24gPSAoZSkgPT4geyBlLnN0b3BQcm9wYWdhdGlvbigpOyBlLnByZXZlbnREZWZhdWx0KCk7IGUudGFyZ2V0LnNldFBvaW50ZXJDYXB0dXJlKGUucG9pbnRlcklkKTsgc2V0SW50ZXJhY3RpdmVNb2RlKHByZXYgPT4gcHJldiA/IHsgLi4ucHJldiwgaXNEcmFnZ2luZzogdHJ1ZSB9IDogbnVsbCk7IH07CiAgICBjb25zdCBoYW5kbGVGYWRlSGFuZGxlRHJhZyA9IChlLCB0cmFjaykgPT4gewogICAgICAgIGlmICghaW50ZXJhY3RpdmVNb2RlIHx8IGludGVyYWN0aXZlTW9kZS50cmFja0lkICE9PSB0cmFjay5pZCB8fCAhaW50ZXJhY3RpdmVNb2RlLmlzRHJhZ2dpbmcpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBpZiAoIXRpbWVsaW5lUmVmLmN1cnJlbnQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCByZWN0ID0gdGltZWxpbmVSZWYuY3VycmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICBjb25zdCBwb2ludGVyVGltZSA9IE1hdGgubWF4KDAsICgoZS5jbGllbnRYIC0gcmVjdC5sZWZ0KSArIHRpbWVsaW5lUmVmLmN1cnJlbnQuc2Nyb2xsTGVmdCkgLyB6b29tKTsKICAgICAgICBjb25zdCByZWxhdGl2ZVBvaW50ZXJUaW1lID0gcG9pbnRlclRpbWUgLSB0cmFjay5zdGFydFRpbWU7CiAgICAgICAgbGV0IG5ld0R1cmF0aW9uID0gMDsKICAgICAgICBpZiAoaW50ZXJhY3RpdmVNb2RlLnR5cGUgPT09ICdmYWRlSW4nKSB7CiAgICAgICAgICAgIG5ld0R1cmF0aW9uID0gTWF0aC5tYXgoMCwgTWF0aC5taW4odHJhY2suZHVyYXRpb24sIHJlbGF0aXZlUG9pbnRlclRpbWUpKTsKICAgICAgICAgICAgdXBkYXRlVHJhY2sodHJhY2suaWQsIHsgYWN0aXZlRWZmZWN0czogeyAuLi50cmFjay5hY3RpdmVFZmZlY3RzLCBmYWRlSW46IG5ld0R1cmF0aW9uIH0gfSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBjb25zdCBlbmQgPSB0cmFjay5kdXJhdGlvbjsKICAgICAgICAgICAgbmV3RHVyYXRpb24gPSBNYXRoLm1heCgwLCBNYXRoLm1pbih0cmFjay5kdXJhdGlvbiwgZW5kIC0gcmVsYXRpdmVQb2ludGVyVGltZSkpOwogICAgICAgICAgICB1cGRhdGVUcmFjayh0cmFjay5pZCwgeyBhY3RpdmVFZmZlY3RzOiB7IC4uLnRyYWNrLmFjdGl2ZUVmZmVjdHMsIGZhZGVPdXQ6IG5ld0R1cmF0aW9uIH0gfSk7CiAgICAgICAgfQogICAgfTsKICAgIGNvbnN0IGhhbmRsZUZhZGVIYW5kbGVQb2ludGVyVXAgPSBhc3luYyAoZSwgdHJhY2spID0+IHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGUudGFyZ2V0LnJlbGVhc2VQb2ludGVyQ2FwdHVyZShlLnBvaW50ZXJJZCk7CiAgICAgICAgc2V0SW50ZXJhY3RpdmVNb2RlKHByZXYgPT4gcHJldiA/IHsgLi4ucHJldiwgaXNEcmFnZ2luZzogZmFsc2UgfSA6IG51bGwpOwogICAgICAgIC8vIFRyaWdnZXIgZWZmZWN0IGFwcGxpY2F0aW9uIHBpcGVsaW5lIHdpdGggY3VycmVudCBmYWRlIHZhbHVlcwogICAgICAgIGlmICh0cmFjay5hY3RpdmVFZmZlY3RzKSB7CiAgICAgICAgICAgIGhhbmRsZUFwcGx5RWZmZWN0KCdhcHBseUFjdGl2ZUZhZGVzJyk7IC8vIEN1c3RvbSBJRCB0byB0cmlnZ2VyIHJlLXByb2Nlc3MKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgaGFuZGxlVHJpbVBvaW50ZXJEb3duID0gKGUsIHRyYWNrLCBzaWRlKSA9PiB7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IGUucHJldmVudERlZmF1bHQoKTsgc2V0VHJpbVN0YXRlKHsgaXNEcmFnZ2luZzogdHJ1ZSwgc2lkZSwgaW5pdGlhbE1vdXNlWDogZS5jbGllbnRYLCBpbml0aWFsU3RhcnRUaW1lOiB0cmFjay5zdGFydFRpbWUsIGluaXRpYWxUcmltU3RhcnQ6IHRyYWNrLnRyaW1TdGFydCwgaW5pdGlhbER1cmF0aW9uOiB0cmFjay5kdXJhdGlvbiwgY3VycmVudERlbHRhOiAwIH0pOyBlLnRhcmdldC5zZXRQb2ludGVyQ2FwdHVyZShlLnBvaW50ZXJJZCk7IH07CiAgICBjb25zdCBoYW5kbGVUcmltUG9pbnRlck1vdmUgPSAoZSkgPT4gewogICAgICAgIGlmICghdHJpbVN0YXRlIHx8ICF0cmltU3RhdGUuaXNEcmFnZ2luZykKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgY29uc3QgcmF3RGVsdGEgPSAoZS5jbGllbnRYIC0gdHJpbVN0YXRlLmluaXRpYWxNb3VzZVgpIC8gem9vbTsKICAgICAgICBsZXQgZmluYWxEZWx0YSA9IHJhd0RlbHRhOwogICAgICAgIGNvbnN0IHNuYXBTZWNvbmRzID0gU05BUF9USFJFU0hPTERfUFggLyB6b29tOwogICAgICAgIGlmICh0cmltU3RhdGUuc2lkZSA9PT0gJ3N0YXJ0JykgewogICAgICAgICAgICAvLyBTbmFwIHN0YXJ0IGhhbmRsZSB0byBwbGF5aGVhZAogICAgICAgICAgICBjb25zdCBwcm9wb3NlZFN0YXJ0ID0gdHJpbVN0YXRlLmluaXRpYWxTdGFydFRpbWUgKyByYXdEZWx0YTsKICAgICAgICAgICAgaWYgKE1hdGguYWJzKHByb3Bvc2VkU3RhcnQgLSBjdXJyZW50VGltZSkgPCBzbmFwU2Vjb25kcykgewogICAgICAgICAgICAgICAgZmluYWxEZWx0YSA9IGN1cnJlbnRUaW1lIC0gdHJpbVN0YXRlLmluaXRpYWxTdGFydFRpbWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIFNuYXAgZW5kIGhhbmRsZSB0byBwbGF5aGVhZAogICAgICAgICAgICAvLyBWaXN1YWwgRW5kID0gU3RhcnRUaW1lICsgRHVyYXRpb24KICAgICAgICAgICAgLy8gTmV3IER1cmF0aW9uID0gSW5pdGlhbER1cmF0aW9uICsgRGVsdGEKICAgICAgICAgICAgLy8gTmV3IEVuZCA9IEluaXRpYWxTdGFydFRpbWUgKyBJbml0aWFsRHVyYXRpb24gKyBEZWx0YQogICAgICAgICAgICBjb25zdCBwcm9wb3NlZEVuZCA9IHRyaW1TdGF0ZS5pbml0aWFsU3RhcnRUaW1lICsgdHJpbVN0YXRlLmluaXRpYWxEdXJhdGlvbiArIHJhd0RlbHRhOwogICAgICAgICAgICBpZiAoTWF0aC5hYnMocHJvcG9zZWRFbmQgLSBjdXJyZW50VGltZSkgPCBzbmFwU2Vjb25kcykgewogICAgICAgICAgICAgICAgZmluYWxEZWx0YSA9IGN1cnJlbnRUaW1lIC0gKHRyaW1TdGF0ZS5pbml0aWFsU3RhcnRUaW1lICsgdHJpbVN0YXRlLmluaXRpYWxEdXJhdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc2V0VHJpbVN0YXRlKHByZXYgPT4gcHJldiA/IHsgLi4ucHJldiwgY3VycmVudERlbHRhOiBmaW5hbERlbHRhIH0gOiBudWxsKTsKICAgIH07CiAgICBjb25zdCBoYW5kbGVUcmltUG9pbnRlclVwID0gKGUsIHRyYWNrKSA9PiB7CiAgICAgICAgaWYgKCF0cmltU3RhdGUgfHwgIXRyaW1TdGF0ZS5pc0RyYWdnaW5nKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBlLnRhcmdldC5yZWxlYXNlUG9pbnRlckNhcHR1cmUoZS5wb2ludGVySWQpOwogICAgICAgIGNvbnN0IHsgc2lkZSwgY3VycmVudERlbHRhLCBpbml0aWFsU3RhcnRUaW1lLCBpbml0aWFsVHJpbVN0YXJ0LCBpbml0aWFsRHVyYXRpb24gfSA9IHRyaW1TdGF0ZTsKICAgICAgICBjb25zdCBvcmlnaW5hbEZpbGVEdXJhdGlvbiA9IHRyYWNrLmJ1ZmZlci5kdXJhdGlvbjsKICAgICAgICBjb25zdCBNSU5fRFVSQVRJT04gPSAwLjE7CiAgICAgICAgbGV0IG5ld1RyaW1TdGFydCA9IGluaXRpYWxUcmltU3RhcnQ7CiAgICAgICAgbGV0IG5ld0R1cmF0aW9uID0gaW5pdGlhbER1cmF0aW9uOwogICAgICAgIGxldCBuZXdTdGFydFRpbWUgPSBpbml0aWFsU3RhcnRUaW1lOwogICAgICAgIGlmIChzaWRlID09PSAnc3RhcnQnKSB7CiAgICAgICAgICAgIGxldCBwcm9wb3NlZFRyaW1TdGFydCA9IGluaXRpYWxUcmltU3RhcnQgKyBjdXJyZW50RGVsdGE7CiAgICAgICAgICAgIHByb3Bvc2VkVHJpbVN0YXJ0ID0gTWF0aC5tYXgoMCwgcHJvcG9zZWRUcmltU3RhcnQpOwogICAgICAgICAgICBjb25zdCBvcmlnaW5hbEVuZFBvaW50ID0gaW5pdGlhbFRyaW1TdGFydCArIGluaXRpYWxEdXJhdGlvbjsKICAgICAgICAgICAgcHJvcG9zZWRUcmltU3RhcnQgPSBNYXRoLm1pbihwcm9wb3NlZFRyaW1TdGFydCwgb3JpZ2luYWxFbmRQb2ludCAtIE1JTl9EVVJBVElPTik7CiAgICAgICAgICAgIGNvbnN0IGNoYW5nZSA9IHByb3Bvc2VkVHJpbVN0YXJ0IC0gaW5pdGlhbFRyaW1TdGFydDsKICAgICAgICAgICAgbmV3VHJpbVN0YXJ0ID0gcHJvcG9zZWRUcmltU3RhcnQ7CiAgICAgICAgICAgIG5ld1N0YXJ0VGltZSA9IGluaXRpYWxTdGFydFRpbWUgKyBjaGFuZ2U7CiAgICAgICAgICAgIG5ld0R1cmF0aW9uID0gaW5pdGlhbER1cmF0aW9uIC0gY2hhbmdlOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbGV0IHByb3Bvc2VkRHVyYXRpb24gPSBpbml0aWFsRHVyYXRpb24gKyBjdXJyZW50RGVsdGE7CiAgICAgICAgICAgIHByb3Bvc2VkRHVyYXRpb24gPSBNYXRoLm1heChNSU5fRFVSQVRJT04sIHByb3Bvc2VkRHVyYXRpb24pOwogICAgICAgICAgICBjb25zdCBtYXhQb3NzaWJsZUR1cmF0aW9uID0gb3JpZ2luYWxGaWxlRHVyYXRpb24gLSBpbml0aWFsVHJpbVN0YXJ0OwogICAgICAgICAgICBwcm9wb3NlZER1cmF0aW9uID0gTWF0aC5taW4ocHJvcG9zZWREdXJhdGlvbiwgbWF4UG9zc2libGVEdXJhdGlvbik7CiAgICAgICAgICAgIG5ld0R1cmF0aW9uID0gcHJvcG9zZWREdXJhdGlvbjsKICAgICAgICB9CiAgICAgICAgcHVzaEhpc3RvcnkoKTsKICAgICAgICB1cGRhdGVUcmFjayh0cmFjay5pZCwgeyBzdGFydFRpbWU6IG5ld1N0YXJ0VGltZSwgdHJpbVN0YXJ0OiBuZXdUcmltU3RhcnQsIGR1cmF0aW9uOiBuZXdEdXJhdGlvbiB9KTsKICAgICAgICBzZXRUcmltU3RhdGUobnVsbCk7CiAgICB9OwogICAgY29uc3QgaGFuZGxlVHJhY2tQb2ludGVyRG93biA9IChlLCB0cmFjaykgPT4geyBpZiAoZS50YXJnZXQuY2xvc2VzdCgnYnV0dG9uJykpCiAgICAgICAgcmV0dXJuOyBpZiAoaXNUcmltTW9kZSB8fCBpbnRlcmFjdGl2ZU1vZGUpCiAgICAgICAgcmV0dXJuOyBlLnByZXZlbnREZWZhdWx0KCk7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IGlmIChpc1BsYXlpbmcpCiAgICAgICAgc3RvcFBsYXliYWNrKCk7IGlmICghdGltZWxpbmVSZWYuY3VycmVudCkKICAgICAgICByZXR1cm47IGNvbnN0IHJlY3QgPSB0aW1lbGluZVJlZi5jdXJyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOyBjb25zdCB3b3JsZFRpbWUgPSAoKGUuY2xpZW50WCAtIHJlY3QubGVmdCkgKyB0aW1lbGluZVJlZi5jdXJyZW50LnNjcm9sbExlZnQpIC8gem9vbTsgZHJhZ1JlZi5jdXJyZW50ID0geyBzdGFydFg6IGUuY2xpZW50WCwgc3RhcnRZOiBlLmNsaWVudFksIG9mZnNldFRpbWU6IHdvcmxkVGltZSAtIHRyYWNrLnN0YXJ0VGltZSwgdHJhY2tJZDogdHJhY2suaWQsIGxhc3RQb2ludGVyWDogZS5jbGllbnRYLCBsYXN0UG9pbnRlclk6IGUuY2xpZW50WSB9OyBsb25nUHJlc3NUaW1lclJlZi5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7IHNldERyYWdnaW5nVHJhY2tJZCh0cmFjay5pZCk7IHNldFNlbGVjdGVkVHJhY2tJZCh0cmFjay5pZCk7IHNldElzVHJpbU1vZGUoZmFsc2UpOyBpZiAobmF2aWdhdG9yLnZpYnJhdGUpCiAgICAgICAgbmF2aWdhdG9yLnZpYnJhdGUoMTApOyBpZiAoZS50YXJnZXQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkKICAgICAgICBlLnRhcmdldC5zZXRQb2ludGVyQ2FwdHVyZShlLnBvaW50ZXJJZCk7IH0sIDEwMCk7IH07CiAgICBjb25zdCBoYW5kbGVUcmFja1BvaW50ZXJVcCA9IChlKSA9PiB7IGlmIChsb25nUHJlc3NUaW1lclJlZi5jdXJyZW50KSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KGxvbmdQcmVzc1RpbWVyUmVmLmN1cnJlbnQpOwogICAgICAgIGxvbmdQcmVzc1RpbWVyUmVmLmN1cnJlbnQgPSBudWxsOwogICAgICAgIGlmICghZHJhZ2dpbmdUcmFja0lkICYmIGRyYWdSZWYuY3VycmVudC50cmFja0lkKQogICAgICAgICAgICBzZXRTZWxlY3RlZFRyYWNrSWQoZHJhZ1JlZi5jdXJyZW50LnRyYWNrSWQpOwogICAgfSBpZiAoZHJhZ2dpbmdUcmFja0lkKSB7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBpZiAoZS50YXJnZXQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkKICAgICAgICAgICAgZS50YXJnZXQucmVsZWFzZVBvaW50ZXJDYXB0dXJlKGUucG9pbnRlcklkKTsKICAgICAgICBzZXREcmFnZ2luZ1RyYWNrSWQobnVsbCk7CiAgICB9IH07CiAgICBjb25zdCBoYW5kbGVUcmFja0RyYWdNb3ZlID0gKGUpID0+IHsKICAgICAgICBkcmFnUmVmLmN1cnJlbnQubGFzdFBvaW50ZXJYID0gZS5jbGllbnRYOwogICAgICAgIGRyYWdSZWYuY3VycmVudC5sYXN0UG9pbnRlclkgPSBlLmNsaWVudFk7CiAgICAgICAgaWYgKGxvbmdQcmVzc1RpbWVyUmVmLmN1cnJlbnQgJiYgIWRyYWdnaW5nVHJhY2tJZCkgewogICAgICAgICAgICBpZiAoTWF0aC5oeXBvdChlLmNsaWVudFggLSBkcmFnUmVmLmN1cnJlbnQuc3RhcnRYLCBlLmNsaWVudFkgLSBkcmFnUmVmLmN1cnJlbnQuc3RhcnRZKSA+IDEwKSB7CiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobG9uZ1ByZXNzVGltZXJSZWYuY3VycmVudCk7CiAgICAgICAgICAgICAgICBsb25nUHJlc3NUaW1lclJlZi5jdXJyZW50ID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICghZHJhZ2dpbmdUcmFja0lkIHx8ICF0aW1lbGluZVJlZi5jdXJyZW50KQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgY29uc3QgeyB0cmFja0lkIH0gPSBkcmFnUmVmLmN1cnJlbnQ7CiAgICAgICAgY29uc3QgcmVjdCA9IHRpbWVsaW5lUmVmLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgY29uc3Qgd29ybGRUaW1lID0gTWF0aC5tYXgoMCwgKChlLmNsaWVudFggLSByZWN0LmxlZnQpICsgdGltZWxpbmVSZWYuY3VycmVudC5zY3JvbGxMZWZ0KSAvIHpvb20pOwogICAgICAgIGNvbnN0IHJhd1N0YXJ0VGltZSA9IE1hdGgubWF4KDAsIHdvcmxkVGltZSAtIGRyYWdSZWYuY3VycmVudC5vZmZzZXRUaW1lKTsKICAgICAgICBjb25zdCByYXdMYW5lID0gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcigoZS5jbGllbnRZIC0gcmVjdC50b3ApIC8gTEFORV9IRUlHSFQpKTsKICAgICAgICBjb25zdCB0cmFjayA9IHRyYWNrc1JlZi5jdXJyZW50LmZpbmQodCA9PiB0LmlkID09PSB0cmFja0lkKTsKICAgICAgICBpZiAoIXRyYWNrKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgY29uc3QgY2xhbXBlZCA9IGNhbGN1bGF0ZUNsYW1wZWRUcmFja1Bvc2l0aW9uKHRyYWNrSWQsIHRyYWNrLmR1cmF0aW9uLCByYXdTdGFydFRpbWUsIHJhd0xhbmUsIHRyYWNrc1JlZi5jdXJyZW50LCB6b29tLCBjdXJyZW50VGltZSwgdHJhY2sudHJpbVN0YXJ0IC8vIFBhc3MgdGhlIGRyYWdnaW5nIHRyYWNrJ3MgdHJpbVN0YXJ0IGZvciBvZmZzZXQgY2FsY3VsYXRpb25zCiAgICAgICAgKTsKICAgICAgICB1cGRhdGVUcmFjayh0cmFja0lkLCB7IHN0YXJ0VGltZTogY2xhbXBlZC5zdGFydFRpbWUsIGxhbmU6IGNsYW1wZWQubGFuZSB9KTsKICAgIH07CiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgIGlmICghZHJhZ2dpbmdUcmFja0lkKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgbGV0IHJhZklkOwogICAgICAgIGNvbnN0IHNjcm9sbExvb3AgPSAoKSA9PiB7CiAgICAgICAgICAgIGlmICghdGltZWxpbmVSZWYuY3VycmVudCB8fCAhZHJhZ2dpbmdUcmFja0lkKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBjdXJyZW50VHJhY2tzID0gdHJhY2tzUmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIGNvbnN0IHRyYWNrID0gY3VycmVudFRyYWNrcy5maW5kKHQgPT4gdC5pZCA9PT0gZHJhZ2dpbmdUcmFja0lkKTsKICAgICAgICAgICAgaWYgKCF0cmFjaykKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcmVjdCA9IHRpbWVsaW5lUmVmLmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGNvbnN0IHBvaW50ZXJYID0gZHJhZ1JlZi5jdXJyZW50Lmxhc3RQb2ludGVyWDsKICAgICAgICAgICAgY29uc3QgU0NST0xMX1NQRUVEID0gMTU7CiAgICAgICAgICAgIGxldCBkaWRTY3JvbGwgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHBvaW50ZXJYIDwgcmVjdC5sZWZ0ICsgNTApIHsKICAgICAgICAgICAgICAgIHRpbWVsaW5lUmVmLmN1cnJlbnQuc2Nyb2xsTGVmdCAtPSBTQ1JPTExfU1BFRUQ7CiAgICAgICAgICAgICAgICBkaWRTY3JvbGwgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHBvaW50ZXJYID4gcmVjdC5yaWdodCAtIDUwKSB7CiAgICAgICAgICAgICAgICB0aW1lbGluZVJlZi5jdXJyZW50LnNjcm9sbExlZnQgKz0gU0NST0xMX1NQRUVEOwogICAgICAgICAgICAgICAgZGlkU2Nyb2xsID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGlkU2Nyb2xsKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3b3JsZFRpbWUgPSBNYXRoLm1heCgwLCAoKHBvaW50ZXJYIC0gcmVjdC5sZWZ0KSArIHRpbWVsaW5lUmVmLmN1cnJlbnQuc2Nyb2xsTGVmdCkgLyB6b29tKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJhd1N0YXJ0VGltZSA9IE1hdGgubWF4KDAsIHdvcmxkVGltZSAtIGRyYWdSZWYuY3VycmVudC5vZmZzZXRUaW1lKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJhd0xhbmUgPSBNYXRoLm1heCgwLCBNYXRoLmZsb29yKChkcmFnUmVmLmN1cnJlbnQubGFzdFBvaW50ZXJZIC0gcmVjdC50b3ApIC8gTEFORV9IRUlHSFQpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNsYW1wZWQgPSBjYWxjdWxhdGVDbGFtcGVkVHJhY2tQb3NpdGlvbihkcmFnZ2luZ1RyYWNrSWQsIHRyYWNrLmR1cmF0aW9uLCByYXdTdGFydFRpbWUsIHJhd0xhbmUsIGN1cnJlbnRUcmFja3MsIHpvb20sIGN1cnJlbnRUaW1lLCB0cmFjay50cmltU3RhcnQpOwogICAgICAgICAgICAgICAgc2V0VHJhY2tzKHByZXYgPT4gcHJldi5tYXAodCA9PiB0LmlkID09PSBkcmFnZ2luZ1RyYWNrSWQgPyB7IC4uLnQsIHN0YXJ0VGltZTogY2xhbXBlZC5zdGFydFRpbWUsIGxhbmU6IGNsYW1wZWQubGFuZSB9IDogdCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJhZklkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHNjcm9sbExvb3ApOwogICAgICAgIH07CiAgICAgICAgcmFmSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc2Nyb2xsTG9vcCk7CiAgICAgICAgcmV0dXJuICgpID0+IGNhbmNlbEFuaW1hdGlvbkZyYW1lKHJhZklkKTsKICAgIH0sIFtkcmFnZ2luZ1RyYWNrSWQsIHpvb20sIGN1cnJlbnRUaW1lXSk7CiAgICBjb25zdCBoYW5kbGVDcm9wID0gKCkgPT4gewogICAgICAgIGlmICghZWZmZWN0aXZlU2VsZWN0ZWRUcmFja0lkKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKHNlbGVjdGlvbikgewogICAgICAgICAgICBjb25zdCB0cmFjayA9IHRyYWNrcy5maW5kKHQgPT4gdC5pZCA9PT0gZWZmZWN0aXZlU2VsZWN0ZWRUcmFja0lkKTsKICAgICAgICAgICAgaWYgKCF0cmFjaykKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgcHVzaEhpc3RvcnkoKTsKICAgICAgICAgICAgY29uc3QgcmVsU3RhcnQgPSBNYXRoLm1heCgwLCBzZWxlY3Rpb24uc3RhcnQgLSB0cmFjay5zdGFydFRpbWUpOwogICAgICAgICAgICBjb25zdCByZWxFbmQgPSBNYXRoLm1pbih0cmFjay5kdXJhdGlvbiwgc2VsZWN0aW9uLmVuZCAtIHRyYWNrLnN0YXJ0VGltZSk7CiAgICAgICAgICAgIGlmIChyZWxFbmQgPiByZWxTdGFydCkgewogICAgICAgICAgICAgICAgY29uc3QgbmV3VHJpbVN0YXJ0ID0gdHJhY2sudHJpbVN0YXJ0ICsgcmVsU3RhcnQ7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdEdXJhdGlvbiA9IHJlbEVuZCAtIHJlbFN0YXJ0OwogICAgICAgICAgICAgICAgdXBkYXRlVHJhY2soZWZmZWN0aXZlU2VsZWN0ZWRUcmFja0lkLCB7IHRyaW1TdGFydDogbmV3VHJpbVN0YXJ0LCBkdXJhdGlvbjogbmV3RHVyYXRpb24sIHN0YXJ0VGltZTogc2VsZWN0aW9uLnN0YXJ0IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldFNlbGVjdGlvbihudWxsKTsKICAgICAgICAgICAgc2V0SXNUcmltTW9kZShmYWxzZSk7CiAgICAgICAgICAgIHN0b3BQbGF5YmFjaygpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29uc3Qgd2lsbEVuYWJsZSA9ICFpc1RyaW1Nb2RlOwogICAgICAgICAgICAvLyBJZiBlbnRlcmluZyB0cmltIG1vZGUgdmlhIGF1dG8tc2VsZWN0aW9uLCBsb2NrIHRoZSBzZWxlY3Rpb24gdG8gcHJldmVudCBpdCBmcm9tIGNoYW5naW5nIGlmIHBsYXloZWFkIG1vdmVzCiAgICAgICAgICAgIGlmICh3aWxsRW5hYmxlICYmICFzZWxlY3RlZFRyYWNrSWQpIHsKICAgICAgICAgICAgICAgIHNldFNlbGVjdGVkVHJhY2tJZChlZmZlY3RpdmVTZWxlY3RlZFRyYWNrSWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldElzVHJpbU1vZGUod2lsbEVuYWJsZSk7CiAgICAgICAgICAgIGlmICghd2lsbEVuYWJsZSkKICAgICAgICAgICAgICAgIHNldFRyaW1TdGF0ZShudWxsKTsKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgaGFuZGxlQ3V0ID0gKCkgPT4gewogICAgICAgIGlmICghZWZmZWN0aXZlU2VsZWN0ZWRUcmFja0lkKSB7CiAgICAgICAgICAgIGFsZXJ0KCJTZWxlY3QgYSB0cmFjayB0byBjdXQuIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgdHJhY2sgPSB0cmFja3NSZWYuY3VycmVudC5maW5kKHQgPT4gdC5pZCA9PT0gZWZmZWN0aXZlU2VsZWN0ZWRUcmFja0lkKTsKICAgICAgICBpZiAoIXRyYWNrKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgY29uc3QgcmVsVGltZSA9IGN1cnJlbnRUaW1lIC0gdHJhY2suc3RhcnRUaW1lOwogICAgICAgIGlmIChyZWxUaW1lIDw9IDAuMDUgfHwgcmVsVGltZSA+PSB0cmFjay5kdXJhdGlvbiAtIDAuMDUpIHsKICAgICAgICAgICAgYWxlcnQoIlBsYWNlIHBsYXloZWFkIGluc2lkZSB0cmFjay4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBzcGxpdFBvaW50SW5GaWxlID0gdHJhY2sudHJpbVN0YXJ0ICsgcmVsVGltZTsKICAgICAgICBwdXNoSGlzdG9yeSgpOwogICAgICAgIGNvbnN0IHQxID0geyAuLi50cmFjaywgaWQ6IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KSwgbmFtZTogYCR7dHJhY2submFtZX0gQWAsIGR1cmF0aW9uOiByZWxUaW1lLCBicG06IHRyYWNrLmJwbSB9OwogICAgICAgIGNvbnN0IHQyID0geyAuLi50cmFjaywgaWQ6IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KSwgbmFtZTogYCR7dHJhY2submFtZX0gQmAsIHN0YXJ0VGltZTogdHJhY2suc3RhcnRUaW1lICsgcmVsVGltZSwgdHJpbVN0YXJ0OiBzcGxpdFBvaW50SW5GaWxlLCBkdXJhdGlvbjogdHJhY2suZHVyYXRpb24gLSByZWxUaW1lLCBicG06IHRyYWNrLmJwbSB9OwogICAgICAgIHNldFRyYWNrcyhwcmV2ID0+IHsKICAgICAgICAgICAgY29uc3QgaWR4ID0gcHJldi5maW5kSW5kZXgodCA9PiB0LmlkID09PSB0cmFjay5pZCk7CiAgICAgICAgICAgIGNvbnN0IG4gPSBbLi4ucHJldl07CiAgICAgICAgICAgIG4uc3BsaWNlKGlkeCwgMSwgdDEsIHQyKTsKICAgICAgICAgICAgcmV0dXJuIG47CiAgICAgICAgfSk7CiAgICAgICAgc2V0U2VsZWN0ZWRUcmFja0lkKHQyLmlkKTsKICAgICAgICBzZXRJc1RyaW1Nb2RlKGZhbHNlKTsKICAgICAgICBzdG9wUGxheWJhY2soKTsKICAgIH07CiAgICAvLyAtLS0gUkVGQUNUT1JFRCBFRkZFQ1QgUElQRUxJTkUgLS0tCiAgICBjb25zdCBoYW5kbGVBcHBseUVmZmVjdCA9IGFzeW5jIChlZmZlY3RJZCwgcGFyYW1zKSA9PiB7CiAgICAgICAgaWYgKCFlZmZlY3RpdmVTZWxlY3RlZFRyYWNrSWQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjb25zdCB0cmFjayA9IHRyYWNrcy5maW5kKHQgPT4gdC5pZCA9PT0gZWZmZWN0aXZlU2VsZWN0ZWRUcmFja0lkKTsKICAgICAgICBpZiAoIXRyYWNrKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgLy8gMS4gSGFuZGxlIEludGVyYWN0aXZlIFNsaWRlciBTZXR1cCAoVUkgb25seSkKICAgICAgICBpZiAocGFyYW1zPy5pbnRlcmFjdGl2ZSkgewogICAgICAgICAgICAvLyBMb2NrIHNlbGVjdGlvbiBmb3IgaW50ZXJhY3RpdmUgbW9kZQogICAgICAgICAgICBpZiAoIXNlbGVjdGVkVHJhY2tJZCkKICAgICAgICAgICAgICAgIHNldFNlbGVjdGVkVHJhY2tJZChlZmZlY3RpdmVTZWxlY3RlZFRyYWNrSWQpOwogICAgICAgICAgICBzZXRJbnRlcmFjdGl2ZU1vZGUoeyB0eXBlOiBlZmZlY3RJZCwgdHJhY2tJZDogdHJhY2suaWQsIGlzRHJhZ2dpbmc6IGZhbHNlIH0pOwogICAgICAgICAgICBjb25zdCBkZWZhdWx0RmFkZSA9IE1hdGgubWluKHRyYWNrLmR1cmF0aW9uLCAyLjApOwogICAgICAgICAgICAvLyBJbml0aWFsaXplIGFjdGl2ZUVmZmVjdHMgaWYgbWlzc2luZwogICAgICAgICAgICBjb25zdCBjdXJyZW50RWZmZWN0cyA9IHRyYWNrLmFjdGl2ZUVmZmVjdHMgfHwge307CiAgICAgICAgICAgIGlmIChlZmZlY3RJZCA9PT0gJ2ZhZGVJbicgJiYgIWN1cnJlbnRFZmZlY3RzLmZhZGVJbikgewogICAgICAgICAgICAgICAgdXBkYXRlVHJhY2sodHJhY2suaWQsIHsgYWN0aXZlRWZmZWN0czogeyAuLi5jdXJyZW50RWZmZWN0cywgZmFkZUluOiBkZWZhdWx0RmFkZSB9IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlZmZlY3RJZCA9PT0gJ2ZhZGVPdXQnICYmICFjdXJyZW50RWZmZWN0cy5mYWRlT3V0KSB7CiAgICAgICAgICAgICAgICB1cGRhdGVUcmFjayh0cmFjay5pZCwgeyBhY3RpdmVFZmZlY3RzOiB7IC4uLmN1cnJlbnRFZmZlY3RzLCBmYWRlT3V0OiBkZWZhdWx0RmFkZSB9IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcHVzaEhpc3RvcnkoKTsKICAgICAgICBzZXRBcHBTdGF0ZShBcHBTdGF0ZS5QUk9DRVNTSU5HKTsKICAgICAgICBzdG9wUGxheWJhY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyAtLS0gMi4gSGFuZGxlIENyb3NzZmFkZSAoRGVzdHJ1Y3RpdmUvU3RydWN0dXJhbCkgLS0tCiAgICAgICAgICAgIGlmIChlZmZlY3RJZCA9PT0gJ2Nyb3NzZmFkZScpIHsKICAgICAgICAgICAgICAgIGlmIChwYXJhbXM/LnJlc3RvcmUgJiYgdHJhY2suY3Jvc3NmYWRlTWV0YWRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAvLyBSZXN0b3JlIGxvZ2ljCiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBsZWZ0LCByaWdodCB9ID0gdHJhY2suY3Jvc3NmYWRlTWV0YWRhdGE7CiAgICAgICAgICAgICAgICAgICAgc2V0VHJhY2tzKHByZXYgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpZHggPSBwcmV2LmZpbmRJbmRleCh0ID0+IHQuaWQgPT09IHRyYWNrLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IFsuLi5wcmV2XTsKICAgICAgICAgICAgICAgICAgICAgICAgbi5zcGxpY2UoaWR4LCAxLCB7IC4uLmxlZnQsIGlkOiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSkgfSwgeyAuLi5yaWdodCwgaWQ6IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG47CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRUcmFja0lkKG51bGwpOwogICAgICAgICAgICAgICAgICAgIHNldEFwcFN0YXRlKEFwcFN0YXRlLkVESVRJTkcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIEFwcGx5IGxvZ2ljCiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IHBhcmFtcz8uZHVyYXRpb24gfHwgMS4wOwogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0TGFuZSA9IHRyYWNrLmxhbmU7CiAgICAgICAgICAgICAgICBjb25zdCBzcGxpdFRpbWUgPSBjdXJyZW50VGltZTsKICAgICAgICAgICAgICAgIGNvbnN0IHRocmVzaG9sZCA9IDAuMTsKICAgICAgICAgICAgICAgIGNvbnN0IGxlZnRUcmFjayA9IHRyYWNrcy5maW5kKHQgPT4gdC5sYW5lID09PSB0YXJnZXRMYW5lICYmIE1hdGguYWJzKCh0LnN0YXJ0VGltZSArIHQuZHVyYXRpb24pIC0gc3BsaXRUaW1lKSA8IHRocmVzaG9sZCk7CiAgICAgICAgICAgICAgICBjb25zdCByaWdodFRyYWNrID0gdHJhY2tzLmZpbmQodCA9PiB0LmxhbmUgPT09IHRhcmdldExhbmUgJiYgTWF0aC5hYnModC5zdGFydFRpbWUgLSBzcGxpdFRpbWUpIDwgdGhyZXNob2xkKTsKICAgICAgICAgICAgICAgIGlmIChsZWZ0VHJhY2sgJiYgcmlnaHRUcmFjaykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lcmdlZEJ1ZmZlciA9IGF3YWl0IG1lcmdlQnVmZmVycyhsZWZ0VHJhY2suYnVmZmVyLCByaWdodFRyYWNrLmJ1ZmZlciwgZHVyYXRpb24pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1RyYWNrID0gewogICAgICAgICAgICAgICAgICAgICAgICBpZDogTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBgTWVyZ2VkICgke2xlZnRUcmFjay5uYW1lfSArICR7cmlnaHRUcmFjay5uYW1lfSlgLAogICAgICAgICAgICAgICAgICAgICAgICBidWZmZXI6IG1lcmdlZEJ1ZmZlciwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lOiBsZWZ0VHJhY2suc3RhcnRUaW1lLCB0cmltU3RhcnQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBtZXJnZWRCdWZmZXIuZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmU6IHRhcmdldExhbmUsIHZvbHVtZTogMS4wLCBpc011dGVkOiBmYWxzZSwgaXNTb2xvOiBmYWxzZSwgY29sb3I6IGxlZnRUcmFjay5jb2xvciwKICAgICAgICAgICAgICAgICAgICAgICAgYnBtOiBsZWZ0VHJhY2suYnBtID09PSByaWdodFRyYWNrLmJwbSA/IGxlZnRUcmFjay5icG0gOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNyb3NzZmFkZU1ldGFkYXRhOiB7IGxlZnQ6IGxlZnRUcmFjaywgcmlnaHQ6IHJpZ2h0VHJhY2ssIGR1cmF0aW9uIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHNldFRyYWNrcyhwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyZWQgPSBwcmV2LmZpbHRlcih0ID0+IHQuaWQgIT09IGxlZnRUcmFjay5pZCAmJiB0LmlkICE9PSByaWdodFRyYWNrLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsuLi5maWx0ZXJlZCwgbmV3VHJhY2tdOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHNldFNlbGVjdGVkVHJhY2tJZChuZXdUcmFjay5pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhbGVydCgiVG8gY3Jvc3NmYWRlLCBwbGFjZSB0d28gY2xpcHMgc2lkZS1ieS1zaWRlIG9uIHRoZSBzYW1lIGxhbmUgYW5kIG1vdmUgdGhlIHBsYXloZWFkIHRvIHRoZWlyIG1lZXRpbmcgcG9pbnQuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRBcHBTdGF0ZShBcHBTdGF0ZS5FRElUSU5HKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAtLS0gMy4gTm9uLURlc3RydWN0aXZlIEVmZmVjdCBQaXBlbGluZSAtLS0KICAgICAgICAgICAgLy8gQnVpbGQgdGhlIG5ldyBhY3RpdmVFZmZlY3RzIHN0YXRlCiAgICAgICAgICAgIGxldCBuZXdFZmZlY3RzID0geyAuLi4odHJhY2suYWN0aXZlRWZmZWN0cyB8fCB7fSkgfTsKICAgICAgICAgICAgaWYgKHBhcmFtcz8ucmVzdG9yZSkgewogICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHNwZWNpZmljIGVmZmVjdAogICAgICAgICAgICAgICAgaWYgKGVmZmVjdElkID09PSAnZmFkZUluJykKICAgICAgICAgICAgICAgICAgICBkZWxldGUgbmV3RWZmZWN0cy5mYWRlSW47CiAgICAgICAgICAgICAgICBpZiAoZWZmZWN0SWQgPT09ICdmYWRlT3V0JykKICAgICAgICAgICAgICAgICAgICBkZWxldGUgbmV3RWZmZWN0cy5mYWRlT3V0OwogICAgICAgICAgICAgICAgaWYgKGVmZmVjdElkID09PSAnZXEnKQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBuZXdFZmZlY3RzLmVxUHJlc2V0OwogICAgICAgICAgICAgICAgaWYgKGVmZmVjdElkID09PSAnbm9ybWFsaXplJykKICAgICAgICAgICAgICAgICAgICBkZWxldGUgbmV3RWZmZWN0cy5ub3JtYWxpemU7CiAgICAgICAgICAgICAgICBpZiAoZWZmZWN0SWQgPT09ICdyZXZlcnNlJykKICAgICAgICAgICAgICAgICAgICBkZWxldGUgbmV3RWZmZWN0cy5yZXZlcnNlOwogICAgICAgICAgICAgICAgaWYgKGVmZmVjdElkID09PSAnc2xvdycgfHwgZWZmZWN0SWQgPT09ICdmYXN0JykKICAgICAgICAgICAgICAgICAgICBkZWxldGUgbmV3RWZmZWN0cy5wbGF5YmFja1JhdGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoZWZmZWN0SWQgIT09ICdhcHBseUFjdGl2ZUZhZGVzJykgewogICAgICAgICAgICAgICAgLy8gQWRkL1VwZGF0ZSBlZmZlY3QKICAgICAgICAgICAgICAgIGlmIChlZmZlY3RJZCA9PT0gJ2ZhZGVJbicpCiAgICAgICAgICAgICAgICAgICAgbmV3RWZmZWN0cy5mYWRlSW4gPSBwYXJhbXM/LmR1cmF0aW9uOwogICAgICAgICAgICAgICAgaWYgKGVmZmVjdElkID09PSAnZmFkZU91dCcpCiAgICAgICAgICAgICAgICAgICAgbmV3RWZmZWN0cy5mYWRlT3V0ID0gcGFyYW1zPy5kdXJhdGlvbjsKICAgICAgICAgICAgICAgIGlmIChlZmZlY3RJZCA9PT0gJ2VxJykKICAgICAgICAgICAgICAgICAgICBuZXdFZmZlY3RzLmVxUHJlc2V0ID0gcGFyYW1zPy5wcmVzZXQ7CiAgICAgICAgICAgICAgICBpZiAoZWZmZWN0SWQgPT09ICdub3JtYWxpemUnKQogICAgICAgICAgICAgICAgICAgIG5ld0VmZmVjdHMubm9ybWFsaXplID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChlZmZlY3RJZCA9PT0gJ3JldmVyc2UnKQogICAgICAgICAgICAgICAgICAgIG5ld0VmZmVjdHMucmV2ZXJzZSA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAoZWZmZWN0SWQgPT09ICdzbG93JyB8fCBlZmZlY3RJZCA9PT0gJ2Zhc3QnKQogICAgICAgICAgICAgICAgICAgIG5ld0VmZmVjdHMucGxheWJhY2tSYXRlID0gcGFyYW1zPy5wbGF5YmFja1JhdGU7CiAgICAgICAgICAgICAgICAvLyBUb2dnbGUgTG9naWMgKGZvciBidXR0b24gY2xpY2tzKQogICAgICAgICAgICAgICAgaWYgKHBhcmFtcz8udG9nZ2xlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVmZmVjdElkID09PSAnbm9ybWFsaXplJykKICAgICAgICAgICAgICAgICAgICAgICAgbmV3RWZmZWN0cy5ub3JtYWxpemUgPSAhdHJhY2suYWN0aXZlRWZmZWN0cz8ubm9ybWFsaXplOwogICAgICAgICAgICAgICAgICAgIGlmIChlZmZlY3RJZCA9PT0gJ3JldmVyc2UnKQogICAgICAgICAgICAgICAgICAgICAgICBuZXdFZmZlY3RzLnJldmVyc2UgPSAhdHJhY2suYWN0aXZlRWZmZWN0cz8ucmV2ZXJzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAtLS0gRXhlY3V0ZSBQaXBlbGluZSAtLS0KICAgICAgICAgICAgLy8gQWx3YXlzIHN0YXJ0IGZyb20gb3JpZ2luYWwgYnVmZmVyIHRvIGVuc3VyZSBub24tZGVzdHJ1Y3RpdmUgYmVoYXZpb3IKICAgICAgICAgICAgbGV0IHBpcGVsaW5lQnVmZmVyID0gdHJhY2sub3JpZ2luYWxCdWZmZXIgfHwgdHJhY2suYnVmZmVyOwogICAgICAgICAgICAvLyAxLiBSZXZlcnNlCiAgICAgICAgICAgIGlmIChuZXdFZmZlY3RzLnJldmVyc2UpIHsKICAgICAgICAgICAgICAgIHBpcGVsaW5lQnVmZmVyID0gcmV2ZXJzZUJ1ZmZlcihwaXBlbGluZUJ1ZmZlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gMi4gU3BlZWQgLyBQaXRjaAogICAgICAgICAgICBpZiAobmV3RWZmZWN0cy5wbGF5YmFja1JhdGUgJiYgbmV3RWZmZWN0cy5wbGF5YmFja1JhdGUgIT09IDEuMCkgewogICAgICAgICAgICAgICAgcGlwZWxpbmVCdWZmZXIgPSBhd2FpdCBjaGFuZ2VTcGVlZChwaXBlbGluZUJ1ZmZlciwgbmV3RWZmZWN0cy5wbGF5YmFja1JhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIDMuIEVRCiAgICAgICAgICAgIGlmIChuZXdFZmZlY3RzLmVxUHJlc2V0KSB7CiAgICAgICAgICAgICAgICBwaXBlbGluZUJ1ZmZlciA9IGF3YWl0IGFwcGx5RVEocGlwZWxpbmVCdWZmZXIsIG5ld0VmZmVjdHMuZXFQcmVzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIDQuIE5vcm1hbGl6ZQogICAgICAgICAgICBpZiAobmV3RWZmZWN0cy5ub3JtYWxpemUpIHsKICAgICAgICAgICAgICAgIHBpcGVsaW5lQnVmZmVyID0gbm9ybWFsaXplQnVmZmVyKHBpcGVsaW5lQnVmZmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyA1LiBGYWRlcyAoQWx3YXlzIGFwcGxpZWQgbGFzdCB0byBidWZmZXIpCiAgICAgICAgICAgIGlmIChuZXdFZmZlY3RzLmZhZGVJbikgewogICAgICAgICAgICAgICAgcGlwZWxpbmVCdWZmZXIgPSBhd2FpdCBhcHBseUZhZGUocGlwZWxpbmVCdWZmZXIsICdpbicsIG5ld0VmZmVjdHMuZmFkZUluKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV3RWZmZWN0cy5mYWRlT3V0KSB7CiAgICAgICAgICAgICAgICBwaXBlbGluZUJ1ZmZlciA9IGF3YWl0IGFwcGx5RmFkZShwaXBlbGluZUJ1ZmZlciwgJ291dCcsIG5ld0VmZmVjdHMuZmFkZU91dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gVXBkYXRlIFRyYWNrCiAgICAgICAgICAgIHVwZGF0ZVRyYWNrKHRyYWNrLmlkLCB7CiAgICAgICAgICAgICAgICBidWZmZXI6IHBpcGVsaW5lQnVmZmVyLAogICAgICAgICAgICAgICAgb3JpZ2luYWxCdWZmZXI6IHRyYWNrLm9yaWdpbmFsQnVmZmVyIHx8IHRyYWNrLmJ1ZmZlciwgLy8gRW5zdXJlIHdlIGtlZXAgdGhlIHRydWUgb3JpZ2luYWwKICAgICAgICAgICAgICAgIGFjdGl2ZUVmZmVjdHM6IG5ld0VmZmVjdHMsCiAgICAgICAgICAgICAgICBkdXJhdGlvbjogcGlwZWxpbmVCdWZmZXIuZHVyYXRpb24gLy8gU3BlZWQgY2hhbmdlcyBhZmZlY3QgZHVyYXRpb24KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNldEFwcFN0YXRlKEFwcFN0YXRlLkVESVRJTkcpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgICAgICBzZXRBcHBTdGF0ZShBcHBTdGF0ZS5FUlJPUik7CiAgICAgICAgfQogICAgfTsKICAgIGNvbnN0IGhhbmRsZUFkZEJlYXQgPSAoZ2VuZXJhdGVkQnVmZmVyLCBuYW1lKSA9PiB7CiAgICAgICAgcHVzaEhpc3RvcnkoKTsKICAgICAgICBjb25zdCBzdGFydExhbmUgPSB0cmFja3MubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLnRyYWNrcy5tYXAodCA9PiB0LmxhbmUpKSArIDEgOiAwOwogICAgICAgIGxldCBwYXJzZWRCcG07CiAgICAgICAgY29uc3QgYnBtTWF0Y2ggPSBuYW1lLm1hdGNoKC9cKChcZCspXHMqQlBNXCkvKTsKICAgICAgICBpZiAoYnBtTWF0Y2ggJiYgYnBtTWF0Y2hbMV0pCiAgICAgICAgICAgIHBhcnNlZEJwbSA9IHBhcnNlSW50KGJwbU1hdGNoWzFdKTsKICAgICAgICBzZXRUcmFja3MocHJldiA9PiBbLi4ucHJldiwgewogICAgICAgICAgICAgICAgaWQ6IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KSwKICAgICAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgICAgICBidWZmZXI6IGdlbmVyYXRlZEJ1ZmZlciwKICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogY3VycmVudFRpbWUsIHRyaW1TdGFydDogMCwKICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBnZW5lcmF0ZWRCdWZmZXIuZHVyYXRpb24sCiAgICAgICAgICAgICAgICBsYW5lOiBzdGFydExhbmUsIHZvbHVtZTogMC44LCBpc011dGVkOiBmYWxzZSwgaXNTb2xvOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNvbG9yOiBUUkFDS19DT0xPUlNbc3RhcnRMYW5lICUgVFJBQ0tfQ09MT1JTLmxlbmd0aF0sCiAgICAgICAgICAgICAgICBicG06IHBhcnNlZEJwbQogICAgICAgICAgICB9XSk7CiAgICAgICAgc2V0SXNUcmltTW9kZShmYWxzZSk7CiAgICB9OwogICAgY29uc3QgaGFuZGxlRXhwb3J0ID0gYXN5bmMgKHRhcmdldFJhdGUsIGZvcm1hdCkgPT4gewogICAgICAgIGlmICh0cmFja3MubGVuZ3RoID09PSAwKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgc2V0QXBwU3RhdGUoQXBwU3RhdGUuUFJPQ0VTU0lORyk7CiAgICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBtaXhlZCA9IGF3YWl0IG1peFRyYWNrcyh0cmFja3MsIG1heER1cmF0aW9uKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZCA9IGF3YWl0IHJlc2FtcGxlQnVmZmVyKG1peGVkLCB0YXJnZXRSYXRlKTsKICAgICAgICAgICAgICAgIGxldCBibG9iOwogICAgICAgICAgICAgICAgbGV0IGV4dGVuc2lvbjsKICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICdtcDMnKSB7CiAgICAgICAgICAgICAgICAgICAgYmxvYiA9IGVuY29kZU1QMyhwcm9jZXNzZWQpOwogICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbiA9ICdtcDMnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYmxvYiA9IGVuY29kZVdBVihwcm9jZXNzZWQpOwogICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbiA9ICd3YXYnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgICBhLmhyZWYgPSB1cmw7CiAgICAgICAgICAgICAgICBhLmRvd25sb2FkID0gYHNvbmljcG9ja2V0X21peF8ke0RhdGUubm93KCl9LiR7ZXh0ZW5zaW9ufWA7CiAgICAgICAgICAgICAgICBhLmNsaWNrKCk7CiAgICAgICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICAgICAgICBhbGVydCgiRXhwb3J0IGZhaWxlZDogIiArIChlIGluc3RhbmNlb2YgRXJyb3IgPyBlLm1lc3NhZ2UgOiBTdHJpbmcoZSkpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHNldEFwcFN0YXRlKEFwcFN0YXRlLkVESVRJTkcpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgMTAwKTsKICAgIH07CiAgICBjb25zdCBoYW5kbGVXaGVlbCA9IHVzZUNhbGxiYWNrKChlKSA9PiB7IGlmIChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHNldFpvb20ocHJldiA9PiBNYXRoLm1pbihNQVhfWk9PTSwgTWF0aC5tYXgoTUlOX1pPT00sIHByZXYgKyAoLWUuZGVsdGFZICogMC41KSkpKTsKICAgIH0gfSwgW10pOwogICAgLy8gLS0tIFJlbmRlciBMaWJyYXJ5IFZpZXcgKFVuY2hhbmdlZCAtIG9taXR0ZWQgZm9yIGJyZXZpdHkpIC0tLQogICAgaWYgKGFwcFN0YXRlID09PSBBcHBTdGF0ZS5MSUJSQVJZKSB7CiAgICAgICAgLy8gLi4uIChTYW1lIGFzIGJlZm9yZSkKICAgICAgICByZXR1cm4gKF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC1jb2wgaC1mdWxsIGJnLXppbmMtOTUwIHRleHQtd2hpdGUgZm9udC1zYW5zIHAtNiBvdmVyZmxvdy1oaWRkZW4iLCBjaGlsZHJlbjogW19qc3hzKCJoZWFkZXIiLCB7IGNsYXNzTmFtZTogImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtYi04IiwgY2hpbGRyZW46IFtfanN4KCJoMSIsIHsgY2xhc3NOYW1lOiAidGV4dC0zeGwgZm9udC1ib2xkIiwgY2hpbGRyZW46ICJQcm9qZWN0IExpYnJhcnkiIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGdhcC0yIiwgY2hpbGRyZW46IFtfanN4KEJ1dHRvbiwgeyB2YXJpYW50OiAicHJpbWFyeSIsIG9uQ2xpY2s6IGhhbmRsZU5ld1Byb2plY3QsIGxhYmVsOiAiTmV3IFByb2plY3QiLCBpY29uOiBfanN4KE5ld0RvY0ljb24sIHt9KSwgY2xhc3NOYW1lOiAidGV4dC1zbSBweC00IHB5LTIiIH0pLCBfanN4KEJ1dHRvbiwgeyB2YXJpYW50OiAic2Vjb25kYXJ5Iiwgb25DbGljazogKCkgPT4gc2V0QXBwU3RhdGUoQXBwU3RhdGUuSURMRSksIGxhYmVsOiAiQ2xvc2UiIH0pXSB9KV0gfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleC0xIG92ZXJmbG93LXktYXV0byBzcGFjZS15LTQiLCBjaGlsZHJlbjogc2F2ZWRQcm9qZWN0cy5sZW5ndGggPT09IDAgPyAoX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXppbmMtNTAwIHRleHQtY2VudGVyIHB5LTIwIiwgY2hpbGRyZW46ICJObyBzYXZlZCBwcm9qZWN0cyB5ZXQuIFN0YXJ0IGNyZWF0aW5nISIgfSkpIDogKHNhdmVkUHJvamVjdHMubWFwKHByb2plY3QgPT4gKF9qc3hzKCJkaXYiLCB7IG9uQ2xpY2s6ICgpID0+IGhhbmRsZU9wZW5Qcm9qZWN0KHByb2plY3QpLCBjbGFzc05hbWU6ICJiZy16aW5jLTkwMCBib3JkZXIgYm9yZGVyLXppbmMtODAwIHJvdW5kZWQtMnhsIHAtNCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCBob3Zlcjpib3JkZXItY3lhbi01MDAvNTAgdHJhbnNpdGlvbiBjdXJzb3ItcG9pbnRlciBncm91cCIsIGNoaWxkcmVuOiBbX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ3LTE2IGgtMTYgYmctemluYy05NTAgcm91bmRlZC1sZyBvdmVyZmxvdy1oaWRkZW4gc2hyaW5rLTAgYm9yZGVyIGJvcmRlci16aW5jLTgwMCIsIGNoaWxkcmVuOiBwcm9qZWN0LnRodW1ibmFpbCA/IF9qc3goImltZyIsIHsgc3JjOiBwcm9qZWN0LnRodW1ibmFpbCwgYWx0OiAiIiwgY2xhc3NOYW1lOiAidy1mdWxsIGgtZnVsbCBvYmplY3QtY292ZXIgb3BhY2l0eS04MCIgfSkgOiBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInctZnVsbCBoLWZ1bGwgYmctemluYy04MDAiIH0pIH0pLCBlZGl0aW5nUHJvamVjdElkID09PSBwcm9qZWN0LmlkID8gKF9qc3hzKCJmb3JtIiwgeyBjbGFzc05hbWU6ICJmbGV4LTEgbWluLXctMCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiIsIG9uQ2xpY2s6IGUgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSwgb25TdWJtaXQ6IGhhbmRsZVNhdmVSZW5hbWUsIGNoaWxkcmVuOiBbX2pzeCgiaW5wdXQiLCB7IHR5cGU6ICJ0ZXh0IiwgdmFsdWU6IGVkaXRpbmdOYW1lLCBvbkNoYW5nZTogKGUpID0+IHNldEVkaXRpbmdOYW1lKGUudGFyZ2V0LnZhbHVlKSwgY2xhc3NOYW1lOiAiYmctemluYy05NTAgYm9yZGVyIGJvcmRlci16aW5jLTcwMCByb3VuZGVkLWxnIHB4LTMgcHktMiB0ZXh0LXdoaXRlIGZvbnQtYm9sZCB3LWZ1bGwgZm9jdXM6b3V0bGluZS1ub25lIGZvY3VzOmJvcmRlci1jeWFuLTUwMCBmb2N1czpyaW5nLTEgZm9jdXM6cmluZy1jeWFuLTUwMCIsIGF1dG9Gb2N1czogdHJ1ZSwgb25DbGljazogZSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpIH0pLCBfanN4KCJidXR0b24iLCB7IHR5cGU6ICJzdWJtaXQiLCBkaXNhYmxlZDogZWRpdGluZ05hbWUudHJpbSgpLmxlbmd0aCA9PT0gMCwgY2xhc3NOYW1lOiBgcC0zIHJvdW5kZWQtZnVsbCBiZy16aW5jLTgwMCB0cmFuc2l0aW9uIGJvcmRlciBib3JkZXItemluYy03MDAgJHtlZGl0aW5nTmFtZS50cmltKCkubGVuZ3RoID4gMCA/ICd0ZXh0LWdyZWVuLTUwMCBob3ZlcjpiZy16aW5jLTcwMCBob3Zlcjpib3JkZXItZ3JlZW4tNTAwLzUwJyA6ICd0ZXh0LXppbmMtNjAwIGN1cnNvci1ub3QtYWxsb3dlZCBvcGFjaXR5LTUwJ31gLCBvbkNsaWNrOiBlID0+IGUuc3RvcFByb3BhZ2F0aW9uKCksIGNoaWxkcmVuOiBfanN4KENoZWNrSWNvbiwge30pIH0pXSB9KSkgOiAoX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleC0xIG1pbi13LTAiLCBjaGlsZHJlbjogW19qc3goImgzIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LWxnIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIHRydW5jYXRlIiwgY2hpbGRyZW46IHByb2plY3QubmFtZSB9KSwgX2pzeCgicCIsIHsgY2xhc3NOYW1lOiAidGV4dC14cyB0ZXh0LXppbmMtNTAwIiwgY2hpbGRyZW46IG5ldyBEYXRlKHByb2plY3QubGFzdE1vZGlmaWVkKS50b0xvY2FsZVN0cmluZygpIH0pXSB9KSksIGVkaXRpbmdQcm9qZWN0SWQgIT09IHByb2plY3QuaWQgJiYgKF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZ2FwLTIiLCBjaGlsZHJlbjogW19qc3goImJ1dHRvbiIsIHsgb25DbGljazogKGUpID0+IGhhbmRsZVN0YXJ0UmVuYW1lKGUsIHByb2plY3QpLCBjbGFzc05hbWU6ICJwLTMgcm91bmRlZC1mdWxsIGhvdmVyOmJnLXppbmMtODAwIHRleHQtemluYy00MDAgaG92ZXI6dGV4dC13aGl0ZSB0cmFuc2l0aW9uIiwgY2hpbGRyZW46IF9qc3goUGVuY2lsSWNvbiwge30pIH0pLCBfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6IChlKSA9PiBoYW5kbGVEZWxldGVQcm9qZWN0KHByb2plY3QuaWQsIGUpLCBjbGFzc05hbWU6ICJwLTMgcm91bmRlZC1mdWxsIGhvdmVyOmJnLXJlZC05MDAvMzAgdGV4dC16aW5jLTQwMCBob3Zlcjp0ZXh0LXJlZC00MDAgdHJhbnNpdGlvbiIsIGNoaWxkcmVuOiBfanN4KFRyYXNoSWNvbiwge30pIH0pXSB9KSldIH0sIHByb2plY3QuaWQpKSkpIH0pLCBwcm9qZWN0VG9EZWxldGUgJiYgKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZml4ZWQgaW5zZXQtMCB6LTUwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHAtNCBiZy1ibGFjay84MCBiYWNrZHJvcC1ibHVyLXNtIGFuaW1hdGUtaW4gZmFkZS1pbiBkdXJhdGlvbi0yMDAiLCBvbkNsaWNrOiAoKSA9PiBzZXRQcm9qZWN0VG9EZWxldGUobnVsbCksIGNoaWxkcmVuOiBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJiZy16aW5jLTkwMCBib3JkZXIgYm9yZGVyLXppbmMtODAwIHJvdW5kZWQtMnhsIHctZnVsbCBtYXgtdy14cyBwLTYgc2hhZG93LTJ4bCBzcGFjZS15LTYgdGV4dC1jZW50ZXIiLCBvbkNsaWNrOiBlID0+IGUuc3RvcFByb3BhZ2F0aW9uKCksIGNoaWxkcmVuOiBbX2pzeHMoImRpdiIsIHsgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInctMTYgaC0xNiByb3VuZGVkLWZ1bGwgYmctcmVkLTkwMC8yMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBteC1hdXRvIG1iLTQgdGV4dC1yZWQtNTAwIiwgY2hpbGRyZW46IF9qc3goVHJhc2hJY29uLCB7IGNsYXNzTmFtZTogInctOCBoLTgiIH0pIH0pLCBfanN4KCJoMiIsIHsgY2xhc3NOYW1lOiAidGV4dC14bCBmb250LWJvbGQgdGV4dC13aGl0ZSIsIGNoaWxkcmVuOiAiQXJlIHlvdSBzdXJlPyIgfSksIF9qc3goInAiLCB7IGNsYXNzTmFtZTogInRleHQtemluYy00MDAgdGV4dC1zbSBtdC0yIiwgY2hpbGRyZW46ICJUaGlzIGFjdGlvbiBjYW5ub3QgYmUgdW5kb25lLiIgfSldIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJncmlkIGdyaWQtY29scy0yIGdhcC0zIiwgY2hpbGRyZW46IFtfanN4KEJ1dHRvbiwgeyB2YXJpYW50OiAic2Vjb25kYXJ5Iiwgb25DbGljazogKCkgPT4gc2V0UHJvamVjdFRvRGVsZXRlKG51bGwpLCBsYWJlbDogIkNhbmNlbCIgfSksIF9qc3goQnV0dG9uLCB7IHZhcmlhbnQ6ICJkYW5nZXIiLCBvbkNsaWNrOiBjb25maXJtRGVsZXRlUHJvamVjdCwgbGFiZWw6ICJEZWxldGUiIH0pXSB9KV0gfSkgfSkpXSB9KSk7CiAgICB9CiAgICByZXR1cm4gKF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC1jb2wgbGFuZHNjYXBlOmZsZXgtcm93IGxhbmRzY2FwZTpsZzpmbGV4LWNvbCBoLWZ1bGwgYmctemluYy05NTAgdGV4dC13aGl0ZSBmb250LXNhbnMgc2VsZWN0aW9uOmJnLWN5YW4tNTAwLzMwIG92ZXJmbG93LWhpZGRlbiByZWxhdGl2ZSIsIGNoaWxkcmVuOiBbYXBwU3RhdGUgPT09IEFwcFN0YXRlLkxPQURJTkcgJiYgKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgaW5zZXQtMCB6LVsxMDBdIGJnLXppbmMtOTUwLzkwIGJhY2tkcm9wLWJsdXItbWQgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgc3BhY2UteS02IHAtOCB0ZXh0LWNlbnRlciIsIGNoaWxkcmVuOiBsb2FkRXJyb3IgPyAoX2pzeHMoX0ZyYWdtZW50LCB7IGNoaWxkcmVuOiBbX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ3LTE2IGgtMTYgcm91bmRlZC1mdWxsIGJnLXJlZC05MDAvMzAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1yZWQtNTAwIG1iLTIiLCBjaGlsZHJlbjogX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC0zeGwiLCBjaGlsZHJlbjogIlx1MjZBMFx1RkUwRiIgfSkgfSksIF9qc3goImgyIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIiwgY2hpbGRyZW46ICJGYWlsZWQgdG8gT3BlbiBQcm9qZWN0IiB9KSwgX2pzeCgicCIsIHsgY2xhc3NOYW1lOiAidGV4dC16aW5jLTQwMCBtYXgtdy1zbSIsIGNoaWxkcmVuOiBsb2FkRXJyb3IgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZ2FwLTQgbXQtNCIsIGNoaWxkcmVuOiBbX2pzeChCdXR0b24sIHsgdmFyaWFudDogInNlY29uZGFyeSIsIG9uQ2xpY2s6ICgpID0+IHNldEFwcFN0YXRlKEFwcFN0YXRlLkxJQlJBUlkpLCBsYWJlbDogIkJhY2sgdG8gTGlicmFyeSIgfSksIF9qc3goQnV0dG9uLCB7IHZhcmlhbnQ6ICJkYW5nZXIiLCBvbkNsaWNrOiAoKSA9PiB7IHNldFRyYWNrcyhbXSk7IHNldEFwcFN0YXRlKEFwcFN0YXRlLkVESVRJTkcpOyBzZXRUaW1lb3V0KCgpID0+IHsgaWdub3JlQ2hhbmdlc1JlZi5jdXJyZW50ID0gZmFsc2U7IH0sIDEwMCk7IH0sIGxhYmVsOiAiT3BlbiBhcyBCbGFuayIgfSldIH0pXSB9KSkgOiAoX2pzeHMoX0ZyYWdtZW50LCB7IGNoaWxkcmVuOiBbIiAiLCBfanN4KExvYWRpbmdTcGlubmVyLCB7fSksICIgIiwgX2pzeCgicCIsIHsgY2xhc3NOYW1lOiAidGV4dC16aW5jLTQwMCBhbmltYXRlLXB1bHNlIGZvbnQtbWVkaXVtIiwgY2hpbGRyZW46ICJMb2FkaW5nIFByb2plY3QuLi4iIH0pLCAiICJdIH0pKSB9KSksIF9qc3hzKCJoZWFkZXIiLCB7IGNsYXNzTmFtZTogIlxuICAgICAgICBmbGV4IGZsZXgtY29sIFxuICAgICAgICB3LWZ1bGwgbGFuZHNjYXBlOnctMTYgbGFuZHNjYXBlOmxnOnctZnVsbCBcbiAgICAgICAgaC1hdXRvIGxhbmRzY2FwZTpoLWZ1bGwgbGFuZHNjYXBlOmxnOmgtYXV0byBcbiAgICAgICAgYm9yZGVyLWIgbGFuZHNjYXBlOmJvcmRlci1iLTAgbGFuZHNjYXBlOmJvcmRlci1yIGxhbmRzY2FwZTpsZzpib3JkZXItYiBsYW5kc2NhcGU6bGc6Ym9yZGVyLXItMCBib3JkZXItemluYy05MDAgXG4gICAgICAgIGJnLXppbmMtOTUwIHNocmluay0wIHotMjAgXG4gICAgICAgIGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgcHktMiBsYW5kc2NhcGU6cHktNCBsYW5kc2NhcGU6bGc6cHktMlxuICAgICAgIiwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyB3LWZ1bGwgcHgtNCBsYW5kc2NhcGU6ZmxleC1jb2wgbGFuZHNjYXBlOmdhcC00IGxhbmRzY2FwZTpweC0wIGxhbmRzY2FwZTpsZzpmbGV4LXJvdyBsYW5kc2NhcGU6bGc6cHgtNCBsYW5kc2NhcGU6bGc6dy1mdWxsIGxhbmRzY2FwZTpsZzpqdXN0aWZ5LXN0YXJ0IiwgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInctMTAgaC0xMCByb3VuZGVkLXhsIGJnLWdyYWRpZW50LXRvLWJyIGZyb20tY3lhbi00MDAgdG8taW5kaWdvLTYwMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWJsYWNrIHNoYWRvdy1sZyBzaGFkb3ctY3lhbi05MDAvMjAgc2hyaW5rLTAgbGFuZHNjYXBlOmhpZGRlbiBsYW5kc2NhcGU6bGc6ZmxleCIsIGNoaWxkcmVuOiBfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNiBoLTYgdGV4dC13aGl0ZSIsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBfanN4KCJwYXRoIiwgeyBzdHJva2VMaW5lY2FwOiAicm91bmQiLCBzdHJva2VMaW5lam9pbjogInJvdW5kIiwgZDogIk05IDE5VjZsMTItM3YxM005IDE5YzAgMS4xMDUtMS4zNDMgMi0zIDJzLTMtLjg5NS0zLTIgMS4zNDMtMiAzLTIgMyAuODk1IDMgMnptMTItM2MwIDEuMTA1LTEuMzQzIDItMyAycy0zLS44OTUtMy0yIDEuMzQzLTIgMy0yIDMgLjg5NSAzIDJ6TTkgMTBsMTItMyIgfSkgfSkgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImhpZGRlbiBsYW5kc2NhcGU6ZmxleCBsYW5kc2NhcGU6bGc6aGlkZGVuIGZsZXgtY29sIGl0ZW1zLWNlbnRlciIsIGNoaWxkcmVuOiBbX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBoYW5kbGVTYXZlQW5kQ2xvc2UsIGNsYXNzTmFtZTogInctMTAgaC0xMCByb3VuZGVkLWxnIG92ZXJmbG93LWhpZGRlbiBib3JkZXIgYm9yZGVyLXppbmMtNzAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGJnLXppbmMtOTAwIiwgY2hpbGRyZW46IHJlY2VudFByb2plY3RQcmV2aWV3ID8gX2pzeCgiaW1nIiwgeyBzcmM6IHJlY2VudFByb2plY3RQcmV2aWV3LCBjbGFzc05hbWU6ICJ3LWZ1bGwgaC1mdWxsIG9iamVjdC1jb3ZlciBvcGFjaXR5LTgwIiB9KSA6IF9qc3goTGlicmFyeUljb24sIHt9KSB9KSwgX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC1bOHB4XSB0ZXh0LXppbmMtNTAwIG10LTEgZm9udC1ib2xkIiwgY2hpbGRyZW46ICJMSUIiIH0pXSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAibGFuZHNjYXBlOmhpZGRlbiBsYW5kc2NhcGU6bGc6YmxvY2sgZmxleC0xIG1pbi13LTAiLCBjaGlsZHJlbjogW19qc3goImgxIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LWxnIGZvbnQtYm9sZCB0cmFja2luZy10aWdodCB0ZXh0LXdoaXRlIGxlYWRpbmctdGlnaHQgdHJ1bmNhdGUiLCBjaGlsZHJlbjogIlNvbmljUG9ja2V0IiB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiLCBjaGlsZHJlbjogW19qc3goInAiLCB7IGNsYXNzTmFtZTogInRleHQtWzEwcHhdIHRleHQtemluYy01MDAgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVzdCBmb250LXNlbWlib2xkIHRydW5jYXRlIG1heC13LVsxNTBweF0iLCBjaGlsZHJlbjogY3VycmVudFByb2plY3ROYW1lIHx8ICJOZXcgUHJvamVjdCIgfSksIGN1cnJlbnRQcm9qZWN0SWQgJiYgX2pzeChTYXZlU3RhdHVzSWNvbiwgeyBzdGF0dXM6IHNhdmVTdGF0dXMgfSldIH0pXSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBnYXAtMiBpdGVtcy1jZW50ZXIgbWwtYXV0byBsYW5kc2NhcGU6aGlkZGVuIGxhbmRzY2FwZTpsZzpmbGV4IiwgY2hpbGRyZW46IFtfanN4KEJ1dHRvbiwgeyB2YXJpYW50OiAiZ2hvc3QiLCBvbkNsaWNrOiBoYW5kbGVVbmRvLCBkaXNhYmxlZDogaGlzdG9yeS5sZW5ndGggPT09IDAsIGljb246IF9qc3goVW5kb0ljb24sIHt9KSB9KSwgX2pzeChCdXR0b24sIHsgdmFyaWFudDogImdob3N0Iiwgb25DbGljazogKCkgPT4gc2V0RXhwb3J0TW9kYWxPcGVuKHRydWUpLCBkaXNhYmxlZDogdHJhY2tzLmxlbmd0aCA9PT0gMCwgY2xhc3NOYW1lOiAidGV4dC1jeWFuLTQwMCBob3ZlcjpiZy1jeWFuLTk1MC8zMCIsIGljb246IF9qc3goU2hhcmVFeHBvcnRJY29uLCB7fSkgfSksIF9qc3goQnV0dG9uLCB7IHZhcmlhbnQ6ICJnaG9zdCIsIG9uQ2xpY2s6IGhhbmRsZVNhdmVBbmRDbG9zZSwgY2xhc3NOYW1lOiAidGV4dC1zbSBmb250LXNlbWlib2xkIHRleHQtemluYy0zMDAgaG92ZXI6dGV4dC13aGl0ZSIsIGxhYmVsOiAiRG9uZSIgfSldIH0pXSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiXG4gICAgICAgICAgICBoaWRkZW4gbGFuZHNjYXBlOmZsZXggbGFuZHNjYXBlOmxnOmhpZGRlbiBcbiAgICAgICAgICAgIGZsZXgtY29sIGl0ZW1zLWNlbnRlciBnYXAtMiBmbGV4LTEganVzdGlmeS1jZW50ZXIgcHktMlxuICAgICAgICAiLCBjaGlsZHJlbjogW19qc3goImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gc2V0Wm9vbSh6ID0+IE1hdGgubWluKE1BWF9aT09NLCB6ICsgMTApKSwgY2xhc3NOYW1lOiAicC0xIGhvdmVyOnRleHQtd2hpdGUgdGV4dC16aW5jLTUwMCBzaHJpbmstMCIsIGNoaWxkcmVuOiBfanN4KFpvb21Jbkljb24sIHt9KSB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJyZWxhdGl2ZSB3LTYgaC0yNCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBncm91cCIsIGNoaWxkcmVuOiBfanN4KCJpbnB1dCIsIHsgdHlwZTogInJhbmdlIiwgbWluOiBNSU5fWk9PTSwgbWF4OiBNQVhfWk9PTSwgdmFsdWU6IHpvb20sIG9uQ2hhbmdlOiAoZSkgPT4gc2V0Wm9vbShOdW1iZXIoZS50YXJnZXQudmFsdWUpKSwgY2xhc3NOYW1lOiAiYWJzb2x1dGUgdy0yNCBoLTYgYmctdHJhbnNwYXJlbnQgYXBwZWFyYW5jZS1ub25lIGN1cnNvci1wb2ludGVyIFsmOjotd2Via2l0LXNsaWRlci10aHVtYl06YXBwZWFyYW5jZS1ub25lIFsmOjotd2Via2l0LXNsaWRlci10aHVtYl06dy00IFsmOjotd2Via2l0LXNsaWRlci10aHVtYl06aC00IFsmOjotd2Via2l0LXNsaWRlci10aHVtYl06cm91bmRlZC1mdWxsIFsmOjotd2Via2l0LXNsaWRlci10aHVtYl06YmctY3lhbi01MDAgWyY6Oi13ZWJraXQtc2xpZGVyLXRodW1iXTpzaGFkb3ctWzBfMF8xMHB4X3JnYmEoMzQsMjExLDIzOCwwLjUpXSBiZy16aW5jLTgwMCByb3VuZGVkLWZ1bGwiLCBzdHlsZTogeyB0cmFuc2Zvcm06ICdyb3RhdGUoLTkwZGVnKScsIHRyYW5zZm9ybU9yaWdpbjogJ2NlbnRlcicgfSB9KSB9KSwgX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiAoKSA9PiBzZXRab29tKHogPT4gTWF0aC5tYXgoTUlOX1pPT00sIHogLSAxMCkpLCBjbGFzc05hbWU6ICJwLTEgaG92ZXI6dGV4dC13aGl0ZSB0ZXh0LXppbmMtNTAwIHNocmluay0wIiwgY2hpbGRyZW46IF9qc3goWm9vbU91dEljb24sIHt9KSB9KV0gfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImhpZGRlbiBsYW5kc2NhcGU6ZmxleCBsYW5kc2NhcGU6bGc6aGlkZGVuIGZsZXgtY29sIGdhcC0yIGl0ZW1zLWNlbnRlciBwYi00IiwgY2hpbGRyZW46IFtfanN4KEJ1dHRvbiwgeyB2YXJpYW50OiAiZ2hvc3QiLCBvbkNsaWNrOiBoYW5kbGVVbmRvLCBkaXNhYmxlZDogaGlzdG9yeS5sZW5ndGggPT09IDAsIGljb246IF9qc3goVW5kb0ljb24sIHt9KSwgY2xhc3NOYW1lOiAicC0yIiB9KSwgX2pzeChCdXR0b24sIHsgdmFyaWFudDogImdob3N0Iiwgb25DbGljazogKCkgPT4gc2V0RXhwb3J0TW9kYWxPcGVuKHRydWUpLCBkaXNhYmxlZDogdHJhY2tzLmxlbmd0aCA9PT0gMCwgY2xhc3NOYW1lOiAidGV4dC1jeWFuLTQwMCBob3ZlcjpiZy1jeWFuLTk1MC8zMCBwLTIiLCBpY29uOiBfanN4KFNoYXJlRXhwb3J0SWNvbiwge30pIH0pLCBfanN4KEJ1dHRvbiwgeyB2YXJpYW50OiAiZ2hvc3QiLCBvbkNsaWNrOiBoYW5kbGVTYXZlQW5kQ2xvc2UsIGNsYXNzTmFtZTogInRleHQtWzEwcHhdIGZvbnQtYm9sZCB0ZXh0LXppbmMtMzAwIGhvdmVyOnRleHQtd2hpdGUgd3JpdGluZy12ZXJ0aWNhbC1sciBweS0yIiwgbGFiZWw6ICJET05FIiB9KV0gfSldIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJcbiAgICAgICAgbGFuZHNjYXBlOmhpZGRlbiBsYW5kc2NhcGU6bGc6ZmxleCBcbiAgICAgICAgaC0xMiBmbGV4IGl0ZW1zLWNlbnRlciBweC00IGp1c3RpZnktYmV0d2VlbiBib3JkZXItYiBib3JkZXItemluYy05MDAgYmctemluYy05NTAvNTAgYmFja2Ryb3AtYmx1ci1zbSBzaHJpbmstMCBnYXAtNFxuICAgICAgIiwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCB0ZXh0LVsxMHB4XSB1cHBlcmNhc2UgZm9udC1ib2xkIHRleHQtemluYy01MDAgc2hyaW5rLTAiLCBjaGlsZHJlbjogW19qc3hzKCJzcGFuIiwgeyBjaGlsZHJlbjogWyJUcmFja3M6ICIsIHRyYWNrcy5sZW5ndGhdIH0pLCBfanN4cygic3BhbiIsIHsgY2xhc3NOYW1lOiAidGFidWxhci1udW1zIiwgY2hpbGRyZW46IFtfanN4cygic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC1jeWFuLTUwMCIsIGNoaWxkcmVuOiBbY3VycmVudFRpbWUudG9GaXhlZCgyKSwgInMiXSB9KSwgX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC16aW5jLTYwMCBteC0xIiwgY2hpbGRyZW46ICJvZiIgfSksIF9qc3goInNwYW4iLCB7IGNoaWxkcmVuOiBtYXhEdXJhdGlvbiA8IDYwID8gYCR7bWF4RHVyYXRpb24udG9GaXhlZCgyKX1zYCA6IGAke01hdGguZmxvb3IobWF4RHVyYXRpb24gLyA2MCl9bSAke01hdGguZmxvb3IobWF4RHVyYXRpb24gJSA2MCl9c2AgfSldIH0pXSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgdy0zMiBtZDp3LTY0IG1kOmZsZXgtMSBtZDptYXgtdy14cyBqdXN0aWZ5LWVuZCIsIGNoaWxkcmVuOiBbX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiAoKSA9PiBzZXRab29tKHogPT4gTWF0aC5tYXgoTUlOX1pPT00sIHogLSAxMCkpLCBjbGFzc05hbWU6ICJwLTIgaG92ZXI6dGV4dC13aGl0ZSB0ZXh0LXppbmMtNTAwIHNocmluay0wIiwgY2hpbGRyZW46IF9qc3goWm9vbU91dEljb24sIHt9KSB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJyZWxhdGl2ZSB3LWZ1bGwgaC02IGZsZXggaXRlbXMtY2VudGVyIGdyb3VwIiwgY2hpbGRyZW46IF9qc3goImlucHV0IiwgeyB0eXBlOiAicmFuZ2UiLCBtaW46IE1JTl9aT09NLCBtYXg6IE1BWF9aT09NLCB2YWx1ZTogem9vbSwgb25DaGFuZ2U6IChlKSA9PiBzZXRab29tKE51bWJlcihlLnRhcmdldC52YWx1ZSkpLCBjbGFzc05hbWU6ICJ3LWZ1bGwgaC0xIGJnLXppbmMtODAwIHJvdW5kZWQtZnVsbCBhcHBlYXJhbmNlLW5vbmUgY3Vyc29yLXBvaW50ZXIgWyY6Oi13ZWJraXQtc2xpZGVyLXRodW1iXTphcHBlYXJhbmNlLW5vbmUgWyY6Oi13ZWJraXQtc2xpZGVyLXRodW1iXTp3LTQgWyY6Oi13ZWJraXQtc2xpZGVyLXRodW1iXTpoLTQgWyY6Oi13ZWJraXQtc2xpZGVyLXRodW1iXTpyb3VuZGVkLWZ1bGwgWyY6Oi13ZWJraXQtc2xpZGVyLXRodW1iXTpiZy1jeWFuLTUwMCBbJjo6LXdlYmtpdC1zbGlkZXItdGh1bWJdOnNoYWRvdy1bMF8wXzEwcHhfcmdiYSgzNCwyMTEsMjM4LDAuNSldIFsmOjotd2Via2l0LXNsaWRlci10aHVtYl06dHJhbnNpdGlvbi10cmFuc2Zvcm0gWyY6Oi13ZWJraXQtc2xpZGVyLXRodW1iXTpob3ZlcjpzY2FsZS0xMjUiIH0pIH0pLCBfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6ICgpID0+IHNldFpvb20oeiA9PiBNYXRoLm1pbihNQVhfWk9PTSwgeiArIDEwKSksIGNsYXNzTmFtZTogInAtMiBob3Zlcjp0ZXh0LXdoaXRlIHRleHQtemluYy01MDAgc2hyaW5rLTAiLCBjaGlsZHJlbjogX2pzeChab29tSW5JY29uLCB7fSkgfSldIH0pXSB9KSwgX2pzeHMoIm1haW4iLCB7IGNsYXNzTmFtZTogImZsZXgtMSByZWxhdGl2ZSBvdmVyZmxvdy15LWF1dG8gb3ZlcmZsb3cteC1oaWRkZW4gYmctemluYy05NTAgdG91Y2gtbm9uZSIsIG9uV2hlZWw6IGhhbmRsZVdoZWVsLCBvblBvaW50ZXJNb3ZlOiAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVRyaW1Qb2ludGVyTW92ZShlKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVUcmFja0RyYWdNb3ZlKGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZFRyYWNrKQogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVGYWRlSGFuZGxlRHJhZyhlLCBzZWxlY3RlZFRyYWNrKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNTY3J1YmJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVBsYXloZWFkUG9pbnRlck1vdmUoZSk7CiAgICAgICAgICAgICAgICB9LCBvblBvaW50ZXJVcDogKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodHJpbVN0YXRlKQogICAgICAgICAgICAgICAgICAgICAgICBzZXRUcmltU3RhdGUobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRyYWdnaW5nVHJhY2tJZCkKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlVHJhY2tQb2ludGVyVXAoZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGludGVyYWN0aXZlTW9kZSAmJiBzZWxlY3RlZFRyYWNrKQogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVGYWRlSGFuZGxlUG9pbnRlclVwKGUsIHNlbGVjdGVkVHJhY2spOwogICAgICAgICAgICAgICAgICAgIGlmIChpc1NjcnViYmluZykKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlUGxheWhlYWRQb2ludGVyVXAoZSk7CiAgICAgICAgICAgICAgICB9LCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImgtNiB3LWZ1bGwgc3RpY2t5IHRvcC0wIGJnLXppbmMtOTUwIHotMjAgYm9yZGVyLWIgYm9yZGVyLXppbmMtOTAwIHBvaW50ZXItZXZlbnRzLW5vbmUgZmxleCBpdGVtcy1jZW50ZXIgcGItMSB0ZXh0LVsxMHB4XSB0ZXh0LXppbmMtNjAwIHBsLTIgZ2FwLTQiLCBjaGlsZHJlbjogW19qc3goInNwYW4iLCB7IGNoaWxkcmVuOiAiVGltZWxpbmUiIH0pLCBfanN4cygic3BhbiIsIHsgY2xhc3NOYW1lOiAiaGlkZGVuIGxhbmRzY2FwZTppbmxpbmUgbGFuZHNjYXBlOmxnOmhpZGRlbiB0ZXh0LXppbmMtNTAwIGZvbnQtYm9sZCIsIGNoaWxkcmVuOiBbIlRyYWNrczogIiwgdHJhY2tzLmxlbmd0aF0gfSksIF9qc3hzKCJzcGFuIiwgeyBjbGFzc05hbWU6ICJoaWRkZW4gbGFuZHNjYXBlOmlubGluZSBsYW5kc2NhcGU6bGc6aGlkZGVuIHRleHQtY3lhbi01MDAgZm9udC1tb25vIHRhYnVsYXItbnVtcyIsIGNoaWxkcmVuOiBbY3VycmVudFRpbWUudG9GaXhlZCgyKSwgInMgIiwgX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC16aW5jLTYwMCBteC0xIiwgY2hpbGRyZW46ICIvIiB9KSwgIiAiLCBtYXhEdXJhdGlvbiA8IDYwID8gYCR7bWF4RHVyYXRpb24udG9GaXhlZCgyKX1zYCA6IGAke01hdGguZmxvb3IobWF4RHVyYXRpb24gLyA2MCl9bSAke01hdGguZmxvb3IobWF4RHVyYXRpb24gJSA2MCl9c2BdIH0pXSB9KSwgdHJhY2tzLmxlbmd0aCA9PT0gMCA/IChfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSBpbnNldC0wIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtemluYy01MDAgZ2FwLTQiLCBjaGlsZHJlbjogW19qc3goInAiLCB7IGNoaWxkcmVuOiAiTm8gdHJhY2tzIGFkZGVkLiIgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZ2FwLTQiLCBjaGlsZHJlbjogW19qc3goQnV0dG9uLCB7IGxhYmVsOiAiQWRkIEF1ZGlvIiwgb25DbGljazogKCkgPT4gZmlsZUlucHV0UmVmLmN1cnJlbnQ/LmNsaWNrKCkgfSksIF9qc3goQnV0dG9uLCB7IGxhYmVsOiAiTGlicmFyeSIsIHZhcmlhbnQ6ICJzZWNvbmRhcnkiLCBpY29uOiBfanN4KExpYnJhcnlJY29uLCB7fSksIG9uQ2xpY2s6IGhhbmRsZVNhdmVBbmRDbG9zZSB9KV0gfSldIH0pKSA6IChfanN4KCJkaXYiLCB7IHJlZjogdGltZWxpbmVSZWYsIGNsYXNzTmFtZTogInJlbGF0aXZlIG92ZXJmbG93LXgtYXV0byBvdmVyZmxvdy15LWF1dG8gaC1mdWxsIiwgb25TY3JvbGw6IGhhbmRsZVRpbWVsaW5lU2Nyb2xsLCBjaGlsZHJlbjogX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAicmVsYXRpdmUgcGItMjQiLCBzdHlsZTogeyB3aWR0aDogYCR7TWF0aC5tYXgod2luZG93LmlubmVyV2lkdGgsIG1heER1cmF0aW9uICogem9vbSArIDUwMCl9cHhgLCBoZWlnaHQ6IGAke01hdGgubWF4KHdpbmRvdy5pbm5lckhlaWdodCAtIDIwMCwgdG90YWxMYW5lcyAqIExBTkVfSEVJR0hUICsgMTAwKX1weGAgfSwgb25Qb2ludGVyRG93bjogaGFuZGxlVGltZWxpbmVQb2ludGVyRG93biwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSBpbnNldC0wIHBvaW50ZXItZXZlbnRzLW5vbmUiLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgaW5zZXQtMCBvcGFjaXR5LTEwIiwgc3R5bGU6IHsgYmFja2dyb3VuZEltYWdlOiBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjM2YzZjQ2IDFweCwgdHJhbnNwYXJlbnQgMXB4KWAsIGJhY2tncm91bmRTaXplOiBgJHt6b29tfXB4IDEwMCVgIH0gfSksIEFycmF5LmZyb20oeyBsZW5ndGg6IHRvdGFsTGFuZXMgfSkubWFwKChfLCBpKSA9PiAoX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ3LWZ1bGwgYm9yZGVyLWIgYm9yZGVyLXppbmMtOTAwLzUwIiwgc3R5bGU6IHsgaGVpZ2h0OiBgJHtMQU5FX0hFSUdIVH1weGAsIGJhY2tncm91bmRDb2xvcjogaSAlIDIgPT09IDAgPyAncmdiYSgyNCwgMjQsIDI3LCAwLjIpJyA6ICd0cmFuc3BhcmVudCcgfSwgY2hpbGRyZW46IF9qc3hzKCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LVs5cHhdIHRleHQtemluYy03MDAgcC0yIGZvbnQtbW9ubyIsIGNoaWxkcmVuOiBbIkwiLCBpICsgMV0gfSkgfSwgaSkpKV0gfSksIF9qc3hzKCJkaXYiLCB7IHJlZjogcGxheWhlYWRSZWYsIGNsYXNzTmFtZTogYGFic29sdXRlIHRvcC0wIGJvdHRvbS0wIHctNiAtbWwtMyB6LTUwIGZsZXgganVzdGlmeS1jZW50ZXIgZ3JvdXAgJHtpc1NjcnViYmluZyA/ICdjdXJzb3ItZ3JhYmJpbmcnIDogJ2N1cnNvci1ncmFiJ31gLCBzdHlsZTogeyB0cmFuc2Zvcm06IGB0cmFuc2xhdGVYKCR7Y3VycmVudFRpbWUgKiB6b29tfXB4KWAsIGhlaWdodDogJzEwMCUnIH0sIG9uUG9pbnRlckRvd246IGhhbmRsZVBsYXloZWFkUG9pbnRlckRvd24sIG9uUG9pbnRlck1vdmU6IGhhbmRsZVBsYXloZWFkUG9pbnRlck1vdmUsIG9uUG9pbnRlclVwOiBoYW5kbGVQbGF5aGVhZFBvaW50ZXJVcCwgb25Qb2ludGVyQ2FuY2VsOiBoYW5kbGVQbGF5aGVhZFBvaW50ZXJVcCwgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIHRvcC0wIGJvdHRvbS0wIHctMC41IGJnLXJlZC01MDAgc2hhZG93LVswXzBfMTBweF9yZ2JhKDIzOSw2OCw2OCwwLjUpXSIgfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAic3RpY2t5IHRvcC0wIHctNCBoLTQgYmctcmVkLTUwMCByb3VuZGVkLWZ1bGwgc2hhZG93LW1kIHotNTAgdHJhbnNpdGlvbi10cmFuc2Zvcm0gZ3JvdXAtaG92ZXI6c2NhbGUtMTI1IiB9KV0gfSksIHRyYWNrcy5tYXAoKHRyYWNrKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBlZmZlY3RpdmVTZWxlY3RlZFRyYWNrSWQgPT09IHRyYWNrLmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0RyYWdnaW5nVGhpcyA9IGRyYWdnaW5nVHJhY2tJZCA9PT0gdHJhY2suaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzVHJpbUFjdGl2ZSA9IGlzU2VsZWN0ZWQgJiYgaXNUcmltTW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNJbnRlcmFjdGl2ZSA9IGludGVyYWN0aXZlTW9kZT8udHJhY2tJZCA9PT0gdHJhY2suaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2aXN1YWxTdGFydFRpbWUgPSB0cmFjay5zdGFydFRpbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2aXN1YWxEdXJhdGlvbiA9IHRyYWNrLmR1cmF0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmlzdWFsVHJpbVN0YXJ0ID0gdHJhY2sudHJpbVN0YXJ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNUcmltQWN0aXZlICYmIHRyaW1TdGF0ZT8uaXNEcmFnZ2luZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyaW1TdGF0ZS5zaWRlID09PSAnc3RhcnQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoYW5nZSA9IHRyaW1TdGF0ZS5jdXJyZW50RGVsdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZpc3VhbFRyaW1TdGFydCArIGNoYW5nZSA8IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZSA9IC12aXN1YWxUcmltU3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZpc3VhbER1cmF0aW9uIC0gY2hhbmdlIDwgMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2UgPSB2aXN1YWxEdXJhdGlvbiAtIDAuMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXN1YWxTdGFydFRpbWUgKz0gY2hhbmdlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc3VhbER1cmF0aW9uIC09IGNoYW5nZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXN1YWxUcmltU3RhcnQgKz0gY2hhbmdlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoYW5nZSA9IHRyaW1TdGF0ZS5jdXJyZW50RGVsdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZpc3VhbER1cmF0aW9uICsgY2hhbmdlIDwgMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2UgPSAwLjEgLSB2aXN1YWxEdXJhdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlzdWFsVHJpbVN0YXJ0ICsgdmlzdWFsRHVyYXRpb24gKyBjaGFuZ2UgPiB0cmFjay5idWZmZXIuZHVyYXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZSA9IHRyYWNrLmJ1ZmZlci5kdXJhdGlvbiAtICh2aXN1YWxUcmltU3RhcnQgKyB2aXN1YWxEdXJhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzdWFsRHVyYXRpb24gKz0gY2hhbmdlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lckxlZnQgPSBNYXRoLnJvdW5kKHZpc3VhbFN0YXJ0VGltZSAqIHpvb20pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXJXaWR0aCA9IE1hdGgucm91bmQodmlzdWFsRHVyYXRpb24gKiB6b29tKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFuZGxlV2lkdGggPSAzMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFuZGxlRHVyYXRpb24gPSBoYW5kbGVXaWR0aCAvIHpvb207CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzTGVmdERyYWdnaW5nID0gaXNUcmltQWN0aXZlICYmIHRyaW1TdGF0ZT8uaXNEcmFnZ2luZyAmJiB0cmltU3RhdGU/LnNpZGUgPT09ICdzdGFydCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzUmlnaHREcmFnZ2luZyA9IGlzVHJpbUFjdGl2ZSAmJiB0cmltU3RhdGU/LmlzRHJhZ2dpbmcgJiYgdHJpbVN0YXRlPy5zaWRlID09PSAnZW5kJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFkZUluRHVyYXRpb24gPSB0cmFjay5hY3RpdmVFZmZlY3RzPy5mYWRlSW4gfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFkZU91dER1cmF0aW9uID0gdHJhY2suYWN0aXZlRWZmZWN0cz8uZmFkZU91dCB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogYGFic29sdXRlIGgtMjQgcm91bmRlZC1sZyBib3JkZXIgdG91Y2gtbm9uZSBzZWxlY3Qtbm9uZSB0cmFjay1jbGlwIGdyb3VwICR7aXNEcmFnZ2luZ1RoaXMgPyAnei01MCBzaGFkb3ctMnhsIHJpbmctMiByaW5nLWN5YW4tNDAwIGN1cnNvci1ncmFiYmluZyBiZy16aW5jLTgwMCcgOiAnJ30gJHtpc1NlbGVjdGVkICYmICFpc0RyYWdnaW5nVGhpcyA/ICdiZy16aW5jLTgwMC85MCBib3JkZXItY3lhbi01MDAvNTAgcmluZy0xIHJpbmctY3lhbi01MDAvMjAgei00MCcgOiAnJ30gJHshaXNTZWxlY3RlZCAmJiAhaXNEcmFnZ2luZ1RoaXMgPyAnYmctemluYy05MDAvNjAgYm9yZGVyLXppbmMtODAwIGhvdmVyOmJnLXppbmMtODAwLzgwIHotMzAnIDogJyd9YCwgc3R5bGU6IHsgbGVmdDogYCR7Y29udGFpbmVyTGVmdH1weGAsIHRvcDogYCR7dHJhY2subGFuZSAqIExBTkVfSEVJR0hUICsgMTB9cHhgLCB3aWR0aDogYCR7Y29udGFpbmVyV2lkdGh9cHhgLCBoZWlnaHQ6IGAke0xBTkVfSEVJR0hUIC0gMjB9cHhgLCB3aWxsQ2hhbmdlOiAnbGVmdCwgd2lkdGgnLCB0cmFuc2l0aW9uOiBpc0RyYWdnaW5nVGhpcyB8fCAoaXNUcmltQWN0aXZlICYmIHRyaW1TdGF0ZT8uaXNEcmFnZ2luZykgPyAnbm9uZScgOiAnbGVmdCAwLjFzIGVhc2Utb3V0LCB3aWR0aCAwLjFzIGVhc2Utb3V0LCB0b3AgMC4ycyBlYXNlLW91dCwgdHJhbnNmb3JtIDAuMXMgZWFzZS1vdXQnIH0sIG9uUG9pbnRlckRvd246IChlKSA9PiBoYW5kbGVUcmFja1BvaW50ZXJEb3duKGUsIHRyYWNrKSwgb25Qb2ludGVyVXA6IGhhbmRsZVRyYWNrUG9pbnRlclVwLCBjaGlsZHJlbjogWyFpc1RyaW1BY3RpdmUgJiYgIWlzRHJhZ2dpbmdUaGlzICYmIChfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSByaWdodC0xIHRvcC0xIHotMjAgZmxleCBnYXAtMSBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IiwgY2hpbGRyZW46IFtfanN4KCJidXR0b24iLCB7IG9uUG9pbnRlckRvd246IChlKSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpLCBvbkNsaWNrOiAoZSkgPT4geyBlLnN0b3BQcm9wYWdhdGlvbigpOyB1cGRhdGVUcmFjayh0cmFjay5pZCwgeyBpc011dGVkOiAhdHJhY2suaXNNdXRlZCB9KTsgfSwgY2xhc3NOYW1lOiBgcC0xIHJvdW5kZWQgdGV4dC1bOXB4XSBmb250LWJvbGQgJHt0cmFjay5pc011dGVkID8gJ2JnLXJlZC01MDAgdGV4dC13aGl0ZScgOiAnYmctemluYy03MDAgdGV4dC16aW5jLTMwMCd9YCwgY2hpbGRyZW46ICJNIiB9KSwgX2pzeCgiYnV0dG9uIiwgeyBvblBvaW50ZXJEb3duOiAoZSkgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSwgb25DbGljazogKGUpID0+IHsgZS5zdG9wUHJvcGFnYXRpb24oKTsgZGVsZXRlVHJhY2sodHJhY2suaWQpOyB9LCBjbGFzc05hbWU6ICJwLTEgcm91bmRlZCB0ZXh0LVs5cHhdIGJnLXppbmMtODAwIGhvdmVyOmJnLXJlZC05MDAvODAgdGV4dC16aW5jLTQwMCBob3Zlcjp0ZXh0LXdoaXRlIiwgY2hpbGRyZW46IF9qc3goVHJhc2hJY29uLCB7fSkgfSldIH0pKSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgbGVmdC0yIHRvcC0xIHotMTAgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgcG9pbnRlci1ldmVudHMtbm9uZSBtYXgtdy1mdWxsIG92ZXJmbG93LWhpZGRlbiIsIGNoaWxkcmVuOiBbX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC1bMTBweF0gZm9udC1ib2xkIHRleHQtemluYy0zMDAgc2hhZG93LWJsYWNrIGRyb3Atc2hhZG93LW1kIHRydW5jYXRlIiwgY2hpbGRyZW46IHRyYWNrLm5hbWUgfSksIHRyYWNrLmNyb3NzZmFkZU1ldGFkYXRhICYmIF9qc3goInNwYW4iLCB7IGNsYXNzTmFtZTogInRleHQtWzlweF0gcHgtMSBiZy1jeWFuLTkwMC81MCByb3VuZGVkIHRleHQtY3lhbi0zMDAiLCBjaGlsZHJlbjogIkxpbmtlZCIgfSldIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6IGBhYnNvbHV0ZSBpbnNldC14LTAgYm90dG9tLTAgdG9wLTUgJHtpc1RyaW1BY3RpdmUgPyAnb3ZlcmZsb3ctaGlkZGVuIHJpbmctMiByaW5nLXllbGxvdy00MDAvNTAgYmcteWVsbG93LTkwMC8xMCcgOiAnJ31gLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiaC1mdWxsIGFic29sdXRlIHRvcC0wIGxlZnQtMCB3LWZ1bGwiLCBjaGlsZHJlbjogX2pzeChXYXZlZm9ybURpc3BsYXksIHsgYnVmZmVyOiB0cmFjay5idWZmZXIsIHN0YXJ0VGltZTogdmlzdWFsU3RhcnRUaW1lLCB0cmltU3RhcnQ6IHZpc3VhbFRyaW1TdGFydCwgZHVyYXRpb246IHZpc3VhbER1cmF0aW9uLCBjdXJyZW50VGltZTogY3VycmVudFRpbWUsIHNlbGVjdGlvbjogc2VsZWN0ZWRUcmFja0lkID09PSB0cmFjay5pZCA/IHNlbGVjdGlvbiA6IG51bGwsIG9uU2VsZWN0aW9uQ2hhbmdlOiBzZXRTZWxlY3Rpb24sIGNvbG9yOiB0cmFjay5jb2xvciwgem9vbTogem9vbSwgZmFkZUluRHVyYXRpb246IGZhZGVJbkR1cmF0aW9uLCBmYWRlT3V0RHVyYXRpb246IGZhZGVPdXREdXJhdGlvbiB9KSB9KSwgaXNUcmltQWN0aXZlICYmIChfanN4cyhfRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogYGFic29sdXRlIHRvcC0wIGJvdHRvbS0wIGxlZnQtMCB3LTggYmFja2Ryb3AtYmx1ci1zbSByb3VuZGVkLWwtbWQgY3Vyc29yLWV3LXJlc2l6ZSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB6LTUwIHNoYWRvdy1sZyB0b3VjaC1ub25lIG92ZXJmbG93LWhpZGRlbiBiZy15ZWxsb3ctNDAwIHJpbmctMSByaW5nLWJsYWNrLzEwIGdyb3VwYCwgb25Qb2ludGVyRG93bjogKGUpID0+IGhhbmRsZVRyaW1Qb2ludGVyRG93bihlLCB0cmFjaywgJ3N0YXJ0JyksIG9uUG9pbnRlclVwOiAoZSkgPT4gaGFuZGxlVHJpbVBvaW50ZXJVcChlLCB0cmFjayksIGNoaWxkcmVuOiBpc0xlZnREcmFnZ2luZyA/IChfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImFic29sdXRlIGluc2V0LTAgcG9pbnRlci1ldmVudHMtbm9uZSBvcGFjaXR5LTkwIiwgY2hpbGRyZW46IF9qc3goV2F2ZWZvcm1EaXNwbGF5LCB7IGJ1ZmZlcjogdHJhY2suYnVmZmVyLCBzdGFydFRpbWU6IDAsIHRyaW1TdGFydDogdmlzdWFsVHJpbVN0YXJ0LCBkdXJhdGlvbjogaGFuZGxlRHVyYXRpb24sIGN1cnJlbnRUaW1lOiAtMSwgc2VsZWN0aW9uOiBudWxsLCBvblNlbGVjdGlvbkNoYW5nZTogKCkgPT4geyB9LCBjb2xvcjogIiIsIGNvbG9yT3ZlcnJpZGU6ICIjMDAwMDAwIiwgem9vbTogem9vbSwgZmFkZUluRHVyYXRpb246IGZhZGVJbkR1cmF0aW9uLCBmYWRlT3V0RHVyYXRpb246IGZhZGVPdXREdXJhdGlvbiB9KSB9KSkgOiAoX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ6LTEwIHRleHQtYmxhY2siLCBjaGlsZHJlbjogX2pzeChDaGV2cm9uTGVmdEljb24sIHt9KSB9KSkgfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiBgYWJzb2x1dGUgdG9wLTAgYm90dG9tLTAgcmlnaHQtMCB3LTggYmFja2Ryb3AtYmx1ci1zbSByb3VuZGVkLXItbWQgY3Vyc29yLWV3LXJlc2l6ZSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB6LTUwIHNoYWRvdy1sZyB0b3VjaC1ub25lIG92ZXJmbG93LWhpZGRlbiBiZy15ZWxsb3ctNDAwIHJpbmctMSByaW5nLWJsYWNrLzEwIGdyb3VwYCwgb25Qb2ludGVyRG93bjogKGUpID0+IGhhbmRsZVRyaW1Qb2ludGVyRG93bihlLCB0cmFjaywgJ2VuZCcpLCBvblBvaW50ZXJVcDogKGUpID0+IGhhbmRsZVRyaW1Qb2ludGVyVXAoZSwgdHJhY2spLCBjaGlsZHJlbjogaXNSaWdodERyYWdnaW5nID8gKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiYWJzb2x1dGUgaW5zZXQtMCBwb2ludGVyLWV2ZW50cy1ub25lIG9wYWNpdHktOTAiLCBjaGlsZHJlbjogX2pzeChXYXZlZm9ybURpc3BsYXksIHsgYnVmZmVyOiB0cmFjay5idWZmZXIsIHN0YXJ0VGltZTogMCwgdHJpbVN0YXJ0OiB2aXN1YWxUcmltU3RhcnQgKyB2aXN1YWxEdXJhdGlvbiAtIGhhbmRsZUR1cmF0aW9uLCBkdXJhdGlvbjogaGFuZGxlRHVyYXRpb24sIGN1cnJlbnRUaW1lOiAtMSwgc2VsZWN0aW9uOiBudWxsLCBvblNlbGVjdGlvbkNoYW5nZTogKCkgPT4geyB9LCBjb2xvcjogIiIsIGNvbG9yT3ZlcnJpZGU6ICIjMDAwMDAwIiwgem9vbTogem9vbSwgZmFkZUluRHVyYXRpb246IGZhZGVJbkR1cmF0aW9uLCBmYWRlT3V0RHVyYXRpb246IGZhZGVPdXREdXJhdGlvbiB9KSB9KSkgOiAoX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ6LTEwIHRleHQtYmxhY2siLCBjaGlsZHJlbjogX2pzeChDaGV2cm9uUmlnaHRJY29uLCB7fSkgfSkpIH0pXSB9KSldIH0pLCBpc0ludGVyYWN0aXZlICYmIChfanN4cyhfRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtpbnRlcmFjdGl2ZU1vZGU/LnR5cGUgPT09ICdmYWRlSW4nICYmIChfanN4cyhfRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtfanN4cygic3ZnIiwgeyBjbGFzc05hbWU6ICJhYnNvbHV0ZSBpbnNldC14LTAgYm90dG9tLTAgdG9wLTUgcG9pbnRlci1ldmVudHMtbm9uZSB6LTUwIG92ZXJmbG93LXZpc2libGUiLCBzdHlsZTogeyBoZWlnaHQ6ICc4MHB4JyB9LCBjaGlsZHJlbjogW19qc3goInBvbHlnb24iLCB7IHBvaW50czogYDAsMCAke2ZhZGVJbkR1cmF0aW9uICogem9vbX0sMCAwLDgwYCwgZmlsbDogInJnYmEoMjUwLCAyMDQsIDIxLCAwLjIpIiB9KSwgX2pzeCgibGluZSIsIHsgeDE6ICIwIiwgeTE6ICIxMDAlIiwgeDI6IGZhZGVJbkR1cmF0aW9uICogem9vbSwgeTI6ICIwIiwgc3Ryb2tlOiAiI2ZhY2MxNSIsIHN0cm9rZVdpZHRoOiAiMiIgfSldIH0pLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImZhZGUtaGFuZGxlIGFic29sdXRlIHRvcC0wIGgtNSB3LTYgei1bNjBdIGN1cnNvci1ncmFiIGFjdGl2ZTpjdXJzb3ItZ3JhYmJpbmcgdG91Y2gtbm9uZSBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWVuZCIsIHN0eWxlOiB7IGxlZnQ6IGAke2ZhZGVJbkR1cmF0aW9uICogem9vbSAtIDEyfXB4YCB9LCBvblBvaW50ZXJEb3duOiBoYW5kbGVGYWRlSGFuZGxlUG9pbnRlckRvd24sIGNoaWxkcmVuOiBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInctMCBoLTAgYm9yZGVyLWwtWzhweF0gYm9yZGVyLWwtdHJhbnNwYXJlbnQgYm9yZGVyLXItWzhweF0gYm9yZGVyLXItdHJhbnNwYXJlbnQgYm9yZGVyLXQtWzE0cHhdIGJvcmRlci10LXllbGxvdy00MDAgZHJvcC1zaGFkb3ctbWQgaG92ZXI6c2NhbGUtMTEwIHRyYW5zaXRpb24tdHJhbnNmb3JtIG1iLTAuNSIgfSkgfSldIH0pKSwgaW50ZXJhY3RpdmVNb2RlPy50eXBlID09PSAnZmFkZU91dCcgJiYgKF9qc3hzKF9GcmFnbWVudCwgeyBjaGlsZHJlbjogW19qc3hzKCJzdmciLCB7IGNsYXNzTmFtZTogImFic29sdXRlIGluc2V0LXgtMCBib3R0b20tMCB0b3AtNSBwb2ludGVyLWV2ZW50cy1ub25lIHotNTAgb3ZlcmZsb3ctdmlzaWJsZSIsIHN0eWxlOiB7IGhlaWdodDogJzgwcHgnIH0sIGNoaWxkcmVuOiBbX2pzeCgicG9seWdvbiIsIHsgcG9pbnRzOiBgJHsodmlzdWFsRHVyYXRpb24gLSBmYWRlT3V0RHVyYXRpb24pICogem9vbX0sMCAke3Zpc3VhbER1cmF0aW9uICogem9vbX0sMCAke3Zpc3VhbER1cmF0aW9uICogem9vbX0sODBgLCBmaWxsOiAicmdiYSgyNTAsIDIwNCwgMjEsIDAuMikiIH0pLCBfanN4KCJsaW5lIiwgeyB4MTogKHZpc3VhbER1cmF0aW9uIC0gZmFkZU91dER1cmF0aW9uKSAqIHpvb20sIHkxOiAiMCIsIHgyOiB2aXN1YWxEdXJhdGlvbiAqIHpvb20sIHkyOiAiODAiLCBzdHJva2U6ICIjZmFjYzE1Iiwgc3Ryb2tlV2lkdGg6ICIyIiB9KV0gfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZmFkZS1oYW5kbGUgYWJzb2x1dGUgdG9wLTAgaC01IHctNiB6LVs2MF0gY3Vyc29yLWdyYWIgYWN0aXZlOmN1cnNvci1ncmFiYmluZyB0b3VjaC1ub25lIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktZW5kIiwgc3R5bGU6IHsgbGVmdDogYCR7KHZpc3VhbER1cmF0aW9uIC0gZmFkZU91dER1cmF0aW9uKSAqIHpvb20gLSAxMn1weGAgfSwgb25Qb2ludGVyRG93bjogaGFuZGxlRmFkZUhhbmRsZVBvaW50ZXJEb3duLCBjaGlsZHJlbjogX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ3LTAgaC0wIGJvcmRlci1sLVs4cHhdIGJvcmRlci1sLXRyYW5zcGFyZW50IGJvcmRlci1yLVs4cHhdIGJvcmRlci1yLXRyYW5zcGFyZW50IGJvcmRlci10LVsxNHB4XSBib3JkZXItdC15ZWxsb3ctNDAwIGRyb3Atc2hhZG93LW1kIGhvdmVyOnNjYWxlLTExMCB0cmFuc2l0aW9uLXRyYW5zZm9ybSBtYi0wLjUiIH0pIH0pXSB9KSldIH0pKV0gfSwgdHJhY2suaWQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV0gfSkgfSkpXSB9KSwgX2pzeHMoImZvb3RlciIsIHsgY2xhc3NOYW1lOiAiXG4gICAgICAgIGJnLXppbmMtOTUwIGJvcmRlci10IGJvcmRlci16aW5jLTkwMCBwLTQgcGItOCBzYWZlLWFyZWEtcGIgc3BhY2UteS00IHNocmluay0wIHotMzAgc2hhZG93LVswXy01cHhfMjBweF9yZ2JhKDAsMCwwLDAuNSldXG4gICAgICAgIGZsZXggZmxleC1jb2wgXG4gICAgICAgIHctZnVsbCBsYW5kc2NhcGU6dy0yMCBsYW5kc2NhcGU6bGc6dy1mdWxsIFxuICAgICAgICBoLWF1dG8gbGFuZHNjYXBlOmgtZnVsbCBsYW5kc2NhcGU6bGc6aC1hdXRvIFxuICAgICAgICBsYW5kc2NhcGU6Ym9yZGVyLXQtMCBsYW5kc2NhcGU6Ym9yZGVyLWwgbGFuZHNjYXBlOmxnOmJvcmRlci10IGxhbmRzY2FwZTpsZzpib3JkZXItbC0wIFxuICAgICAgICBsYW5kc2NhcGU6cHktNCBsYW5kc2NhcGU6cHgtMiBsYW5kc2NhcGU6bGc6cC00IGxhbmRzY2FwZTpsZzpwYi04XG4gICAgICAgIGxhbmRzY2FwZTpqdXN0aWZ5LWJldHdlZW4gbGFuZHNjYXBlOmxnOmp1c3RpZnktbm9ybWFsXG4gICAgICAgIGxhbmRzY2FwZTpvdmVyZmxvdy12aXNpYmxlXG4gICAgICAgIG5vLXNjcm9sbGJhclxuICAgICAgIiwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJoaWRkZW4gbGFuZHNjYXBlOmZsZXggbGFuZHNjYXBlOmxnOmhpZGRlbiBmbGV4LWNvbCBoLWZ1bGwganVzdGlmeS1iZXR3ZWVuIHB5LTIiLCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZmxleC1jb2wgZ2FwLTQgaXRlbXMtY2VudGVyIiwgY2hpbGRyZW46IFtfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6ICgpID0+IGZpbGVJbnB1dFJlZi5jdXJyZW50Py5jbGljaygpLCBjbGFzc05hbWU6ICJmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBnYXAtMSB0ZXh0LXppbmMtNTAwIGhvdmVyOnRleHQtd2hpdGUgdHJhbnNpdGlvbiBncm91cCIsIGNoaWxkcmVuOiBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInAtMyByb3VuZGVkLWZ1bGwgYmctemluYy05MDAgZ3JvdXAtaG92ZXI6YmctemluYy04MDAgdHJhbnNpdGlvbiIsIGNoaWxkcmVuOiBfanN4KFVwbG9hZEljb24sIHt9KSB9KSB9KSwgX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBoYW5kbGVUb2dnbGVSZWNvcmQsIGNsYXNzTmFtZTogYGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC0xIHRyYW5zaXRpb24gZ3JvdXAgJHtpc1JlY29yZGluZyA/ICd0ZXh0LXJlZC01MDAgYW5pbWF0ZS1wdWxzZScgOiAndGV4dC16aW5jLTUwMCBob3Zlcjp0ZXh0LXdoaXRlJ31gLCBjaGlsZHJlbjogX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJwLTMgcm91bmRlZC1mdWxsIGJnLXppbmMtOTAwIGdyb3VwLWhvdmVyOmJnLXppbmMtODAwIHRyYW5zaXRpb24iLCBjaGlsZHJlbjogaXNSZWNvcmRpbmcgPyBfanN4KFN0b3BSZWNJY29uLCB7fSkgOiBfanN4KE1pY0ljb24sIHt9KSB9KSB9KSwgX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiAoKSA9PiBzZXRCZWF0TW9kYWxPcGVuKHRydWUpLCBjbGFzc05hbWU6ICJmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBnYXAtMSB0ZXh0LXppbmMtNTAwIGhvdmVyOnRleHQtd2hpdGUgdHJhbnNpdGlvbiBncm91cCIsIGNoaWxkcmVuOiBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInAtMyByb3VuZGVkLWZ1bGwgYmctemluYy05MDAgZ3JvdXAtaG92ZXI6YmctemluYy04MDAgdHJhbnNpdGlvbiIsIGNoaWxkcmVuOiBfanN4KERydW1JY29uLCB7fSkgfSkgfSldIH0pLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXgtMSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciIsIGNoaWxkcmVuOiBfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6IGhhbmRsZVBsYXlQYXVzZSwgZGlzYWJsZWQ6IHRyYWNrcy5sZW5ndGggPT09IDAgJiYgIWlzUmVjb3JkaW5nLCBjbGFzc05hbWU6IGB3LTE0IGgtMTQgcm91bmRlZC1mdWxsICR7aXNSZWNvcmRpbmcgPyAnYmctcmVkLTUwMCBob3ZlcjpiZy1yZWQtNDAwIHNoYWRvdy1yZWQtNTAwLzIwJyA6ICdiZy1jeWFuLTUwMCBob3ZlcjpiZy1jeWFuLTQwMCBzaGFkb3ctY3lhbi01MDAvMjAnfSB0ZXh0LWJsYWNrIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHNoYWRvdy14bCBhY3RpdmU6c2NhbGUtOTUgdHJhbnNpdGlvbiBkaXNhYmxlZDpvcGFjaXR5LTUwIGRpc2FibGVkOmdyYXlzY2FsZWAsIGNoaWxkcmVuOiBpc1BsYXlpbmcgPyBfanN4KFBhdXNlSWNvbiwge30pIDogX2pzeChQbGF5SWNvbiwge30pIH0pIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGZsZXgtY29sIGdhcC00IGl0ZW1zLWNlbnRlciIsIGNoaWxkcmVuOiBbX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBoYW5kbGVDdXQsIGRpc2FibGVkOiAhZWZmZWN0aXZlU2VsZWN0ZWRUcmFja0lkLCBjbGFzc05hbWU6IGB3LTEyIGgtMTIgcm91bmRlZC1mdWxsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRyYW5zaXRpb24gJHtlZmZlY3RpdmVTZWxlY3RlZFRyYWNrSWQgPyAnYmctemluYy04MDAgdGV4dC16aW5jLTEwMCBob3ZlcjpiZy16aW5jLTcwMCcgOiAnYmctemluYy05MDAgdGV4dC16aW5jLTYwMCd9YCwgY2hpbGRyZW46IF9qc3goU2Npc3NvcnNJY29uLCB7fSkgfSksIF9qc3goImJ1dHRvbiIsIHsgb25DbGljazogaGFuZGxlQ3JvcCwgZGlzYWJsZWQ6ICFlZmZlY3RpdmVTZWxlY3RlZFRyYWNrSWQsIGNsYXNzTmFtZTogYHctMTIgaC0xMiByb3VuZGVkLWZ1bGwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdHJhbnNpdGlvbiAke2lzVHJpbU1vZGUgPyAnYmcteWVsbG93LTQwMCB0ZXh0LWJsYWNrIGhvdmVyOmJnLXllbGxvdy0zMDAnIDogZWZmZWN0aXZlU2VsZWN0ZWRUcmFja0lkID8gJ2JnLXppbmMtODAwIHRleHQtemluYy0xMDAgaG92ZXI6YmctemluYy03MDAnIDogJ2JnLXppbmMtOTAwIHRleHQtemluYy02MDAnfWAsIGNoaWxkcmVuOiBfanN4KElPU0Nyb3BJY29uLCB7fSkgfSksIF9qc3goImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4geyBpZiAoaW50ZXJhY3RpdmVNb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJhY3RpdmVNb2RlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0RWZmZWN0c01vZGFsT3Blbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gfSwgZGlzYWJsZWQ6ICFlZmZlY3RpdmVTZWxlY3RlZFRyYWNrSWQsIGNsYXNzTmFtZTogYHctMTIgaC0xMiByb3VuZGVkLWZ1bGwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdHJhbnNpdGlvbiAke2ludGVyYWN0aXZlTW9kZSA/ICdiZy15ZWxsb3ctNDAwIHRleHQtYmxhY2sgaG92ZXI6YmcteWVsbG93LTMwMCcgOiBlZmZlY3RpdmVTZWxlY3RlZFRyYWNrSWQgPyAnYmctemluYy04MDAgdGV4dC16aW5jLTEwMCBob3ZlcjpiZy16aW5jLTcwMCcgOiAnYmctemluYy05MDAgdGV4dC16aW5jLTYwMCd9YCwgY2hpbGRyZW46IF9qc3goRnhJY29uLCB7fSkgfSldIH0pXSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBmbGV4LWNvbCBnYXAtNCBsYW5kc2NhcGU6aGlkZGVuIGxhbmRzY2FwZTpsZzpmbGV4IiwgY2hpbGRyZW46IFtfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gbWF4LXctbWQgbXgtYXV0byB3LWZ1bGwgcHgtNCBsYW5kc2NhcGU6bGc6Z2FwLTQiLCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggaXRlbXMtY2VudGVyIGdhcC00IiwgY2hpbGRyZW46IFtfanN4cygiYnV0dG9uIiwgeyBvbkNsaWNrOiAoKSA9PiBmaWxlSW5wdXRSZWYuY3VycmVudD8uY2xpY2soKSwgY2xhc3NOYW1lOiAiZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgZ2FwLTEgdGV4dC16aW5jLTUwMCBob3Zlcjp0ZXh0LXdoaXRlIHRyYW5zaXRpb24gZ3JvdXAiLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAicC0zIHJvdW5kZWQtZnVsbCBiZy16aW5jLTkwMCBncm91cC1ob3ZlcjpiZy16aW5jLTgwMCB0cmFuc2l0aW9uIiwgY2hpbGRyZW46IF9qc3goVXBsb2FkSWNvbiwge30pIH0pLCBfanN4KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LVs5cHhdIHVwcGVyY2FzZSBmb250LWJvbGQgdHJhY2tpbmctd2lkZSIsIGNoaWxkcmVuOiAiSW1wb3J0IiB9KV0gfSksIF9qc3hzKCJidXR0b24iLCB7IG9uQ2xpY2s6IGhhbmRsZVNhdmVBbmRDbG9zZSwgY2xhc3NOYW1lOiAiZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgZ2FwLTEgdGV4dC16aW5jLTUwMCBob3Zlcjp0ZXh0LXdoaXRlIHRyYW5zaXRpb24gZ3JvdXAiLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiBgdy0xMiBoLTEyIG92ZXJmbG93LWhpZGRlbiBiZy16aW5jLTkwMCBncm91cC1ob3ZlcjpyaW5nLTIgcmluZy1jeWFuLTUwMC81MCB0cmFuc2l0aW9uIGJvcmRlciBib3JkZXItemluYy04MDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgJHtyZWNlbnRQcm9qZWN0UHJldmlldyA/ICdyb3VuZGVkLW1kJyA6ICdyb3VuZGVkLWZ1bGwgcC0zJ31gLCBjaGlsZHJlbjogcmVjZW50UHJvamVjdFByZXZpZXcgPyAoX2pzeCgiaW1nIiwgeyBzcmM6IHJlY2VudFByb2plY3RQcmV2aWV3LCBhbHQ6ICJMaWJyYXJ5IiwgY2xhc3NOYW1lOiAidy1mdWxsIGgtZnVsbCBvYmplY3QtY292ZXIgb3BhY2l0eS04MCIgfSkpIDogKF9qc3goTGlicmFyeUljb24sIHt9KSkgfSksIF9qc3goInNwYW4iLCB7IGNsYXNzTmFtZTogInRleHQtWzlweF0gdXBwZXJjYXNlIGZvbnQtYm9sZCB0cmFja2luZy13aWRlIiwgY2hpbGRyZW46ICJMaWJyYXJ5IiB9KV0gfSldIH0pLCBfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6IGhhbmRsZVBsYXlQYXVzZSwgZGlzYWJsZWQ6IHRyYWNrcy5sZW5ndGggPT09IDAgJiYgIWlzUmVjb3JkaW5nLCBjbGFzc05hbWU6IGB3LTE2IGgtMTYgcm91bmRlZC1mdWxsICR7aXNSZWNvcmRpbmcgPyAnYmctcmVkLTUwMCBob3ZlcjpiZy1yZWQtNDAwIHNoYWRvdy1yZWQtNTAwLzIwJyA6ICdiZy1jeWFuLTUwMCBob3ZlcjpiZy1jeWFuLTQwMCBzaGFkb3ctY3lhbi01MDAvMjAnfSB0ZXh0LWJsYWNrIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHNoYWRvdy14bCBhY3RpdmU6c2NhbGUtOTUgdHJhbnNpdGlvbiBkaXNhYmxlZDpvcGFjaXR5LTUwIGRpc2FibGVkOmdyYXlzY2FsZWAsIGNoaWxkcmVuOiBpc1BsYXlpbmcgPyBfanN4KFBhdXNlSWNvbiwge30pIDogX2pzeChQbGF5SWNvbiwge30pIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCIsIGNoaWxkcmVuOiBbX2pzeHMoImJ1dHRvbiIsIHsgb25DbGljazogaGFuZGxlVG9nZ2xlUmVjb3JkLCBjbGFzc05hbWU6IGBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBnYXAtMSB0cmFuc2l0aW9uIGdyb3VwICR7aXNSZWNvcmRpbmcgPyAndGV4dC1yZWQtNTAwIGFuaW1hdGUtcHVsc2UnIDogJ3RleHQtemluYy01MDAgaG92ZXI6dGV4dC13aGl0ZSd9YCwgY2hpbGRyZW46IFtfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInAtMyByb3VuZGVkLWZ1bGwgYmctemluYy05MDAgZ3JvdXAtaG92ZXI6YmctemluYy04MDAgdHJhbnNpdGlvbiIsIGNoaWxkcmVuOiBpc1JlY29yZGluZyA/IF9qc3goU3RvcFJlY0ljb24sIHt9KSA6IF9qc3goTWljSWNvbiwge30pIH0pLCBfanN4KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LVs5cHhdIHVwcGVyY2FzZSBmb250LWJvbGQgdHJhY2tpbmctd2lkZSIsIGNoaWxkcmVuOiBpc1JlY29yZGluZyA/ICJTdG9wIiA6ICJNaWMiIH0pXSB9KSwgX2pzeHMoImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gc2V0QmVhdE1vZGFsT3Blbih0cnVlKSwgY2xhc3NOYW1lOiAiZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgZ2FwLTEgdGV4dC16aW5jLTUwMCBob3Zlcjp0ZXh0LXdoaXRlIHRyYW5zaXRpb24gZ3JvdXAiLCBjaGlsZHJlbjogW19qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAicC0zIHJvdW5kZWQtZnVsbCBiZy16aW5jLTkwMCBncm91cC1ob3ZlcjpiZy16aW5jLTgwMCB0cmFuc2l0aW9uIiwgY2hpbGRyZW46IF9qc3goRHJ1bUljb24sIHt9KSB9KSwgX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC1bOXB4XSB1cHBlcmNhc2UgZm9udC1ib2xkIHRyYWNraW5nLXdpZGUiLCBjaGlsZHJlbjogIkJlYXQiIH0pXSB9KV0gfSldIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJncmlkIGdyaWQtY29scy0zIGdhcC0yIG1heC13LW1kIG14LWF1dG8gdy1mdWxsIiwgY2hpbGRyZW46IFtfanN4KEJ1dHRvbiwgeyB2YXJpYW50OiAic2Vjb25kYXJ5IiwgaWNvbjogX2pzeChTY2lzc29yc0ljb24sIHt9KSwgbGFiZWw6ICJDdXQiLCBkaXNhYmxlZDogIWVmZmVjdGl2ZVNlbGVjdGVkVHJhY2tJZCwgb25DbGljazogaGFuZGxlQ3V0LCBjbGFzc05hbWU6ICJoLTEyIHRleHQteHMgYmctemluYy05MDAgYm9yZGVyLXppbmMtODAwIGhvdmVyOmJnLXppbmMtODAwIiB9KSwgX2pzeChCdXR0b24sIHsgdmFyaWFudDogaXNUcmltTW9kZSA/ICJwcmltYXJ5IiA6ICJzZWNvbmRhcnkiLCBpY29uOiBpc1RyaW1Nb2RlID8gbnVsbCA6IF9qc3goSU9TQ3JvcEljb24sIHt9KSwgbGFiZWw6IHNlbGVjdGlvbiA/ICJDcm9wIFNlbGVjdGlvbiIgOiAoaXNUcmltTW9kZSA/ICJEb25lIiA6ICJDcm9wIFRvb2wiKSwgZGlzYWJsZWQ6ICFlZmZlY3RpdmVTZWxlY3RlZFRyYWNrSWQsIG9uQ2xpY2s6IGhhbmRsZUNyb3AsIGNsYXNzTmFtZTogYGgtMTIgdGV4dC14cyAke2lzVHJpbU1vZGUgPyAnYmcteWVsbG93LTQwMCBob3ZlcjpiZy15ZWxsb3ctMzAwIHRleHQtYmxhY2sgYm9yZGVyLW5vbmUnIDogJ2JnLXppbmMtOTAwIGJvcmRlci16aW5jLTgwMCBob3ZlcjpiZy16aW5jLTgwMCd9YCB9KSwgX2pzeChCdXR0b24sIHsgdmFyaWFudDogaW50ZXJhY3RpdmVNb2RlID8gInByaW1hcnkiIDogInNlY29uZGFyeSIsIGljb246IGludGVyYWN0aXZlTW9kZSA/IG51bGwgOiBfanN4KEZ4SWNvbiwge30pLCBsYWJlbDogaW50ZXJhY3RpdmVNb2RlID8gIkRvbmUiIDogIkVmZmVjdHMiLCBkaXNhYmxlZDogIWVmZmVjdGl2ZVNlbGVjdGVkVHJhY2tJZCwgb25DbGljazogKCkgPT4geyBpZiAoaW50ZXJhY3RpdmVNb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJhY3RpdmVNb2RlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0RWZmZWN0c01vZGFsT3Blbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gfSwgY2xhc3NOYW1lOiBgaC0xMiB0ZXh0LXhzICR7aW50ZXJhY3RpdmVNb2RlID8gJ2JnLXllbGxvdy00MDAgaG92ZXI6YmcteWVsbG93LTMwMCB0ZXh0LWJsYWNrIGJvcmRlci1ub25lJyA6ICdiZy16aW5jLTkwMCBib3JkZXItemluYy04MDAgaG92ZXI6YmctemluYy04MDAnfWAgfSldIH0pXSB9KV0gfSksIF9qc3goImlucHV0IiwgeyB0eXBlOiAiZmlsZSIsIG11bHRpcGxlOiB0cnVlLCByZWY6IGZpbGVJbnB1dFJlZiwgb25DaGFuZ2U6IGhhbmRsZUZpbGVVcGxvYWQsIGFjY2VwdDogImF1ZGlvLyosLm1wMywud2F2LC5tNGEsLmZsYWMsLm9nZywuYWFjIiwgY2xhc3NOYW1lOiAiaGlkZGVuIiB9KSwgX2pzeChCZWF0TWFrZXJNb2RhbCwgeyBpc09wZW46IGlzQmVhdE1vZGFsT3Blbiwgb25DbG9zZTogKCkgPT4gc2V0QmVhdE1vZGFsT3BlbihmYWxzZSksIG9uR2VuZXJhdGU6IGhhbmRsZUFkZEJlYXQgfSksIF9qc3goRWZmZWN0c01vZGFsLCB7IGlzT3BlbjogaXNFZmZlY3RzTW9kYWxPcGVuLCBvbkNsb3NlOiAoKSA9PiBzZXRFZmZlY3RzTW9kYWxPcGVuKGZhbHNlKSwgb25BcHBseTogaGFuZGxlQXBwbHlFZmZlY3QsIGFjdGl2ZUVmZmVjdHM6IHNlbGVjdGVkVHJhY2s/LmFjdGl2ZUVmZmVjdHMsIGlzQ3Jvc3NmYWRlZDogISFzZWxlY3RlZFRyYWNrPy5jcm9zc2ZhZGVNZXRhZGF0YSB9KSwgX2pzeChFeHBvcnRNb2RhbCwgeyBpc09wZW46IGlzRXhwb3J0TW9kYWxPcGVuLCBvbkNsb3NlOiAoKSA9PiBzZXRFeHBvcnRNb2RhbE9wZW4oZmFsc2UpLCBvbkV4cG9ydDogaGFuZGxlRXhwb3J0LCBvcmlnaW5hbFNhbXBsZVJhdGU6IDQ0MTAwIH0pXSB9KSk7Cn07CmV4cG9ydCBkZWZhdWx0IEFwcDsK","@/components/EffectsModal":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IEJ1dHRvbiBmcm9tICdAL2NvbXBvbmVudHMvQnV0dG9uJzsKLy8gSWNvbnMKY29uc3QgRXF1YWxpemVySWNvbiA9ICgpID0+IChfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNiBoLTYiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMTIgNlY0bTAgMmEyIDIgMCAxMDAgNG0wLTRhMiAyIDAgMTEwIDRtLTYgOGEyIDIgMCAxMDAtNG0wIDRhMiAyIDAgMTEwLTRtMCA0djJtMC02VjRtNiA2djEwbTYtMmEyIDIgMCAxMDAtNG0wIDRhMiAyIDAgMTEwLTRtMCA0djJtMC02VjQiIH0pIH0pKTsKY29uc3QgTm9ybWFsaXplSWNvbiA9ICgpID0+IChfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNiBoLTYiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMyAxMy4xMjVDMyAxMi41MDQgMy41MDQgMTIgNC4xMjUgMTJoMi4yNWMuNjIxIDAgMS4xMjUuNTA0IDEuMTI1IDEuMTI1djYuNzVDNy41IDIwLjQ5NiA2Ljk5NiAyMSA2LjM3NSAyMWgtMi4yNUExLjEyNSAxLjEyNSAwIDAxMyAxOS44NzV2LTYuNzV6TTkuNzUgOC42MjVjMC0uNjIxLjUwNC0xLjEyNSAxLjEyNS0xLjEyNWgyLjI1Yy42MjEgMCAxLjEyNS41MDQgMS4xMjUgMS4xMjV2MTEuMjVjMCAuNjIxLS41MDQgMS4xMjUtMS4xMjUgMS4xMjVoLTIuMjVhMS4xMjUgMS4xMjUgMCAwMS0xLjEyNS0xLjEyNVY4LjYyNXpNMTYuNSA0LjEyNWMwLS42MjEuNTA0LTEuMTI1IDEuMTI1LTEuMTI1aDIuMjVDMjAuNDk2IDMgMjEgMy41MDQgMjEgNC4xMjV2MTUuNzVjMCAuNjIxLS41MDQgMS4xMjUtMS4xMjUgMS4xMjVoLTIuMjVhMS4xMjUgMS4xMjUgMCAwMS0xLjEyNS0xLjEyNVY0LjEyNXoiIH0pIH0pKTsKY29uc3QgUmV2ZXJzZUljb24gPSAoKSA9PiAoX2pzeCgic3ZnIiwgeyBjbGFzc05hbWU6ICJ3LTYgaC02IiwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTkgMTVMMyA5bTAgMGw2LTZNMyA5aDEyYTYgNiAwIDAxMCAxMmgtMyIgfSkgfSkpOwpjb25zdCBTbG93SWNvbiA9ICgpID0+IChfanN4KCJzdmciLCB7IGNsYXNzTmFtZTogInctNiBoLTYiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMTIgNnY2aDQuNW00LjUgMGE5IDkgMCAxMS0xOCAwIDkgOSAwIDAxMTggMHoiIH0pIH0pKTsKY29uc3QgRmFzdEljb24gPSAoKSA9PiAoX2pzeCgic3ZnIiwgeyBjbGFzc05hbWU6ICJ3LTYgaC02IiwgZmlsbDogIm5vbmUiLCBzdHJva2U6ICJjdXJyZW50Q29sb3IiLCBzdHJva2VXaWR0aDogIjIiLCB2aWV3Qm94OiAiMCAwIDI0IDI0IiwgY2hpbGRyZW46IF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTEyIDZ2Nmg0LjVtNC41IDBhOSA5IDAgMTEtMTggMCA5IDkgMCAwMTE4IDB6IiB9KSB9KSk7CmNvbnN0IENyb3NzZmFkZUljb24gPSAoKSA9PiAoX2pzeHMoInN2ZyIsIHsgY2xhc3NOYW1lOiAidy02IGgtNiIsIGZpbGw6ICJub25lIiwgc3Ryb2tlOiAiY3VycmVudENvbG9yIiwgc3Ryb2tlV2lkdGg6ICIyIiwgdmlld0JveDogIjAgMCAyNCAyNCIsIGNoaWxkcmVuOiBbX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNMTkgMTljLTEuNSAwLTMtMS00LTNsLTYtOGMtMS0yLTIuNS0zLTQtMyIgfSksIF9qc3goInBhdGgiLCB7IHN0cm9rZUxpbmVjYXA6ICJyb3VuZCIsIHN0cm9rZUxpbmVqb2luOiAicm91bmQiLCBkOiAiTTUgMTljMS41IDAgMy0xIDQtM2w2LThjMS0yIDIuNS0zIDQtMyIgfSldIH0pKTsKY29uc3QgRWZmZWN0c01vZGFsID0gKHsgaXNPcGVuLCBvbkNsb3NlLCBvbkFwcGx5LCBhY3RpdmVFZmZlY3RzLCBpc0Nyb3NzZmFkZWQgfSkgPT4gewogICAgY29uc3QgW3NlbGVjdGVkRWZmZWN0SWQsIHNldFNlbGVjdGVkRWZmZWN0SWRdID0gdXNlU3RhdGUobnVsbCk7CiAgICBjb25zdCBbY3VzdG9tVmFsdWUsIHNldEN1c3RvbVZhbHVlXSA9IHVzZVN0YXRlKCcnKTsKICAgIGlmICghaXNPcGVuKQogICAgICAgIHJldHVybiBudWxsOwogICAgY29uc3QgZWZmZWN0cyA9IFsKICAgICAgICB7IGlkOiAnZmFkZUluJywgbGFiZWw6ICdGYWRlIEluJywgaWNvbjogJ+KXoicsIGlzU3VibWVudTogdHJ1ZSB9LAogICAgICAgIHsgaWQ6ICdmYWRlT3V0JywgbGFiZWw6ICdGYWRlIE91dCcsIGljb246ICfil6MnLCBpc1N1Ym1lbnU6IHRydWUgfSwKICAgICAgICB7IGlkOiAnY3Jvc3NmYWRlJywgbGFiZWw6ICdDcm9zc2ZhZGUnLCBpY29uOiBfanN4KENyb3NzZmFkZUljb24sIHt9KSwgaXNTdWJtZW51OiB0cnVlIH0sCiAgICAgICAgeyBpZDogJ2VxJywgbGFiZWw6ICdFUScsIGljb246IF9qc3goRXF1YWxpemVySWNvbiwge30pLCBpc1N1Ym1lbnU6IHRydWUgfSwKICAgICAgICB7IGlkOiAnbm9ybWFsaXplJywgbGFiZWw6ICdOb3JtYWxpemUnLCBpY29uOiBfanN4KE5vcm1hbGl6ZUljb24sIHt9KSwgaXNTdWJtZW51OiBmYWxzZSB9LAogICAgICAgIHsgaWQ6ICdyZXZlcnNlJywgbGFiZWw6ICdSZXZlcnNlJywgaWNvbjogX2pzeChSZXZlcnNlSWNvbiwge30pLCBpc1N1Ym1lbnU6IGZhbHNlIH0sCiAgICAgICAgeyBpZDogJ3Nsb3cnLCBsYWJlbDogJ1Nsb3cgRG93bicsIGljb246IF9qc3goU2xvd0ljb24sIHt9KSwgaXNTdWJtZW51OiB0cnVlIH0sCiAgICAgICAgeyBpZDogJ2Zhc3QnLCBsYWJlbDogJ1NwZWVkIFVwJywgaWNvbjogX2pzeChGYXN0SWNvbiwge30pLCBpc1N1Ym1lbnU6IHRydWUgfSwKICAgIF07CiAgICBjb25zdCBlcVByZXNldHMgPSBbCiAgICAgICAgJ0Jhc3MgQm9vc3QnLAogICAgICAgICdUcmVibGUgQm9vc3QnLAogICAgICAgICdCYXNzIEN1dCcsCiAgICAgICAgJ1RyZWJsZSBDdXQnLAogICAgICAgICdNaWQgQm9vc3QnLAogICAgICAgICdWLVNoYXBlJywKICAgICAgICAnTG8tRmkgUmFkaW8nLAogICAgICAgICdUZWxlcGhvbmUnCiAgICBdOwogICAgY29uc3QgY2hlY2tBY3RpdmUgPSAoaWQpID0+IHsKICAgICAgICBpZiAoaWQgPT09ICdmYWRlSW4nKQogICAgICAgICAgICByZXR1cm4gISFhY3RpdmVFZmZlY3RzPy5mYWRlSW47CiAgICAgICAgaWYgKGlkID09PSAnZmFkZU91dCcpCiAgICAgICAgICAgIHJldHVybiAhIWFjdGl2ZUVmZmVjdHM/LmZhZGVPdXQ7CiAgICAgICAgaWYgKGlkID09PSAnY3Jvc3NmYWRlJykKICAgICAgICAgICAgcmV0dXJuICEhaXNDcm9zc2ZhZGVkOwogICAgICAgIGlmIChpZCA9PT0gJ25vcm1hbGl6ZScpCiAgICAgICAgICAgIHJldHVybiAhIWFjdGl2ZUVmZmVjdHM/Lm5vcm1hbGl6ZTsKICAgICAgICBpZiAoaWQgPT09ICdyZXZlcnNlJykKICAgICAgICAgICAgcmV0dXJuICEhYWN0aXZlRWZmZWN0cz8ucmV2ZXJzZTsKICAgICAgICBpZiAoaWQgPT09ICdlcScpCiAgICAgICAgICAgIHJldHVybiAhIWFjdGl2ZUVmZmVjdHM/LmVxUHJlc2V0OwogICAgICAgIGlmIChpZCA9PT0gJ3Nsb3cnKQogICAgICAgICAgICByZXR1cm4gKGFjdGl2ZUVmZmVjdHM/LnBsYXliYWNrUmF0ZSB8fCAxKSA8IDE7CiAgICAgICAgaWYgKGlkID09PSAnZmFzdCcpCiAgICAgICAgICAgIHJldHVybiAoYWN0aXZlRWZmZWN0cz8ucGxheWJhY2tSYXRlIHx8IDEpID4gMTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogICAgY29uc3QgaGFuZGxlRWZmZWN0Q2xpY2sgPSAoZngpID0+IHsKICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IGNoZWNrQWN0aXZlKGZ4LmlkKTsKICAgICAgICBpZiAoZnguaXNTdWJtZW51KSB7CiAgICAgICAgICAgIC8vIElmIGFjdGl2ZSAobGlrZSBFUS9TcGVlZCksIG9wZW5pbmcgdGhlIG1lbnUgYWxsb3dzIG1vZGlmaWNhdGlvbiBvciByZXN0b3JlCiAgICAgICAgICAgIC8vIEZvciBDcm9zc2ZhZGUsIHdlIGhhbmRsZSBzcGVjaWZpYyByZXN0b3JlIGluIGl0cyBzdWJtZW51CiAgICAgICAgICAgIHNldFNlbGVjdGVkRWZmZWN0SWQoZnguaWQpOwogICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCBjdXN0b20gdmFsdWUgZm9yIHNwZWVkIG1lbnVzCiAgICAgICAgICAgIGlmIChmeC5pZCA9PT0gJ3Nsb3cnIHx8IGZ4LmlkID09PSAnZmFzdCcpIHsKICAgICAgICAgICAgICAgIHNldEN1c3RvbVZhbHVlKGFjdGl2ZUVmZmVjdHM/LnBsYXliYWNrUmF0ZSA/IGFjdGl2ZUVmZmVjdHMucGxheWJhY2tSYXRlLnRvU3RyaW5nKCkgOiAoZnguaWQgPT09ICdzbG93JyA/ICcwLjUnIDogJzEuNScpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChmeC5pZCA9PT0gJ2ZhZGVJbicgfHwgZnguaWQgPT09ICdmYWRlT3V0JykgewogICAgICAgICAgICAgICAgc2V0Q3VzdG9tVmFsdWUoJzMuMCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgc2V0Q3VzdG9tVmFsdWUoJycpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBGb3IgdG9nZ2xlcyAoTm9ybWFsaXplLCBSZXZlcnNlKQogICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgIC8vIEl0J3MgYWN0aXZlLCBzbyBjbGlja2luZyBpdCBhZ2FpbiBzaG91bGQgcmVtb3ZlIGl0CiAgICAgICAgICAgICAgICBvbkFwcGx5KGZ4LmlkLCB7IHJlc3RvcmU6IHRydWUgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJdCdzIGluYWN0aXZlLCBlbmFibGUgaXQKICAgICAgICAgICAgICAgIG9uQXBwbHkoZnguaWQsIHsgdG9nZ2xlOiB0cnVlIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9uQ2xvc2UoKTsKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgaGFuZGxlQXBwbHlXaXRoRHVyYXRpb24gPSAoZHVyYXRpb24pID0+IHsKICAgICAgICBpZiAoc2VsZWN0ZWRFZmZlY3RJZCkgewogICAgICAgICAgICBvbkFwcGx5KHNlbGVjdGVkRWZmZWN0SWQsIHsgZHVyYXRpb24gfSk7CiAgICAgICAgICAgIG9uQ2xvc2UoKTsKICAgICAgICAgICAgc2V0U2VsZWN0ZWRFZmZlY3RJZChudWxsKTsKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgaGFuZGxlQXBwbHlQcmVzZXQgPSAocHJlc2V0KSA9PiB7CiAgICAgICAgaWYgKHNlbGVjdGVkRWZmZWN0SWQpIHsKICAgICAgICAgICAgb25BcHBseShzZWxlY3RlZEVmZmVjdElkLCB7IHByZXNldCB9KTsKICAgICAgICAgICAgb25DbG9zZSgpOwogICAgICAgICAgICBzZXRTZWxlY3RlZEVmZmVjdElkKG51bGwpOwogICAgICAgIH0KICAgIH07CiAgICBjb25zdCBoYW5kbGVBcHBseVNwZWVkID0gKHJhdGUpID0+IHsKICAgICAgICBpZiAoc2VsZWN0ZWRFZmZlY3RJZCkgewogICAgICAgICAgICBvbkFwcGx5KHNlbGVjdGVkRWZmZWN0SWQsIHsgcGxheWJhY2tSYXRlOiByYXRlIH0pOwogICAgICAgICAgICBvbkNsb3NlKCk7CiAgICAgICAgICAgIHNldFNlbGVjdGVkRWZmZWN0SWQobnVsbCk7CiAgICAgICAgfQogICAgfTsKICAgIGNvbnN0IGhhbmRsZUludGVyYWN0aXZlID0gKCkgPT4gewogICAgICAgIGlmIChzZWxlY3RlZEVmZmVjdElkKSB7CiAgICAgICAgICAgIG9uQXBwbHkoc2VsZWN0ZWRFZmZlY3RJZCwgeyBpbnRlcmFjdGl2ZTogdHJ1ZSB9KTsKICAgICAgICAgICAgb25DbG9zZSgpOwogICAgICAgICAgICBzZXRTZWxlY3RlZEVmZmVjdElkKG51bGwpOwogICAgICAgIH0KICAgIH07CiAgICBjb25zdCBoYW5kbGVSZXN0b3JlID0gKCkgPT4gewogICAgICAgIGlmIChzZWxlY3RlZEVmZmVjdElkKSB7CiAgICAgICAgICAgIG9uQXBwbHkoc2VsZWN0ZWRFZmZlY3RJZCwgeyByZXN0b3JlOiB0cnVlIH0pOwogICAgICAgICAgICBvbkNsb3NlKCk7CiAgICAgICAgICAgIHNldFNlbGVjdGVkRWZmZWN0SWQobnVsbCk7CiAgICAgICAgfQogICAgfTsKICAgIC8vIFN1Yi1tZW51IGZvciBFUQogICAgaWYgKHNlbGVjdGVkRWZmZWN0SWQgPT09ICdlcScpIHsKICAgICAgICByZXR1cm4gKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZml4ZWQgaW5zZXQtMCB6LTUwIGZsZXggaXRlbXMtZW5kIHNtOml0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBiZy1ibGFjay84MCBiYWNrZHJvcC1ibHVyLXNtIHAtNCBhbmltYXRlLWluIGZhZGUtaW4gZHVyYXRpb24tMjAwIiwgY2hpbGRyZW46IF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImJnLXppbmMtOTAwIGJvcmRlciBib3JkZXItemluYy04MDAgcm91bmRlZC0yeGwgdy1mdWxsIG1heC13LXNtIHAtNiBzaGFkb3ctMnhsIHNwYWNlLXktNCBtYi00IHNtOm1iLTAiLCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBib3JkZXItYiBib3JkZXItemluYy04MDAgcGItMiIsIGNoaWxkcmVuOiBbX2pzeCgiaDIiLCB7IGNsYXNzTmFtZTogInRleHQtbGcgZm9udC1ib2xkIHRleHQtd2hpdGUiLCBjaGlsZHJlbjogIlNlbGVjdCBFUSBQcmVzZXQiIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGdhcC0yIiwgY2hpbGRyZW46IFtjaGVja0FjdGl2ZSgnZXEnKSAmJiAoX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBoYW5kbGVSZXN0b3JlLCBjbGFzc05hbWU6ICJ0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXJlZC00MDAgYmctcmVkLTkwMC8yMCBweC0yIHB5LTEgcm91bmRlZCBob3ZlcjpiZy1yZWQtOTAwLzUwIiwgY2hpbGRyZW46ICJSZW1vdmUiIH0pKSwgX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiAoKSA9PiBzZXRTZWxlY3RlZEVmZmVjdElkKG51bGwpLCBjbGFzc05hbWU6ICJ0ZXh0LXppbmMtNTAwIGhvdmVyOnRleHQtd2hpdGUgdGV4dC1zbSIsIGNoaWxkcmVuOiAiQmFjayIgfSldIH0pXSB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJncmlkIGdyaWQtY29scy0yIGdhcC0yIG1heC1oLVszMDBweF0gb3ZlcmZsb3cteS1hdXRvIiwgY2hpbGRyZW46IGVxUHJlc2V0cy5tYXAocHJlc2V0ID0+IChfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6ICgpID0+IGhhbmRsZUFwcGx5UHJlc2V0KHByZXNldCksIGNsYXNzTmFtZTogYHB5LTMgcHgtMiByb3VuZGVkLWxnIHRyYW5zaXRpb24gZm9udC1tZWRpdW0gdGV4dC1zbSAke2FjdGl2ZUVmZmVjdHM/LmVxUHJlc2V0ID09PSBwcmVzZXQgPyAnYmctY3lhbi05MDAvNTAgdGV4dC1jeWFuLTQwMCByaW5nLTEgcmluZy1jeWFuLTUwMCcgOiAnYmctemluYy04MDAgdGV4dC16aW5jLTMwMCBob3ZlcjpiZy1jeWFuLTkwMC8zMCd9YCwgY2hpbGRyZW46IHByZXNldCB9LCBwcmVzZXQpKSkgfSldIH0pIH0pKTsKICAgIH0KICAgIC8vIFN1Yi1tZW51IGZvciBGYWRlcyAoVXBkYXRlZCBVSSkKICAgIGlmIChzZWxlY3RlZEVmZmVjdElkID09PSAnZmFkZUluJyB8fCBzZWxlY3RlZEVmZmVjdElkID09PSAnZmFkZU91dCcgfHwgc2VsZWN0ZWRFZmZlY3RJZCA9PT0gJ2Nyb3NzZmFkZScpIHsKICAgICAgICBjb25zdCBpc0ZhZGUgPSBzZWxlY3RlZEVmZmVjdElkICE9PSAnY3Jvc3NmYWRlJzsKICAgICAgICByZXR1cm4gKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZml4ZWQgaW5zZXQtMCB6LTUwIGZsZXggaXRlbXMtZW5kIHNtOml0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBiZy1ibGFjay84MCBiYWNrZHJvcC1ibHVyLXNtIHAtNCBhbmltYXRlLWluIGZhZGUtaW4gZHVyYXRpb24tMjAwIiwgY2hpbGRyZW46IF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImJnLXppbmMtOTAwIGJvcmRlciBib3JkZXItemluYy04MDAgcm91bmRlZC0yeGwgdy1mdWxsIG1heC13LXNtIHAtNiBzaGFkb3ctMnhsIHNwYWNlLXktNCBtYi00IHNtOm1iLTAiLCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBib3JkZXItYiBib3JkZXItemluYy04MDAgcGItMiBoLTEwIiwgY2hpbGRyZW46IFtfanN4KCJoMiIsIHsgY2xhc3NOYW1lOiAidGV4dC1sZyBmb250LWJvbGQgdGV4dC13aGl0ZSIsIGNoaWxkcmVuOiAiU2VsZWN0IER1cmF0aW9uIiB9KSwgaXNGYWRlICYmIChfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6IGhhbmRsZUludGVyYWN0aXZlLCBjbGFzc05hbWU6ICJiZy15ZWxsb3ctNTAwIGhvdmVyOmJnLXllbGxvdy00MDAgdGV4dC1ibGFjayBweC00IHB5LTEgcm91bmRlZC1tZCBmb250LWJvbGQgdGV4dC1sZyBzaGFkb3ctbGcgc2hhZG93LXllbGxvdy01MDAvMjAgdHJhbnNpdGlvbiBhY3RpdmU6c2NhbGUtOTUiLCBjaGlsZHJlbjogIlNsaWRlciIgfSkpLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGdhcC0yIiwgY2hpbGRyZW46IFtjaGVja0FjdGl2ZShzZWxlY3RlZEVmZmVjdElkKSAmJiAoX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBoYW5kbGVSZXN0b3JlLCBjbGFzc05hbWU6ICJ0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXJlZC00MDAgYmctcmVkLTkwMC8yMCBweC0yIHB5LTEgcm91bmRlZCBob3ZlcjpiZy1yZWQtOTAwLzUwIiwgY2hpbGRyZW46ICJSZW1vdmUiIH0pKSwgX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiAoKSA9PiBzZXRTZWxlY3RlZEVmZmVjdElkKG51bGwpLCBjbGFzc05hbWU6ICJ0ZXh0LXppbmMtNTAwIGhvdmVyOnRleHQtd2hpdGUgdGV4dC1zbSIsIGNoaWxkcmVuOiAiQmFjayIgfSldIH0pXSB9KSwgX2pzeCgiZGl2IiwgeyBjbGFzc05hbWU6ICJncmlkIGdyaWQtY29scy0zIGdhcC0yIiwgY2hpbGRyZW46IFswLjI1LCAwLjUsIDEuMCwgMi4wLCAzLjAsIDUuMF0ubWFwKGQgPT4gKF9qc3hzKCJidXR0b24iLCB7IG9uQ2xpY2s6ICgpID0+IGhhbmRsZUFwcGx5V2l0aER1cmF0aW9uKGQpLCBjbGFzc05hbWU6ICJweS0zIGJnLXppbmMtODAwIHJvdW5kZWQtbGcgaG92ZXI6YmctY3lhbi05MDAvNTAgaG92ZXI6dGV4dC1jeWFuLTQwMCB0cmFuc2l0aW9uIGZvbnQtbWVkaXVtIiwgY2hpbGRyZW46IFtkLCAicyJdIH0sIGQpKSkgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZ2FwLTIgaXRlbXMtY2VudGVyIHB0LTIiLCBjaGlsZHJlbjogW19qc3goInNwYW4iLCB7IGNsYXNzTmFtZTogInRleHQteHMgdGV4dC16aW5jLTUwMCB1cHBlcmNhc2UgZm9udC1ib2xkIiwgY2hpbGRyZW46ICJDdXN0b206IiB9KSwgX2pzeCgiaW5wdXQiLCB7IHR5cGU6ICJudW1iZXIiLCB2YWx1ZTogY3VzdG9tVmFsdWUsIG9uQ2hhbmdlOiAoZSkgPT4gc2V0Q3VzdG9tVmFsdWUoZS50YXJnZXQudmFsdWUpLCBjbGFzc05hbWU6ICJiZy16aW5jLTk1MCBib3JkZXIgYm9yZGVyLXppbmMtNzAwIHJvdW5kZWQgcHgtMiBweS0xIHctMjAgdGV4dC1jZW50ZXIgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctY3lhbi01MDAgb3V0bGluZS1ub25lIiB9KSwgX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC16aW5jLTUwMCIsIGNoaWxkcmVuOiAicyIgfSksIF9qc3goQnV0dG9uLCB7IHZhcmlhbnQ6ICJwcmltYXJ5IiwgbGFiZWw6ICJBcHBseSIsIG9uQ2xpY2s6ICgpID0+IGhhbmRsZUFwcGx5V2l0aER1cmF0aW9uKHBhcnNlRmxvYXQoY3VzdG9tVmFsdWUpIHx8IDEpLCBjbGFzc05hbWU6ICJweS0xIHB4LTMgdGV4dC1zbSBoLTggbWwtYXV0byIgfSldIH0pXSB9KSB9KSk7CiAgICB9CiAgICAvLyBTdWItbWVudSBmb3IgU3BlZWQgKFNsb3cvRmFzdCkKICAgIGlmIChzZWxlY3RlZEVmZmVjdElkID09PSAnc2xvdycgfHwgc2VsZWN0ZWRFZmZlY3RJZCA9PT0gJ2Zhc3QnKSB7CiAgICAgICAgY29uc3QgcHJlc2V0cyA9IHNlbGVjdGVkRWZmZWN0SWQgPT09ICdzbG93JyA/IFswLjI1LCAwLjUsIDAuNzUsIDAuOV0gOiBbMS4xLCAxLjI1LCAxLjUsIDIuMF07CiAgICAgICAgY29uc3QgdGl0bGUgPSBzZWxlY3RlZEVmZmVjdElkID09PSAnc2xvdycgPyAnU2xvdyBEb3duIEFtb3VudCcgOiAnU3BlZWQgVXAgQW1vdW50JzsKICAgICAgICByZXR1cm4gKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZml4ZWQgaW5zZXQtMCB6LTUwIGZsZXggaXRlbXMtZW5kIHNtOml0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBiZy1ibGFjay84MCBiYWNrZHJvcC1ibHVyLXNtIHAtNCBhbmltYXRlLWluIGZhZGUtaW4gZHVyYXRpb24tMjAwIiwgY2hpbGRyZW46IF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImJnLXppbmMtOTAwIGJvcmRlciBib3JkZXItemluYy04MDAgcm91bmRlZC0yeGwgdy1mdWxsIG1heC13LXNtIHAtNiBzaGFkb3ctMnhsIHNwYWNlLXktNCBtYi00IHNtOm1iLTAiLCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBib3JkZXItYiBib3JkZXItemluYy04MDAgcGItMiIsIGNoaWxkcmVuOiBbX2pzeCgiaDIiLCB7IGNsYXNzTmFtZTogInRleHQtbGcgZm9udC1ib2xkIHRleHQtd2hpdGUiLCBjaGlsZHJlbjogdGl0bGUgfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXggZ2FwLTIiLCBjaGlsZHJlbjogW2NoZWNrQWN0aXZlKHNlbGVjdGVkRWZmZWN0SWQpICYmIChfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6IGhhbmRsZVJlc3RvcmUsIGNsYXNzTmFtZTogInRleHQteHMgZm9udC1ib2xkIHRleHQtcmVkLTQwMCBiZy1yZWQtOTAwLzIwIHB4LTIgcHktMSByb3VuZGVkIGhvdmVyOmJnLXJlZC05MDAvNTAiLCBjaGlsZHJlbjogIlJlbW92ZSIgfSkpLCBfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6ICgpID0+IHNldFNlbGVjdGVkRWZmZWN0SWQobnVsbCksIGNsYXNzTmFtZTogInRleHQtemluYy01MDAgaG92ZXI6dGV4dC13aGl0ZSB0ZXh0LXNtIiwgY2hpbGRyZW46ICJCYWNrIiB9KV0gfSldIH0pLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImdyaWQgZ3JpZC1jb2xzLTIgZ2FwLTIiLCBjaGlsZHJlbjogcHJlc2V0cy5tYXAocmF0ZSA9PiAoX2pzeHMoImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gaGFuZGxlQXBwbHlTcGVlZChyYXRlKSwgY2xhc3NOYW1lOiBgcHktMyBiZy16aW5jLTgwMCByb3VuZGVkLWxnIGhvdmVyOmJnLWN5YW4tOTAwLzUwIGhvdmVyOnRleHQtY3lhbi00MDAgdHJhbnNpdGlvbiBmb250LW1lZGl1bSAke2FjdGl2ZUVmZmVjdHM/LnBsYXliYWNrUmF0ZSA9PT0gcmF0ZSA/ICdiZy1jeWFuLTkwMC81MCB0ZXh0LWN5YW4tNDAwIHJpbmctMSByaW5nLWN5YW4tNTAwJyA6ICcnfWAsIGNoaWxkcmVuOiBbcmF0ZSwgIngiXSB9LCByYXRlKSkpIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJmbGV4IGdhcC0yIGl0ZW1zLWNlbnRlciBwdC0yIiwgY2hpbGRyZW46IFtfanN4KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhzIHRleHQtemluYy01MDAgdXBwZXJjYXNlIGZvbnQtYm9sZCIsIGNoaWxkcmVuOiAiQ3VzdG9tOiIgfSksIF9qc3goImlucHV0IiwgeyB0eXBlOiAibnVtYmVyIiwgdmFsdWU6IGN1c3RvbVZhbHVlLCBzdGVwOiAiMC4xIiwgb25DaGFuZ2U6IChlKSA9PiBzZXRDdXN0b21WYWx1ZShlLnRhcmdldC52YWx1ZSksIGNsYXNzTmFtZTogImJnLXppbmMtOTUwIGJvcmRlciBib3JkZXItemluYy03MDAgcm91bmRlZCBweC0yIHB5LTEgdy0yMCB0ZXh0LWNlbnRlciBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1jeWFuLTUwMCBvdXRsaW5lLW5vbmUiIH0pLCBfanN4KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXppbmMtNTAwIiwgY2hpbGRyZW46ICJ4IiB9KSwgX2pzeChCdXR0b24sIHsgdmFyaWFudDogInByaW1hcnkiLCBsYWJlbDogIkFwcGx5Iiwgb25DbGljazogKCkgPT4gaGFuZGxlQXBwbHlTcGVlZChwYXJzZUZsb2F0KGN1c3RvbVZhbHVlKSB8fCAxLjApLCBjbGFzc05hbWU6ICJweS0xIHB4LTMgdGV4dC1zbSBoLTggbWwtYXV0byIgfSldIH0pXSB9KSB9KSk7CiAgICB9CiAgICByZXR1cm4gKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZml4ZWQgaW5zZXQtMCB6LTUwIGZsZXggaXRlbXMtZW5kIHNtOml0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBiZy1ibGFjay84MCBiYWNrZHJvcC1ibHVyLXNtIHAtNCBhbmltYXRlLWluIGZhZGUtaW4gZHVyYXRpb24tMjAwIiwgY2hpbGRyZW46IF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImJnLXppbmMtOTAwIGJvcmRlciBib3JkZXItemluYy04MDAgcm91bmRlZC0yeGwgdy1mdWxsIG1heC13LXNtIHAtNiBzaGFkb3ctMnhsIHNwYWNlLXktNCBtYi00IHNtOm1iLTAiLCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciIsIGNoaWxkcmVuOiBbX2pzeCgiaDIiLCB7IGNsYXNzTmFtZTogInRleHQteGwgZm9udC1ib2xkIHRleHQtd2hpdGUiLCBjaGlsZHJlbjogIkNyZWF0aXZlIEVmZmVjdHMiIH0pLCBfanN4KCJidXR0b24iLCB7IG9uQ2xpY2s6IG9uQ2xvc2UsIGNsYXNzTmFtZTogInRleHQtemluYy01MDAgaG92ZXI6dGV4dC13aGl0ZSIsIGNoaWxkcmVuOiAiXHUyNzE1IiB9KV0gfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZ3JpZCBncmlkLWNvbHMtMiBnYXAtMyIsIGNoaWxkcmVuOiBlZmZlY3RzLm1hcCgoZngpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNBY3RpdmUgPSBjaGVja0FjdGl2ZShmeC5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoX2pzeHMoImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gaGFuZGxlRWZmZWN0Q2xpY2soZngpLCBjbGFzc05hbWU6IGBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiBwLTQgcm91bmRlZC14bCB0cmFuc2l0aW9uIGJvcmRlciBncm91cCAke2lzQWN0aXZlID8gJ2JnLWN5YW4tOTAwLzMwIGJvcmRlci1jeWFuLTUwMC81MCBzaGFkb3ctWzBfMF8xNXB4X3JnYmEoNiwxODIsMjEyLDAuMTUpXScgOiAnYmctemluYy04MDAvNTAgaG92ZXI6YmctemluYy03MDAgYm9yZGVyLXRyYW5zcGFyZW50IGhvdmVyOmJvcmRlci1jeWFuLTUwMC8zMCd9YCwgY2hpbGRyZW46IFtfanN4KCJzcGFuIiwgeyBjbGFzc05hbWU6IGB0ZXh0LTJ4bCB0cmFuc2l0aW9uICR7aXNBY3RpdmUgPyAndGV4dC1jeWFuLTQwMCcgOiAndGV4dC16aW5jLTQwMCBncm91cC1ob3Zlcjp0ZXh0LXppbmMtMjAwIGdyb3VwLWhvdmVyOnNjYWxlLTExMCd9YCwgY2hpbGRyZW46IGZ4Lmljb24gfSksIF9qc3goInNwYW4iLCB7IGNsYXNzTmFtZTogYHRleHQtc20gZm9udC1tZWRpdW0gJHtpc0FjdGl2ZSA/ICd0ZXh0LWN5YW4tNDAwIGZvbnQtYm9sZCcgOiAndGV4dC16aW5jLTMwMCBncm91cC1ob3Zlcjp0ZXh0LWN5YW4tNDAwJ31gLCBjaGlsZHJlbjogZngubGFiZWwgfSldIH0sIGZ4LmlkKSk7CiAgICAgICAgICAgICAgICAgICAgfSkgfSldIH0pIH0pKTsKfTsKZXhwb3J0IGRlZmF1bHQgRWZmZWN0c01vZGFsOwo=","@/components/ExportModal":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IEJ1dHRvbiBmcm9tICdAL2NvbXBvbmVudHMvQnV0dG9uJzsKY29uc3QgRXhwb3J0TW9kYWwgPSAoeyBpc09wZW4sIG9uQ2xvc2UsIG9uRXhwb3J0LCBvcmlnaW5hbFNhbXBsZVJhdGUgfSkgPT4gewogICAgY29uc3QgW2Zvcm1hdCwgc2V0Rm9ybWF0XSA9IHVzZVN0YXRlKCd3YXYnKTsKICAgIGlmICghaXNPcGVuKQogICAgICAgIHJldHVybiBudWxsOwogICAgcmV0dXJuIChfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogImZpeGVkIGluc2V0LTAgei01MCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBiZy1ibGFjay84MCBiYWNrZHJvcC1ibHVyLXNtIHAtNCIsIGNoaWxkcmVuOiBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJiZy16aW5jLTkwMCBib3JkZXIgYm9yZGVyLXppbmMtODAwIHJvdW5kZWQtMnhsIHctZnVsbCBtYXgtdy1zbSBwLTYgc2hhZG93LTJ4bCBzcGFjZS15LTYiLCBjaGlsZHJlbjogW19qc3hzKCJkaXYiLCB7IGNoaWxkcmVuOiBbX2pzeCgiaDIiLCB7IGNsYXNzTmFtZTogInRleHQteGwgZm9udC1ib2xkIHRleHQtd2hpdGUiLCBjaGlsZHJlbjogIkV4cG9ydCBTZXR0aW5ncyIgfSksIF9qc3goInAiLCB7IGNsYXNzTmFtZTogInRleHQtemluYy00MDAgdGV4dC1zbSIsIGNoaWxkcmVuOiAiQ2hvb3NlIHRoZSBmb3JtYXQgYW5kIHF1YWxpdHkuIiB9KV0gfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImJnLXppbmMtOTUwIHAtMSByb3VuZGVkLXhsIGZsZXggYm9yZGVyIGJvcmRlci16aW5jLTgwMCIsIGNoaWxkcmVuOiBbX2pzeCgiYnV0dG9uIiwgeyBvbkNsaWNrOiAoKSA9PiBzZXRGb3JtYXQoJ3dhdicpLCBjbGFzc05hbWU6IGBmbGV4LTEgcHktMiB0ZXh0LXNtIGZvbnQtYm9sZCByb3VuZGVkLWxnIHRyYW5zaXRpb24tYWxsICR7Zm9ybWF0ID09PSAnd2F2JyA/ICdiZy16aW5jLTgwMCB0ZXh0LWN5YW4tNDAwIHNoYWRvdy1zbScgOiAndGV4dC16aW5jLTUwMCBob3Zlcjp0ZXh0LXppbmMtMzAwJ31gLCBjaGlsZHJlbjogIldBViIgfSksIF9qc3goImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gc2V0Rm9ybWF0KCdtcDMnKSwgY2xhc3NOYW1lOiBgZmxleC0xIHB5LTIgdGV4dC1zbSBmb250LWJvbGQgcm91bmRlZC1sZyB0cmFuc2l0aW9uLWFsbCAke2Zvcm1hdCA9PT0gJ21wMycgPyAnYmctemluYy04MDAgdGV4dC1jeWFuLTQwMCBzaGFkb3ctc20nIDogJ3RleHQtemluYy01MDAgaG92ZXI6dGV4dC16aW5jLTMwMCd9YCwgY2hpbGRyZW46ICJNUDMiIH0pXSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAic3BhY2UteS0yIiwgY2hpbGRyZW46IFtfanN4cyhCdXR0b24sIHsgdmFyaWFudDogInNlY29uZGFyeSIsIGZ1bGxXaWR0aDogdHJ1ZSwgb25DbGljazogKCkgPT4geyBvbkV4cG9ydChvcmlnaW5hbFNhbXBsZVJhdGUsIGZvcm1hdCk7IG9uQ2xvc2UoKTsgfSwgY2xhc3NOYW1lOiAianVzdGlmeS1iZXR3ZWVuIGdyb3VwIiwgY2hpbGRyZW46IFtfanN4KCJzcGFuIiwgeyBjaGlsZHJlbjogIk9yaWdpbmFsIFF1YWxpdHkiIH0pLCBfanN4cygic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC14cyB0ZXh0LXppbmMtNTAwIGJnLXppbmMtOTUwIHB4LTIgcHktMSByb3VuZGVkIGdyb3VwLWhvdmVyOnRleHQtd2hpdGUgdHJhbnNpdGlvbi1jb2xvcnMiLCBjaGlsZHJlbjogW29yaWdpbmFsU2FtcGxlUmF0ZSwgIkh6Il0gfSldIH0pLCBfanN4cyhCdXR0b24sIHsgdmFyaWFudDogInNlY29uZGFyeSIsIGZ1bGxXaWR0aDogdHJ1ZSwgb25DbGljazogKCkgPT4geyBvbkV4cG9ydCg0NDEwMCwgZm9ybWF0KTsgb25DbG9zZSgpOyB9LCBjbGFzc05hbWU6ICJqdXN0aWZ5LWJldHdlZW4gZ3JvdXAiLCBjaGlsZHJlbjogW19qc3goInNwYW4iLCB7IGNoaWxkcmVuOiAiQ0QgUXVhbGl0eSIgfSksIF9qc3goInNwYW4iLCB7IGNsYXNzTmFtZTogInRleHQteHMgdGV4dC16aW5jLTUwMCBiZy16aW5jLTk1MCBweC0yIHB5LTEgcm91bmRlZCBncm91cC1ob3Zlcjp0ZXh0LXdoaXRlIHRyYW5zaXRpb24tY29sb3JzIiwgY2hpbGRyZW46ICI0NC4xa0h6IiB9KV0gfSksIF9qc3hzKEJ1dHRvbiwgeyB2YXJpYW50OiAic2Vjb25kYXJ5IiwgZnVsbFdpZHRoOiB0cnVlLCBvbkNsaWNrOiAoKSA9PiB7IG9uRXhwb3J0KDIyMDUwLCBmb3JtYXQpOyBvbkNsb3NlKCk7IH0sIGNsYXNzTmFtZTogImp1c3RpZnktYmV0d2VlbiBncm91cCIsIGNoaWxkcmVuOiBbX2pzeCgic3BhbiIsIHsgY2hpbGRyZW46ICJMby1GaSAvIFJhZGlvIiB9KSwgX2pzeCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC14cyB0ZXh0LXppbmMtNTAwIGJnLXppbmMtOTUwIHB4LTIgcHktMSByb3VuZGVkIGdyb3VwLWhvdmVyOnRleHQtd2hpdGUgdHJhbnNpdGlvbi1jb2xvcnMiLCBjaGlsZHJlbjogIjIya0h6IiB9KV0gfSldIH0pLCBfanN4KCJkaXYiLCB7IGNsYXNzTmFtZTogInB0LTIiLCBjaGlsZHJlbjogX2pzeChCdXR0b24sIHsgdmFyaWFudDogImdob3N0IiwgZnVsbFdpZHRoOiB0cnVlLCBvbkNsaWNrOiBvbkNsb3NlLCBjaGlsZHJlbjogIkNhbmNlbCIgfSkgfSldIH0pIH0pKTsKfTsKZXhwb3J0IGRlZmF1bHQgRXhwb3J0TW9kYWw7Cg==","@/components/BeatMakerModal":"data:application/javascript;base64,aW1wb3J0IHsganN4IGFzIF9qc3gsIGpzeHMgYXMgX2pzeHMgfSBmcm9tICJyZWFjdC9qc3gtcnVudGltZSI7CmltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnOwppbXBvcnQgQnV0dG9uIGZyb20gJ0AvY29tcG9uZW50cy9CdXR0b24nOwppbXBvcnQgeyBnZW5lcmF0ZURydW1CZWF0IH0gZnJvbSAnQC9zZXJ2aWNlcy9hdWRpb1V0aWxzJzsKY29uc3QgRHJ1bUljb24gPSAoKSA9PiAoX2pzeCgic3ZnIiwgeyBjbGFzc05hbWU6ICJ3LTYgaC02IHRleHQtemluYy0xMDAiLCBmaWxsOiAibm9uZSIsIHN0cm9rZTogImN1cnJlbnRDb2xvciIsIHN0cm9rZVdpZHRoOiAiMiIsIHZpZXdCb3g6ICIwIDAgMjQgMjQiLCBjaGlsZHJlbjogX2pzeCgicGF0aCIsIHsgc3Ryb2tlTGluZWNhcDogInJvdW5kIiwgc3Ryb2tlTGluZWpvaW46ICJyb3VuZCIsIGQ6ICJNNSAyMGgxNGEyIDIgMCAwMTIgMnYxSDN2LTFhMiAyIDAgMDEyLTJ6bTAtNmgxNGwxLjUgNUgzLjVMNSAxNHptMC05YTMgMyAwIDAxNiAwdjJINVY1em04IDBhMyAzIDAgMDE2IDB2MmgtNlY1eiIgfSkgfSkpOwpjb25zdCBCZWF0TWFrZXJNb2RhbCA9ICh7IGlzT3Blbiwgb25DbG9zZSwgb25HZW5lcmF0ZSB9KSA9PiB7CiAgICBjb25zdCBbYnBtLCBzZXRCcG1dID0gdXNlU3RhdGUoMTIwKTsKICAgIGNvbnN0IFtzdHlsZSwgc2V0U3R5bGVdID0gdXNlU3RhdGUoJ1JvY2snKTsKICAgIGNvbnN0IFtiYXJzLCBzZXRCYXJzXSA9IHVzZVN0YXRlKDQpOwogICAgY29uc3QgW2lzR2VuZXJhdGluZywgc2V0SXNHZW5lcmF0aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTsKICAgIC8vIENhbGN1bGF0ZSBkeW5hbWljIGNvbnN0cmFpbnRzIGJhc2VkIG9uIDYwIHNlY29uZCBsaW1pdAogICAgLy8gRHVyYXRpb24gPSBCYXJzICogNCAqICg2MCAvIEJQTSkKICAgIC8vIE1heEJhcnMgPSA2MCAvICg0ICogKDYwIC8gQlBNKSkgPSBCUE0gLyA0CiAgICBjb25zdCBtYXhCYXJzID0gTWF0aC5mbG9vcihicG0gLyA0KTsKICAgIC8vIEN1cnJlbnQgZHVyYXRpb24gaW4gc2Vjb25kcwogICAgY29uc3QgY3VycmVudER1cmF0aW9uID0gYmFycyAqIDQgKiAoNjAgLyBicG0pOwogICAgLy8gRW5mb3JjZSBtYXggYmFycyBpZiBCUE0gY2hhbmdlcyBzdWNoIHRoYXQgY3VycmVudCBiYXJzIGV4Y2VlZHMgbGltaXQKICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgaWYgKGJhcnMgPiBtYXhCYXJzKSB7CiAgICAgICAgICAgIHNldEJhcnMobWF4QmFycyk7CiAgICAgICAgfQogICAgfSwgW2JwbSwgbWF4QmFycywgYmFyc10pOwogICAgaWYgKCFpc09wZW4pCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICBjb25zdCBzdHlsZXMgPSBbJ1JvY2snLCAnSGlwSG9wJywgJ1RlY2hubycsICdNZXRyb25vbWUnXTsKICAgIGNvbnN0IGhhbmRsZUdlbmVyYXRlID0gYXN5bmMgKCkgPT4gewogICAgICAgIHNldElzR2VuZXJhdGluZyh0cnVlKTsKICAgICAgICAvLyBTaG9ydCBkZWxheSB0byBhbGxvdyBVSSB0byB1cGRhdGUKICAgICAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IGdlbmVyYXRlRHJ1bUJlYXQoc3R5bGUsIGJwbSwgYmFycyk7CiAgICAgICAgICAgICAgICBvbkdlbmVyYXRlKGJ1ZmZlciwgYCR7c3R5bGV9IEJlYXQgKCR7YnBtfSBCUE0pYCk7CiAgICAgICAgICAgICAgICBvbkNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgICAgICBzZXRJc0dlbmVyYXRpbmcoZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgMTAwKTsKICAgIH07CiAgICByZXR1cm4gKF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZml4ZWQgaW5zZXQtMCB6LTUwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHAtNCBiZy1ibGFjay84MCBiYWNrZHJvcC1ibHVyLXNtIiwgY2hpbGRyZW46IF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogImJnLXppbmMtOTAwIGJvcmRlciBib3JkZXItemluYy03MDAgcm91bmRlZC0yeGwgdy1mdWxsIG1heC13LW1kIHAtNiBzaGFkb3ctMnhsIHNwYWNlLXktNiIsIGNoaWxkcmVuOiBbX2pzeHMoImgyIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIGZsZXggaXRlbXMtY2VudGVyIGdhcC0zIiwgY2hpbGRyZW46IFtfanN4KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJwLTIgYmctemluYy04MDAgcm91bmRlZC1sZyIsIGNoaWxkcmVuOiBfanN4KERydW1JY29uLCB7fSkgfSksICJCZWF0IE1ha2VyIl0gfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogInNwYWNlLXktNCIsIGNoaWxkcmVuOiBbX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAic3BhY2UteS0yIiwgY2hpbGRyZW46IFtfanN4KCJsYWJlbCIsIHsgY2xhc3NOYW1lOiAidGV4dC14cyBmb250LXNlbWlib2xkIHRleHQtemluYy01MDAgdXBwZXJjYXNlIiwgY2hpbGRyZW46ICJTdHlsZSIgfSksIF9qc3goImRpdiIsIHsgY2xhc3NOYW1lOiAiZ3JpZCBncmlkLWNvbHMtMiBnYXAtMiIsIGNoaWxkcmVuOiBzdHlsZXMubWFwKHMgPT4gKF9qc3goImJ1dHRvbiIsIHsgb25DbGljazogKCkgPT4gc2V0U3R5bGUocyksIGNsYXNzTmFtZTogYHAtMyByb3VuZGVkLWxnIHRleHQtc20gZm9udC1tZWRpdW0gdHJhbnNpdGlvbiAke3N0eWxlID09PSBzID8gJ2JnLWN5YW4tNjAwIHRleHQtd2hpdGUgc2hhZG93LWxnIHNoYWRvdy1jeWFuLTUwMC8yMCcgOiAnYmctemluYy04MDAgdGV4dC16aW5jLTQwMCBob3ZlcjpiZy16aW5jLTcwMCd9YCwgY2hpbGRyZW46IHMgfSwgcykpKSB9KV0gfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogInNwYWNlLXktMiIsIGNoaWxkcmVuOiBbX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBqdXN0aWZ5LWJldHdlZW4iLCBjaGlsZHJlbjogW19qc3goImxhYmVsIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgdGV4dC16aW5jLTUwMCB1cHBlcmNhc2UiLCBjaGlsZHJlbjogIlRlbXBvIiB9KSwgX2pzeHMoInNwYW4iLCB7IGNsYXNzTmFtZTogInRleHQteHMgZm9udC1ib2xkIHRleHQtY3lhbi00MDAiLCBjaGlsZHJlbjogW2JwbSwgIiBCUE0iXSB9KV0gfSksIF9qc3goImlucHV0IiwgeyB0eXBlOiAicmFuZ2UiLCBtaW46ICI2MCIsIG1heDogIjIwMCIsIHZhbHVlOiBicG0sIG9uQ2hhbmdlOiAoZSkgPT4gc2V0QnBtKHBhcnNlSW50KGUudGFyZ2V0LnZhbHVlKSksIGNsYXNzTmFtZTogInctZnVsbCBhY2NlbnQtY3lhbi01MDAgaC0yIGJnLXppbmMtODAwIHJvdW5kZWQtbGcgYXBwZWFyYW5jZS1ub25lIGN1cnNvci1wb2ludGVyIiB9KV0gfSksIF9qc3hzKCJkaXYiLCB7IGNsYXNzTmFtZTogInNwYWNlLXktMiIsIGNoaWxkcmVuOiBbX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIiwgY2hpbGRyZW46IFtfanN4KCJsYWJlbCIsIHsgY2xhc3NOYW1lOiAidGV4dC14cyBmb250LXNlbWlib2xkIHRleHQtemluYy01MDAgdXBwZXJjYXNlIiwgY2hpbGRyZW46ICJMZW5ndGgiIH0pLCBfanN4cygiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0LXJpZ2h0IiwgY2hpbGRyZW46IFtfanN4cygic3BhbiIsIHsgY2xhc3NOYW1lOiAidGV4dC14cyBmb250LWJvbGQgdGV4dC1jeWFuLTQwMCIsIGNoaWxkcmVuOiBbYmFycywgIiBCYXJzIl0gfSksIF9qc3hzKCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0ZXh0LVsxMHB4XSB0ZXh0LXppbmMtNTAwIGZvbnQtbWVkaXVtIG1sLTIiLCBjaGlsZHJlbjogWyIoIiwgY3VycmVudER1cmF0aW9uLnRvRml4ZWQoMSksICJzKSJdIH0pXSB9KV0gfSksIF9qc3goImlucHV0IiwgeyB0eXBlOiAicmFuZ2UiLCBtaW46ICIxIiwgbWF4OiBtYXhCYXJzLCB2YWx1ZTogYmFycywgb25DaGFuZ2U6IChlKSA9PiBzZXRCYXJzKHBhcnNlSW50KGUudGFyZ2V0LnZhbHVlKSksIGNsYXNzTmFtZTogInctZnVsbCBhY2NlbnQtY3lhbi01MDAgaC0yIGJnLXppbmMtODAwIHJvdW5kZWQtbGcgYXBwZWFyYW5jZS1ub25lIGN1cnNvci1wb2ludGVyIiB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBqdXN0aWZ5LWJldHdlZW4gdGV4dC1bMTBweF0gdGV4dC16aW5jLTYwMCBweC0xIiwgY2hpbGRyZW46IFtfanN4KCJzcGFuIiwgeyBjaGlsZHJlbjogIjEgQmFyIiB9KSwgX2pzeHMoInNwYW4iLCB7IGNoaWxkcmVuOiBbIk1heCAoIiwgbWF4QmFycywgIikiXSB9KV0gfSldIH0pXSB9KSwgX2pzeHMoImRpdiIsIHsgY2xhc3NOYW1lOiAiZmxleCBnYXAtMyBwdC00IGJvcmRlci10IGJvcmRlci16aW5jLTgwMCIsIGNoaWxkcmVuOiBbX2pzeChCdXR0b24sIHsgdmFyaWFudDogImdob3N0Iiwgb25DbGljazogb25DbG9zZSwgbGFiZWw6ICJDYW5jZWwiIH0pLCBfanN4KEJ1dHRvbiwgeyB2YXJpYW50OiAicHJpbWFyeSIsIG9uQ2xpY2s6IGhhbmRsZUdlbmVyYXRlLCBkaXNhYmxlZDogaXNHZW5lcmF0aW5nLCBsYWJlbDogaXNHZW5lcmF0aW5nID8gIlN5bnRoZXNpemluZy4uLiIgOiAiQWRkIEJlYXQiLCBjbGFzc05hbWU6ICJmbGV4LTEiIH0pXSB9KV0gfSkgfSkpOwp9OwpleHBvcnQgZGVmYXVsdCBCZWF0TWFrZXJNb2RhbDsK","@/services/storageService":"data:application/javascript;base64,aW1wb3J0IHsgZW5jb2RlV0FWQnVmZmVyLCBkZWNvZGVBdWRpb0RhdGEsIGdldEF1ZGlvQ29udGV4dCwgY3JlYXRlRW1wdHlCdWZmZXIgfSBmcm9tICdAL3NlcnZpY2VzL2F1ZGlvVXRpbHMnOwpjb25zdCBEQl9OQU1FID0gJ1NvbmljUG9ja2V0REInOwpjb25zdCBEQl9WRVJTSU9OID0gMTsKY29uc3QgU1RPUkVfTkFNRSA9ICdwcm9qZWN0cyc7CmNvbnN0IG9wZW5EQiA9ICgpID0+IHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKERCX05BTUUsIERCX1ZFUlNJT04pOwogICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGRiID0gZXZlbnQudGFyZ2V0LnJlc3VsdDsKICAgICAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKFNUT1JFX05BTUUpKSB7CiAgICAgICAgICAgICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZShTVE9SRV9OQU1FLCB7IGtleVBhdGg6ICdpZCcgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIHJlc29sdmUoZXZlbnQudGFyZ2V0LnJlc3VsdCk7CiAgICAgICAgfTsKICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoZXZlbnQpID0+IHsKICAgICAgICAgICAgcmVqZWN0KCdJbmRleGVkREIgZXJyb3I6ICcgKyBldmVudC50YXJnZXQuZXJyb3IpOwogICAgICAgIH07CiAgICB9KTsKfTsKLy8gSGVscGVyIHRvIGNvbnZlcnQgVHJhY2sgdG8gU2F2ZWRUcmFjayAoaGFuZGxpbmcgcmVjdXJzaW9uIGZvciBjcm9zc2ZhZGUgbWV0YWRhdGEpCmNvbnN0IGNvbnZlcnRUcmFja1RvU2F2ZWQgPSAodCkgPT4gewogICAgY29uc3Qgc2F2ZWQgPSB7CiAgICAgICAgaWQ6IHQuaWQsCiAgICAgICAgbmFtZTogdC5uYW1lLAogICAgICAgIGRhdGE6IGVuY29kZVdBVkJ1ZmZlcih0LmJ1ZmZlciksCiAgICAgICAgLy8gT25seSBzYXZlIG9yaWdpbmFsIGlmIGl0IGRpZmZlcnMgYW5kIGV4aXN0cywgdG8gc2F2ZSBzcGFjZQogICAgICAgIG9yaWdpbmFsRGF0YTogdC5vcmlnaW5hbEJ1ZmZlciA/IGVuY29kZVdBVkJ1ZmZlcih0Lm9yaWdpbmFsQnVmZmVyKSA6IHVuZGVmaW5lZCwKICAgICAgICBzdGFydFRpbWU6IHQuc3RhcnRUaW1lLAogICAgICAgIHRyaW1TdGFydDogdC50cmltU3RhcnQsCiAgICAgICAgZHVyYXRpb246IHQuZHVyYXRpb24sCiAgICAgICAgbGFuZTogdC5sYW5lLAogICAgICAgIHZvbHVtZTogdC52b2x1bWUsCiAgICAgICAgaXNNdXRlZDogdC5pc011dGVkLAogICAgICAgIGlzU29sbzogdC5pc1NvbG8sCiAgICAgICAgY29sb3I6IHQuY29sb3IsCiAgICAgICAgYnBtOiB0LmJwbSwKICAgICAgICBhY3RpdmVFZmZlY3RzOiB0LmFjdGl2ZUVmZmVjdHMKICAgIH07CiAgICBpZiAodC5jcm9zc2ZhZGVNZXRhZGF0YSkgewogICAgICAgIHNhdmVkLmNyb3NzZmFkZU1ldGFkYXRhID0gewogICAgICAgICAgICBsZWZ0OiBjb252ZXJ0VHJhY2tUb1NhdmVkKHQuY3Jvc3NmYWRlTWV0YWRhdGEubGVmdCksCiAgICAgICAgICAgIHJpZ2h0OiBjb252ZXJ0VHJhY2tUb1NhdmVkKHQuY3Jvc3NmYWRlTWV0YWRhdGEucmlnaHQpLAogICAgICAgICAgICBkdXJhdGlvbjogdC5jcm9zc2ZhZGVNZXRhZGF0YS5kdXJhdGlvbgogICAgICAgIH07CiAgICB9CiAgICByZXR1cm4gc2F2ZWQ7Cn07Ci8vIEhlbHBlciB0byBsb2FkIFNhdmVkVHJhY2sgdG8gVHJhY2sgKGhhbmRsaW5nIHJlY3Vyc2lvbikKY29uc3QgY29udmVydFNhdmVkVG9UcmFjayA9IGFzeW5jIChzdCwgY3R4KSA9PiB7CiAgICB0cnkgewogICAgICAgIGxldCBhdWRpb0J1ZmZlciA9IG51bGw7CiAgICAgICAgbGV0IG9yaWdpbmFsQnVmZmVyID0gdW5kZWZpbmVkOwogICAgICAgIC8vIDEuIExvYWQgTWFpbiBBdWRpbwogICAgICAgIGlmIChzdC5kYXRhICYmIHN0LmRhdGEuYnl0ZUxlbmd0aCA+IDApIHsKICAgICAgICAgICAgYXVkaW9CdWZmZXIgPSBhd2FpdCBkZWNvZGVBdWRpb0RhdGEoc3QuZGF0YSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHN0LmJsb2IpIHsKICAgICAgICAgICAgY29uc3QgYWIgPSBhd2FpdCBzdC5ibG9iLmFycmF5QnVmZmVyKCk7CiAgICAgICAgICAgIGlmIChhYi5ieXRlTGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIGF1ZGlvQnVmZmVyID0gYXdhaXQgZGVjb2RlQXVkaW9EYXRhKGFiKTsKICAgICAgICB9CiAgICAgICAgLy8gMi4gTG9hZCBPcmlnaW5hbCBBdWRpbyAoaWYgZXhpc3RzKQogICAgICAgIGlmIChzdC5vcmlnaW5hbERhdGEgJiYgc3Qub3JpZ2luYWxEYXRhLmJ5dGVMZW5ndGggPiAwKSB7CiAgICAgICAgICAgIG9yaWdpbmFsQnVmZmVyID0gYXdhaXQgZGVjb2RlQXVkaW9EYXRhKHN0Lm9yaWdpbmFsRGF0YSk7CiAgICAgICAgfQogICAgICAgIGlmICghYXVkaW9CdWZmZXIpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGNvbnN0IHRyYWNrID0gewogICAgICAgICAgICBpZDogc3QuaWQsCiAgICAgICAgICAgIG5hbWU6IHN0Lm5hbWUsCiAgICAgICAgICAgIGJ1ZmZlcjogYXVkaW9CdWZmZXIsCiAgICAgICAgICAgIG9yaWdpbmFsQnVmZmVyOiBvcmlnaW5hbEJ1ZmZlciwKICAgICAgICAgICAgc3RhcnRUaW1lOiBzdC5zdGFydFRpbWUsCiAgICAgICAgICAgIHRyaW1TdGFydDogc3QudHJpbVN0YXJ0ID8/IDAsCiAgICAgICAgICAgIGR1cmF0aW9uOiBzdC5kdXJhdGlvbiA/PyBhdWRpb0J1ZmZlci5kdXJhdGlvbiwKICAgICAgICAgICAgbGFuZTogc3QubGFuZSwKICAgICAgICAgICAgdm9sdW1lOiBzdC52b2x1bWUsCiAgICAgICAgICAgIGlzTXV0ZWQ6IHN0LmlzTXV0ZWQsCiAgICAgICAgICAgIGlzU29sbzogc3QuaXNTb2xvLAogICAgICAgICAgICBjb2xvcjogc3QuY29sb3IsCiAgICAgICAgICAgIGJwbTogc3QuYnBtLAogICAgICAgICAgICBhY3RpdmVFZmZlY3RzOiBzdC5hY3RpdmVFZmZlY3RzCiAgICAgICAgfTsKICAgICAgICAvLyAzLiBMb2FkIENyb3NzZmFkZSBNZXRhZGF0YQogICAgICAgIGlmIChzdC5jcm9zc2ZhZGVNZXRhZGF0YSkgewogICAgICAgICAgICBjb25zdCBsZWZ0ID0gYXdhaXQgY29udmVydFNhdmVkVG9UcmFjayhzdC5jcm9zc2ZhZGVNZXRhZGF0YS5sZWZ0LCBjdHgpOwogICAgICAgICAgICBjb25zdCByaWdodCA9IGF3YWl0IGNvbnZlcnRTYXZlZFRvVHJhY2soc3QuY3Jvc3NmYWRlTWV0YWRhdGEucmlnaHQsIGN0eCk7CiAgICAgICAgICAgIGlmIChsZWZ0ICYmIHJpZ2h0KSB7CiAgICAgICAgICAgICAgICB0cmFjay5jcm9zc2ZhZGVNZXRhZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBsZWZ0LAogICAgICAgICAgICAgICAgICAgIHJpZ2h0LAogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBzdC5jcm9zc2ZhZGVNZXRhZGF0YS5kdXJhdGlvbgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJhY2s7CiAgICB9CiAgICBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGNvbnZlcnRpbmcgc2F2ZWQgdHJhY2s6IiwgZSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cn07CmV4cG9ydCBjb25zdCBzYXZlUHJvamVjdCA9IGFzeW5jIChpZCwgbmFtZSwgdHJhY2tzLCB0aHVtYm5haWwgPSAnJykgPT4gewogICAgY29uc3QgZGIgPSBhd2FpdCBvcGVuREIoKTsKICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpOwogICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShTVE9SRV9OQU1FKTsKICAgIC8vIE9wdGltaXplZCBTYXZpbmc6IFNlcXVlbnRpYWwgcHJvY2Vzc2luZwogICAgY29uc3Qgc2F2ZWRUcmFja3MgPSBbXTsKICAgIGZvciAoY29uc3QgdCBvZiB0cmFja3MpIHsKICAgICAgICBjb25zdCBzdCA9IGNvbnZlcnRUcmFja1RvU2F2ZWQodCk7CiAgICAgICAgc2F2ZWRUcmFja3MucHVzaChzdCk7CiAgICB9CiAgICBjb25zdCBwcm9qZWN0ID0gewogICAgICAgIGlkLAogICAgICAgIG5hbWUsCiAgICAgICAgbGFzdE1vZGlmaWVkOiBEYXRlLm5vdygpLAogICAgICAgIHRyYWNrczogc2F2ZWRUcmFja3MsCiAgICAgICAgdGh1bWJuYWlsCiAgICB9OwogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBjb25zdCByZXF1ZXN0ID0gc3RvcmUucHV0KHByb2plY3QpOwogICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4gcmVzb2x2ZSgpOwogICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHJlamVjdChyZXF1ZXN0LmVycm9yKTsKICAgIH0pOwp9OwpleHBvcnQgY29uc3QgbG9hZFByb2plY3RzID0gYXN5bmMgKCkgPT4gewogICAgY29uc3QgZGIgPSBhd2FpdCBvcGVuREIoKTsKICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSwgJ3JlYWRvbmx5Jyk7CiAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFNUT1JFX05BTUUpOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBjb25zdCByZXF1ZXN0ID0gc3RvcmUuZ2V0QWxsKCk7CiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHByb2plY3RzID0gcmVxdWVzdC5yZXN1bHQ7CiAgICAgICAgICAgIHByb2plY3RzLnNvcnQoKGEsIGIpID0+IGIubGFzdE1vZGlmaWVkIC0gYS5sYXN0TW9kaWZpZWQpOwogICAgICAgICAgICByZXNvbHZlKHByb2plY3RzKTsKICAgICAgICB9OwogICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHJlamVjdChyZXF1ZXN0LmVycm9yKTsKICAgIH0pOwp9OwpleHBvcnQgY29uc3QgbG9hZFByb2plY3RUcmFja3MgPSBhc3luYyAoc2F2ZWRUcmFja3MpID0+IHsKICAgIGlmICghc2F2ZWRUcmFja3MpCiAgICAgICAgcmV0dXJuIFtdOwogICAgY29uc3QgY3R4ID0gZ2V0QXVkaW9Db250ZXh0KCk7CiAgICBjb25zdCB0cmFja3MgPSBbXTsKICAgIGZvciAoY29uc3Qgc3Qgb2Ygc2F2ZWRUcmFja3MpIHsKICAgICAgICBpZiAoIXN0KQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICBjb25zdCBsb2FkZWRUcmFjayA9IGF3YWl0IGNvbnZlcnRTYXZlZFRvVHJhY2soc3QsIGN0eCk7CiAgICAgICAgaWYgKGxvYWRlZFRyYWNrKSB7CiAgICAgICAgICAgIHRyYWNrcy5wdXNoKGxvYWRlZFRyYWNrKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIEVycm9yL1BsYWNlaG9sZGVyIGxvZ2ljCiAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrRHVyYXRpb24gPSBzdC5kdXJhdGlvbiB8fCA1LjA7CiAgICAgICAgICAgIGNvbnN0IGVycm9yQnVmZmVyID0gY3JlYXRlRW1wdHlCdWZmZXIoY3R4LCBmYWxsYmFja0R1cmF0aW9uKTsKICAgICAgICAgICAgdHJhY2tzLnB1c2goewogICAgICAgICAgICAgICAgaWQ6IHN0LmlkLAogICAgICAgICAgICAgICAgbmFtZTogYOKaoO+4jyBNaXNzaW5nIERhdGE6ICR7c3QubmFtZX1gLAogICAgICAgICAgICAgICAgYnVmZmVyOiBlcnJvckJ1ZmZlciwKICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogc3Quc3RhcnRUaW1lLAogICAgICAgICAgICAgICAgdHJpbVN0YXJ0OiAwLAogICAgICAgICAgICAgICAgZHVyYXRpb246IGZhbGxiYWNrRHVyYXRpb24sCiAgICAgICAgICAgICAgICBsYW5lOiBzdC5sYW5lLAogICAgICAgICAgICAgICAgdm9sdW1lOiBzdC52b2x1bWUsCiAgICAgICAgICAgICAgICBpc011dGVkOiB0cnVlLAogICAgICAgICAgICAgICAgaXNTb2xvOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNvbG9yOiAnI2VmNDQ0NCcKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHRyYWNrczsKfTsKZXhwb3J0IGNvbnN0IGRlbGV0ZVByb2plY3QgPSBhc3luYyAoaWQpID0+IHsKICAgIGNvbnN0IGRiID0gYXdhaXQgb3BlbkRCKCk7CiAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFNUT1JFX05BTUUsICdyZWFkd3JpdGUnKTsKICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSk7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5kZWxldGUoaWQpOwogICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4gcmVzb2x2ZSgpOwogICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHJlamVjdChyZXF1ZXN0LmVycm9yKTsKICAgIH0pOwp9OwpleHBvcnQgY29uc3QgdXBkYXRlUHJvamVjdE5hbWUgPSBhc3luYyAoaWQsIG5ld05hbWUpID0+IHsKICAgIGNvbnN0IGRiID0gYXdhaXQgb3BlbkRCKCk7CiAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFNUT1JFX05BTUUsICdyZWFkd3JpdGUnKTsKICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSk7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIGNvbnN0IGdldFJlcXVlc3QgPSBzdG9yZS5nZXQoaWQpOwogICAgICAgIGdldFJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4gewogICAgICAgICAgICBjb25zdCBwcm9qZWN0ID0gZ2V0UmVxdWVzdC5yZXN1bHQ7CiAgICAgICAgICAgIGlmIChwcm9qZWN0KSB7CiAgICAgICAgICAgICAgICBwcm9qZWN0Lm5hbWUgPSBuZXdOYW1lOwogICAgICAgICAgICAgICAgc3RvcmUucHV0KHByb2plY3QpLm9uc3VjY2VzcyA9ICgpID0+IHJlc29sdmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJlamVjdCgiUHJvamVjdCBub3QgZm91bmQiKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgZ2V0UmVxdWVzdC5vbmVycm9yID0gKCkgPT4gcmVqZWN0KGdldFJlcXVlc3QuZXJyb3IpOwogICAgfSk7Cn07Cg==","@/sw":"data:application/javascript;base64,CmNvbnN0IENBQ0hFX05BTUUgPSAnc29uaWNwb2NrZXQtdjEnOwpjb25zdCBBU1NFVFNfVE9fQ0FDSEUgPSBbCiAgJy8nLAogICcvaW5kZXguaHRtbCcsCiAgJy9pbmRleC50c3gnLAogICcvQXBwLnRzeCcsCiAgJy90eXBlcy50cycsCiAgJy9jb25zdGFudHMudHMnLAogICcvbWFuaWZlc3QuanNvbicsCiAgJy9zZXJ2aWNlcy9hdWRpb1V0aWxzLnRzJywKICAnL3NlcnZpY2VzL3N0b3JhZ2VTZXJ2aWNlLnRzJywKICAnL3NlcnZpY2VzL2dlbWluaVNlcnZpY2UudHMnLAogICcvY29tcG9uZW50cy9CdXR0b24udHN4JywKICAnL2NvbXBvbmVudHMvV2F2ZWZvcm1EaXNwbGF5LnRzeCcsCiAgJy9jb21wb25lbnRzL0JlYXRNYWtlck1vZGFsLnRzeCcsCiAgJy9jb21wb25lbnRzL0VmZmVjdHNNb2RhbC50c3gnLAogICcvY29tcG9uZW50cy9FeHBvcnRNb2RhbC50c3gnLAogICcvY29tcG9uZW50cy9BSUdlbmVyYXRvck1vZGFsLnRzeCcsCiAgJ2h0dHBzOi8vY2RuLnRhaWx3aW5kY3NzLmNvbScsCiAgJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbGFtZWpzQDEuMi4xL2xhbWUubWluLmpzJwpdOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgKGV2ZW50KSA9PiB7CiAgZXZlbnQud2FpdFVudGlsKAogICAgY2FjaGVzLm9wZW4oQ0FDSEVfTkFNRSkudGhlbigoY2FjaGUpID0+IHsKICAgICAgcmV0dXJuIGNhY2hlLmFkZEFsbChBU1NFVFNfVE9fQ0FDSEUpOwogICAgfSkKICApOwogIHNlbGYuc2tpcFdhaXRpbmcoKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgKGV2ZW50KSA9PiB7CiAgZXZlbnQud2FpdFVudGlsKAogICAgY2FjaGVzLmtleXMoKS50aGVuKChjYWNoZU5hbWVzKSA9PiB7CiAgICAgIHJldHVybiBQcm9taXNlLmFsbCgKICAgICAgICBjYWNoZU5hbWVzLm1hcCgoY2FjaGVOYW1lKSA9PiB7CiAgICAgICAgICBpZiAoY2FjaGVOYW1lICE9PSBDQUNIRV9OQU1FKSB7CiAgICAgICAgICAgIHJldHVybiBjYWNoZXMuZGVsZXRlKGNhY2hlTmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgKTsKICAgIH0pCiAgKTsKICBzZWxmLmNsaWVudHMuY2xhaW0oKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgKGV2ZW50KSA9PiB7CiAgLy8gTmF2aWdhdGlvbiBmYWxsYmFjayB0byBpbmRleC5odG1sIGZvciBTUEEgcm91dGluZyAoaWYgbmVlZGVkKQogIGlmIChldmVudC5yZXF1ZXN0Lm1vZGUgPT09ICduYXZpZ2F0ZScpIHsKICAgIGV2ZW50LnJlc3BvbmRXaXRoKAogICAgICBjYWNoZXMubWF0Y2goJy9pbmRleC5odG1sJykudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCk7CiAgICAgIH0pCiAgICApOwogICAgcmV0dXJuOwogIH0KCiAgZXZlbnQucmVzcG9uZFdpdGgoCiAgICBjYWNoZXMubWF0Y2goZXZlbnQucmVxdWVzdCkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgLy8gQ2FjaGUgaGl0IC0gcmV0dXJuIHJlc3BvbnNlCiAgICAgIGlmIChyZXNwb25zZSkgewogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgfQogICAgICAKICAgICAgLy8gQ2xvbmUgdGhlIHJlcXVlc3QgZm9yIGZldGNoCiAgICAgIGNvbnN0IGZldGNoUmVxdWVzdCA9IGV2ZW50LnJlcXVlc3QuY2xvbmUoKTsKCiAgICAgIHJldHVybiBmZXRjaChmZXRjaFJlcXVlc3QpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgLy8gQ2hlY2sgaWYgdmFsaWQgcmVzcG9uc2UKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwIHx8IHJlc3BvbnNlLnR5cGUgIT09ICdiYXNpYycpIHsKICAgICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgICB9CgogICAgICAgIC8vIENhY2hlIG5ldyByZXNvdXJjZXMgKGV4Y2VwdCBBUEkgY2FsbHMgdHlwaWNhbGx5KQogICAgICAgIGlmICghZXZlbnQucmVxdWVzdC51cmwuaW5jbHVkZXMoJ2dvb2dsZScpICYmICFldmVudC5yZXF1ZXN0LnVybC5pbmNsdWRlcygnYXBpJykpIHsKICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVG9DYWNoZSA9IHJlc3BvbnNlLmNsb25lKCk7CiAgICAgICAgICAgICBjYWNoZXMub3BlbihDQUNIRV9OQU1FKS50aGVuKChjYWNoZSkgPT4gewogICAgICAgICAgICAgICBjYWNoZS5wdXQoZXZlbnQucmVxdWVzdCwgcmVzcG9uc2VUb0NhY2hlKTsKICAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICB9KTsKICAgIH0pCiAgKTsKfSk7Cg=="}}</script>
        <script>
          window.APPLET_FILES = ["index.tsx","metadata.json","index.html","types.ts","constants.ts","services/audioUtils.ts","services/geminiService.ts","components/Button.tsx","components/WaveformDisplay.tsx","components/AIGeneratorModal.tsx","App.tsx","components/EffectsModal.tsx","components/ExportModal.tsx","components/BeatMakerModal.tsx","services/storageService.ts","manifest.json","sw.js"];
          </script>
        <script type="module">
        (() => {
  if (window.self === window.top) {
    // Do not run the shim in the main window, only in iframes.
    return;
  }

  window.API_KEY = 'GEMINI_API_KEY';
  window.GEMINI_API_KEY = 'GEMINI_API_KEY';
  window.process = window.process || {};
  window.process.env = window.process.env || {};
  window.process.env.API_KEY = window.API_KEY;
  window.process.env.GEMINI_API_KEY = window.GEMINI_API_KEY;

  const bootstrapChannel = new Promise((resolve) => {
    window.addEventListener('message', (event) => {
      if (event.origin !== 'https://aistudio.google.com') {
        return;
      }

      if (event.data.type === 'bootstrap') {
        resolve({
          port: event.ports[0],
          urlPatterns:
              event.data.urlPatterns.map((pattern) => new RegExp(pattern)),
        });
      }
    });
  });

  window.aistudio = window.aistudio || {
    handleFullscreenEsc: true,
    getHostUrl: async function() {
      const hostPort = (await bootstrapChannel).port;
      return new Promise((resolve) => {
        const channel = new MessageChannel();
        hostPort.postMessage(
            {type: 'get_host_url'},
            [channel.port2]);
        const port = channel.port1;
        port.onmessage = (message) => {
          resolve(message.data.url);
        };
      });
    },
    hasSelectedApiKey: async function() {
      const hostPort = (await bootstrapChannel).port;
      return new Promise((resolve) => {
        const channel = new MessageChannel();
        hostPort.postMessage(
            {type: 'has_selected_api_key'},
            [channel.port2]);
        const port = channel.port1;
        port.onmessage = (message) => {
          resolve(message.data);
        };
      });
    },
    openSelectKey: async function() {
      const hostPort = (await bootstrapChannel).port;
      const channel = new MessageChannel();
      hostPort.postMessage(
          {type: 'open_select_key'},
          [channel.port2]);
    },
    getModelQuota: async function(model) {
      const hostPort = (await bootstrapChannel).port;
      return new Promise((resolve) => {
        const channel = new MessageChannel();
        hostPort.postMessage(
            {type: 'get_model_quota', model},
            [channel.port2]);
        const port = channel.port1;
        port.onmessage = (message) => {
          resolve(message.data.modelQuota);
        };
      });
    },
  };

  const nativeFetch = window.fetch;

  /**
   * @param {string | URL | Request} resource The resource of the fetch request.
   * @param {RequestInit} options The options of the fetch request.
   * @return {Promise!} The promise of the fetch request.
   */
  async function fetch(resource, options) {
    const config = await bootstrapChannel;

    const request = resource instanceof Request ?
      resource.clone() :
      new Request(resource, options);

    if (!config.urlPatterns.some((pattern) => request.url.match(pattern))) {
      return nativeFetch(resource, options);
    }
    const hostPort = config.port;

    const channel = new MessageChannel();
    const port = channel.port1;
    let bodyBytes;
    const transfer = [channel.port2];
    const parts = [];
    const buffer = await request.arrayBuffer();
    if (buffer.byteLength) {
      bodyBytes = buffer;
      transfer.push(bodyBytes);
    }
    hostPort.postMessage(
        {
          type: 'fetch',
          url: request.url,
          method: request.method,
          headers: [...request.headers.entries()],
          body: bodyBytes,
        },
        transfer);

    let streamController;
    const body = new ReadableStream({
      start(controller) {
        streamController = controller;
      },
    });
    let resolveReceive;
    const receivePromise = new Promise((resolve) => {
      resolveReceive = resolve;
    });
    port.onmessage = (message) => {
      switch (message.data.type) {
        case 'response':
          resolveReceive(new Response(body, {
            status: message.data.status,
            statusText: message.data.statusText,
            headers: new Headers(message.data.headers),
          }));
          break;
        case 'body':
          streamController.enqueue(message.data.data);
          break;
        case 'body_done':
          streamController.close();
          break;
      }
    };
    return receivePromise;
  }

  Object.defineProperty(window, 'fetch', {
    get: function() {
      return fetch;
    },
  });

  // See details in: https://github.com/angular/angular/issues/63064.
  function patchHistoryStateFunctionForAngular(originalFn, baseHref) {
    return (state, unused, url) => {
      if (typeof url === 'string' && !url.startsWith('blob:')) {
        url = baseHref + url;
      }
      return originalFn.apply(window.history, [state, unused, url]);
    };
  }

  if (false) {
    const baseHref = window.location.href;
    window.history.replaceState = patchHistoryStateFunctionForAngular(window.history.replaceState, baseHref);
    window.history.pushState = patchHistoryStateFunctionForAngular(window.history.pushState, baseHref);
  }

  const originalWebSocket = window.WebSocket;
  class ProxiedWebSocket extends EventTarget {
    /**
     * @param {string} url The url of the websocket.
     * @param {Object!} protocols The protocols of the websocket.
     */
    constructor(url, protocols) {
      super();
      this.url = url;
      this.protocols = protocols;

      this.open();
    }

    /** Opens the websocket. */
    async open() {
      const hostPort = (await bootstrapChannel).port;
      const channel = new MessageChannel();
      hostPort.postMessage(
          {type: 'websocket_open', url: this.url, protocols: this.protocols},
          [channel.port2]);
      this.port = channel.port1;
      this.port.onmessage = (message) => {
        if (message.data.type === 'close') {
          const event = new CloseEvent('close', {
            code: message.data.code,
            reason: message.data.reason,
            wasClean: message.data.wasClean,
          });
          if (this.onclose) {
            this.onclose(event);
          }
          this.dispatchEvent(event);
          return;
        } else if (message.data.type === 'open') {
          const event = new Event('open');
          if (this.onopen) {
            this.onopen(event);
          }
          this.dispatchEvent(event);
          return;
        } else if (message.data.type === 'message') {
          let data = message.data.data;
          if (message.data.messageType === 'text' || message.data.messageType === 'message') {
            data = new TextDecoder().decode(data);
          }
          const event = new MessageEvent('message', {
            data,
            type: message.data.messageType,
          });
          if (this.onmessage) {
            this.onmessage(event);
          }
          this.dispatchEvent(event);
          return;
        } else if (message.data.type === 'error') {
          const event = new ErrorEvent('error', {
            message: message.data.message,
          });
          if (this.onerror) {
            this.onerror(event);
          }
          this.dispatchEvent(event);
          return;
        }
        console.error('received unknown message in frame', event.data);
      };
    }
    /**
     * @param {string|ArrayBuffer!} data The data to send.
     */
    send(data) {
      if (typeof data === 'string') {
        this.port.postMessage({type: 'send', data});
      } else {
        this.port.postMessage({type: 'send', data}, [data.buffer]);
      }
    }

    /**
     * @param {number} code The code of the close event.
     * @param {string} reason The reason of the close event.
     */
    close(code, reason) {
      this.port.postMessage({type: 'close', code, reason});
    }
  }

  /**
   * @param {string} url The url of the websocket.
   * @param {Object!} protocols The protocols of the websocket.
   * @return {WebSocket!} The websocket.
   */
  function createWebSocket(url, protocols) {
    // This should come from the bootstrap channel, but we want this to
    // work for the synchronous constructor here.
    if (url.startsWith('wss://generativelanguage.googleapis.com/')) {
      return Reflect.construct(ProxiedWebSocket, [url, protocols]);
    }
    return Reflect.construct(originalWebSocket, [url, protocols]);
  }

  Object.defineProperty(window, 'WebSocket', {
    get: function() {
      return createWebSocket;
    },
  });

  async function instrumentErrorReporting() {
    const errors = [];
    let hostPort;

    function reportError(message) {
      if (!hostPort) {
        errors.push(message);
      } else {
        hostPort.postMessage({type: 'error', message: message}, message);
      }
    }

    function serialize(args) {
      return args.map((a) => {
        if (a instanceof Error || a instanceof ErrorEvent) {
          return a.message;
        }
        if(a instanceof CloseEvent) {
          return {code: a.code, reason: a.reason, wasClean: a.wasClean};
        }
        if( a instanceof Map) {
          return JSON.parse(JSON.stringify([...a.entries()]));
        }
        if( a instanceof Set) {
          return JSON.parse(JSON.stringify([...a.values()]));
        }
        if (a instanceof Object) {
          return JSON.parse(JSON.stringify(a));
        }
        return a;
      });
    }

    const originalConsole = window.console;
    const originalConsoleLog = window.console.log;
    const originalConsoleError = window.console.error;
    const originalConsoleWarn = window.console.warn;
    const originalConsoleDebug = window.console.debug;
    window.console = {
      ...originalConsole,
      log: (message, ...args) => {
        originalConsoleLog.apply(window.console, [message, ...args]);
        const combined = serialize([message, ...args]);
        reportError({type: 'console_log', message: combined });
      },
      debug: (message, ...args) => {
        originalConsoleDebug.apply(window.console, [message, ...args]);
        const combined = serialize([message, ...args]);
        reportError({type: 'console_debug', message: combined });
      },
      error: (message, ...args) => {
        originalConsoleError.apply(window.console, [message, ...args]);
        const combined = serialize([message, ...args]);
        reportError({type: 'console_error', message: combined });
      },
      warn: (message, ...args) => {
        originalConsoleWarn.apply(window.console, [message, ...args]);
        const combined = serialize([message, ...args]);
        reportError({type: 'console_warn', message: combined });
      },
    };

    window.onerror = (message, source, lineno, colno, error) => {
      reportError({type: 'error', message: serialize([message]), source, lineno, colno, error});
    };

    window.onunhandledrejection = (event) => {
      reportError({type: 'unhandledrejection', message: serialize([event.reason])});
    };

    window.alert = (message) => {
      reportError({type: 'alert', message: serialize([message]) });
    };

    hostPort = (await bootstrapChannel).port;
    for(const error of errors) {
      hostPort.postMessage({type: 'error', message: error});
    }
  }

  const availableFiles = new Set(window.APPLET_FILES || []);

  instrumentErrorReporting();

  if (false) {
    const notifyLocationChange = async () => {
      const hostPort = (await bootstrapChannel).port;
      hostPort.postMessage({type: 'locationchange', href: location.href});
    };

    // Send initial state on load.
    notifyLocationChange();

    const originalPushState = history.pushState;
    history.pushState = (...args) => {
      originalPushState.apply(history, args);
      notifyLocationChange();
    };

    const originalReplaceState = history.replaceState;
    history.replaceState = (...args) => {
      originalReplaceState.apply(history, args);
      notifyLocationChange();
    };
    window.addEventListener('popstate', (e) => {
      notifyLocationChange();
    });
  }

  window.addEventListener('hashchange', async (e) =>{
    const config = await bootstrapChannel;
    const hostPort = config.port;
    hostPort.postMessage({type: 'hashchange', hash: window.location.hash});
    if (false) {
      hostPort.postMessage({
        type: 'locationchange',
        href: location.href,
      });
    }
  });

  if (true) {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/html2canvas-pro';
    script.onload = () => {
      window.addEventListener('message', async (event) => {
        if (event.data?.type === 'capture-screenshot') {
          try {
            const canvas = await html2canvas(document.documentElement, {
              logging: false,
              useCORS: true,
              backgroundColor: null,
              scale: 1,
            });
            const hostPort = (await bootstrapChannel).port;
            hostPort.postMessage(
              {
                type: 'screenshot-result',
                dataUrl: canvas.toDataURL('image/png'),
                requestId: event.data.requestId,
                scrollX: document.body.scrollLeft,
                scrollY: document.body.scrollTop,
              },
            );
          } catch (e) {
            const hostPort = (await bootstrapChannel).port;
            hostPort.postMessage(
              {
                type: 'screenshot-error',
                error: e.message,
                requestId: event.data.requestId,
              });
          }
        }
      });
    };
    document.head.appendChild(script);
  }

  if (false) {
    const MAX_ANCESTOR_LEVEL = 3;
    const MAX_DESCENDANT_LEVEL = 3;

    function getElementSelector(el) {
      if (!el || el.nodeType !== 1) {
        return '';
      }
      const parts = [];
      while(el && el.nodeType === 1 && el.tagName.toLowerCase() !== 'body') {
        let part = el.tagName.toLowerCase();
        if (el.id) {
          part += '#' + CSS.escape(el.id);
        }

        const parent = el.parentElement;
        if (parent) {
          let nth = 1;
          let prev = el.previousElementSibling;
          while(prev) {
            if (prev.tagName === el.tagName) {
              nth++;
            }
            prev = prev.previousElementSibling;
          }
          part += ':nth-of-type(' + nth + ')';
        }

        parts.unshift(part);
        el = el.parentElement;
      }
      return parts.join(' > ');
    }

    function getDomTreeAsString(element, depth, maxDepth) {
      if (!element || element.nodeType !== 1 || depth > maxDepth) {
        return '';
      }
      const tagName = element.tagName.toLowerCase();
      let attrs = [];
      if (element.id) {
        attrs.push('id="' + element.id + '"');
      }
      if (element.classList.length > 0) {
        attrs.push('class="' + element.classList.value + '"');
      }
      const attrString = attrs.length > 0 ? ' ' + attrs.join(' ') : '';

      let content = '';
      for (const node of element.childNodes) {
        if (node.nodeType === 1) { // Element node
          content += getDomTreeAsString(node, depth + 1, maxDepth);
        } else if (node.nodeType === 3) { // Text node
          content += node.textContent;
        }
      }

      return '<' + tagName + attrString + '>' + content + '</' + tagName + '>';
    }

    const style = document.createElement('style');
    style.textContent =
      '.aistudio-focus-mode-highlight { box-shadow: inset 0 0 0 0.5px white, inset 0 0 0 1.5px #87a9ff !important; }' +
      '#aistudio-focus-mode-tag { position: absolute; display: none; background: #87a9ff; border-radius: 4px; border: 0.5px solid white; z-index: 10000; text-transform: lowercase; padding: 2px 4px; color: #32302c; font-family: Inter, sans-serif; font-size: 12px; font-style: normal; font-weight: 400; line-height: 16px; pointer-events: none; }';
    document.head.appendChild(style);

    let highlightedElement = null;
    let focusTag = null;
    let resizeObserver = null;
    let iframeLoaded = false;

    function positionFocusTag() {
      if (!highlightedElement || !focusTag) return;
      requestAnimationFrame(() => {
        focusTag.style.display = 'inline-flex';
        const rect = highlightedElement.getBoundingClientRect();
        focusTag.style.top =
          rect.top + window.scrollY - focusTag.offsetHeight - 5 + 'px';
        focusTag.style.left = rect.left + window.scrollX + 'px';
      });
    }

    if (window.ResizeObserver) {
      resizeObserver = new ResizeObserver(() => {
        positionFocusTag();
      });
    }

    function highlight(element) {
      if (!iframeLoaded) return; // Do not highlight if iframe is not loaded
      if (!focusTag) {
        focusTag = document.createElement('div');
        focusTag.id = 'aistudio-focus-mode-tag';
        document.body.appendChild(focusTag);
      }

      const hadHighlightedElement = !!highlightedElement;
      if (highlightedElement) {
        highlightedElement.classList.remove('aistudio-focus-mode-highlight');
        highlightedElement.removeAttribute('data-aistudio-tag-name');
        if (resizeObserver) {
          resizeObserver.unobserve(highlightedElement);
        }
      }
      focusTag.style.display = 'none';
      highlightedElement = element;
      const hasHighlightedElement = !!highlightedElement;

      if (!hadHighlightedElement && hasHighlightedElement) {
        window.addEventListener('resize', positionFocusTag);
        window.addEventListener('scroll', positionFocusTag, true);
      } else if (hadHighlightedElement && !hasHighlightedElement) {
        window.removeEventListener('resize', positionFocusTag);
        window.removeEventListener('scroll', positionFocusTag, true);
      }

      if (highlightedElement) {
        highlightedElement.setAttribute(
          'data-aistudio-tag-name',
          highlightedElement.tagName,
        );
        highlightedElement.classList.add('aistudio-focus-mode-highlight');
        focusTag.textContent = highlightedElement.tagName.toLowerCase();
        positionFocusTag();
        if (resizeObserver) {
          resizeObserver.observe(highlightedElement);
        }
      }
    }

    window.addEventListener('load', () => {
      iframeLoaded = true;
    });

    window.addEventListener('message', async (event) => {
      if (event.data?.type === 'highlight-element-at-point') {
        try {
          const element = document.elementFromPoint(
            event.data.x,
            event.data.y,
          );
          highlight(element);
        } catch (e) {
          highlight(null);
        }
      } else if (event.data?.type === 'highlight-element-by-selector') {
        try {
          const selector = event.data.selector;
          if (selector) {
            const element = document.querySelector(selector);
            highlight(element);
          } else {
            highlight(null);
          }
        } catch (e) {
          highlight(null);
        }
      } else if (event.data?.type === 'get-element-at-point') {
        try {
          const element = document.elementFromPoint(
            event.data.x,
            event.data.y,
          );
          const hostPort = (await bootstrapChannel).port;
          if (!element) {
            hostPort.postMessage({
              type: 'element-at-point-error',
              error: 'No element found at point',
              requestId: event.data.requestId,
            });
            return;
          }
          const selector = getElementSelector(element);

          let levelsUp = 0;
          let root = element;
          while(levelsUp < MAX_ANCESTOR_LEVEL && root.parentElement && root.parentElement.tagName.toLowerCase() !== 'html') {
            root = root.parentElement;
            levelsUp++;
          }
          const domString = getDomTreeAsString(root, 0, levelsUp + MAX_DESCENDANT_LEVEL);

          const styles = window.getComputedStyle(element);
          const css = {};
          for (let i = 0; i < styles.length; i++) {
            const key = styles[i];
            css[key] = styles.getPropertyValue(key);
          }
          hostPort.postMessage({
            type: 'element-at-point-result',
            element: {
              selector: selector,
              domString: domString,
              css: css,
              x: event.data.x,
              y: event.data.y,
            },
            requestId: event.data.requestId,
          });
        } catch (e) {
          const hostPort = (await bootstrapChannel).port;
          hostPort.postMessage({
            type: 'element-at-point-error',
            error: e.message,
            requestId: event.data.requestId,
          });
        }
      } else if (event.data?.type === 'change-element-style') {
        try {
          const selector = event.data.selector;
          if (selector) {
            const element = document.querySelector(selector);
            if (element) {
              element.style.setProperty(
                event.data.property,
                event.data.value,
                'important',
              );
              positionFocusTag();
            }
          }
        } catch (e) {}
      }
    });
  }

  window.addEventListener('keydown', async (event) => {
    if (event.key === 'Escape' && window.aistudio?.handleFullscreenEsc) {
      const hostPort = (await bootstrapChannel).port;
      hostPort.postMessage({type: 'exit-fullscreen'});
    }
  });
})();
// # sourceURL=iframe_shim.js
        </script>
        <base href="https://ai.studio"/>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SonicPocket AI</title>
    
    <!-- PWA Setup -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#09090b" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="SonicPocket" />
    <link rel="apple-touch-icon" href="https://cdn.glitch.global/c3bc8917-0b86-4447-9773-67705307f062/icon-192.png?v=1700000000000" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js"></script>
    <style>
      /* Custom scrollbar for webkit */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #18181b;
      }
      ::-webkit-scrollbar-thumb {
        background: #3f3f46;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #52525b;
      }
      /* Disable pull-to-refresh on mobile */
      body {
        overscroll-behavior-y: contain;
      }
      /* Safe area padding for iPhone X+ */
      .safe-area-pb {
        padding-bottom: env(safe-area-inset-bottom);
      }
      .safe-area-pl {
        padding-left: env(safe-area-inset-left);
      }
      .safe-area-pr {
        padding-right: env(safe-area-inset-right);
      }
    </style>
  </head>
  <body class="bg-zinc-950 text-zinc-100 antialiased overflow-hidden select-none">
    <div id="root" class="h-screen w-screen flex flex-col"></div>
    <script type="module" src="/index.tsx"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').then(registration => {
            console.log('SW registered: ', registration);
          }).catch(registrationError => {
            console.log('SW registration failed: ', registrationError);
          });
        });
      }
    </script>
  </body>
</html>

        <script type="module" onerror="console.warn('Failed to load the app. Try reloading it.')">import '@/index';</script>
        